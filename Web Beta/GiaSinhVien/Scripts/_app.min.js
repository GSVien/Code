function isNoU(variable){return variable===undefined||variable===null}function isNoUoW(variable){return variable===undefined||variable===null||variable.trim()===""}function getOrDefault(variable,defaultValue){return variable===undefined?defaultValue:variable}function formatNumber(number,separator,thousand,million,billion){if(separator=getOrDefault(separator,","),isNoU(number))throw"'number' can not be null or undefined";var tail;return(billion!==undefined&&number>1e9?(tail=billion,number=Math.round(number/1e9)):million!==undefined&&number>1e6?(tail=million,number=Math.round(number/1e6)):thousand!==undefined&&number>1e3&&(tail=thousand,number=Math.round(number/1e3)),number=number.toString().replace(/\B(?=(\d{3})+(?!\d))/g,separator),isNoUoW(tail))?number:number+tail}function convertImgToBase64(url,callback,outputFormat){if(outputFormat=getOrDefault(outputFormat,"image/jpeg"),isNoU(url))throw"'url' can not be null or undefined";if(isNoU(callback)||typeof callback!="function")throw"'callback' must be a function";var img=new Image;img.onload=function(){var canvas=document.createElement("CANVAS"),ctx=canvas.getContext("2d"),dataUrl;canvas.height=this.height;canvas.width=this.width;ctx.drawImage(this,0,0);dataUrl=canvas.toDataURL(outputFormat);canvas=undefined;callback(dataUrl)};img.onerror=function(){callback(undefined)};img.crossOrigin="Anonymous";img.src=url}function checkPageVisibility(){var visProp,prefixes,i,eventName;if(isNoU(_tfl.pageVisibility)){if(visProp=null,"hidden"in document)visProp="hidden";else for(prefixes=["webkit","moz","ms","o"],i=0;i<prefixes.length;i++)if(prefixes[i]+"Hidden"in document){visProp=prefixes[i]+"Hidden";break}if(visProp===null)return console.warn("Your browser is not supported Page Visibility API"),undefined;_tfl.pageVisibility=!0;eventName=visProp.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(eventName,function(){_tfl.pageVisibility=!document[visProp]})}return _tfl.pageVisibility}function query(link){var url,r={},i,x;if(isNoU(link)?url=window.location.search:(url="",link=link.split("?"),link[1]&&(url="?"+link[1])),url==="")return r;for(url=url.substring(1).split("&"),i=0;i<url.length;i++)x=url[i],r[x.split("=")[0]]=x.split("=")[1];return r.toString=function(){var s="";for(x in this)x!=="toString"&&(s+="&"+x+"="+this[x]);return s!==""&&(s="?"+s.substring(1)),s},r}function modalReposition(element){var modal=element,dialog=modal.find(".modal-dialog");modal.css("display","block");dialog.css("margin-top",Math.max(0,($(window).height()-dialog.height())/2))}giasinhvienApp.config(["$locationProvider","$routeProvider","$sceDelegateProvider","$uibTooltipProvider","calendarConfig","moment","NotificationProvider",function($locationProvider,$routeProvider,$sceDelegateProvider,$uibTooltipProvider,calendarConfig,moment,NotificationProvider){$locationProvider.html5Mode(!0);$locationProvider.html5Mode(!0).hashPrefix("!");$uibTooltipProvider.options({appendToBody:!0});$sceDelegateProvider.resourceUrlWhitelist(["self","http://teenidol.vn/**","https://www.youtube.com/**"]);calendarConfig.allDateFormats.moment.date.hour="H";calendarConfig.displayEventEndTimes=!0;calendarConfig.dateFormatter="moment";calendarConfig.i18nStrings={eventsLabel:"Show diễn",timeLabel:"Giờ",weekNumber:"Tuần {week}"};moment.locale("vi");$routeProvider.when("/",{css:"Styles/Views/Home.min.css",templateUrl:function(){return"Views/Home.html"},controller:"homeController"}).otherwise({redirectTo:"/show/live"});NotificationProvider.setOptions({delay:5e3,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"center",positionY:"top"})}]);giasinhvienApp.run(["$rootScope","sessionService","$window","$location","helperService","webService",function($rootScope,sessionService,$window,$location,helperService){helperService.detectBrowser()!="desktop"&&$location.$$path!="/"&&$location.$$path!="/news"&&$location.$$path!="/teenidol-giai-tri-tha-ga"&&$location.$$path.indexOf("/detailnews/")==-1&&($rootScope.showvideo=!1,$rootScope.showAppBanner=!0);sessionService.load();$rootScope.$on("$stateChangeSuccess",function(){$window.ga("send","pageview",$location.path())});angular.element(document).ready(function(){$(window).on("resize",function(){$(".modal:visible").each(function(i,x){modalReposition($(x))})})})}]);var _tfl={pageVisibility:undefined};giasinhvienApp.controller("homeController",["$scope","$rootScope","$location","$http","webService","authenticationService","modalService","formService",function($scope,$rootScope,$location,$http,webService){var now=new Date,endyear=now.getTime();$scope.$p=$scope.$parent;$scope.listSuggestStar=undefined;$scope.suggestCarouselIndex=undefined;$scope.recent=undefined;$scope.$p.resetLayout();$scope.$p.layoutFullBody=!0;$scope.onLoadProductData=function(){webService.call({name:"GetListProduct",data:{key:"sdgsg"},onError:function(){},onSuccess:function(r){console.log(r);$scope.ListProduct=r;$scope.$$phase||$scope.$apply()}})};$rootScope.$on("authentication_onSignIn",function(){$scope.onLoadProductData()});$rootScope.$on("authentication_onSignOut",function(){$scope.onLoadProductData()});$scope.$on("$viewContentLoaded",function(){$("body").css("background-image","url('/Content/Image/Background-home/home.png')");$scope.onLoadProductData();$("meta[name='title']").attr("content","Giải trí thả ga - Tự tin thể hiện mình cùng teenidol, giao lưu với dàn idol xinh xắn, đa tài, đa phong cách trên nền platform ưu việt nhất.");$("meta[name='keywords']").attr("content","Giải trí thả ga - Tự tin thể hiện mình cùng teenidol, giao lưu với dàn idol xinh xắn, đa tài, đa phong cách trên nền platform ưu việt nhất.");$("meta[name='description']").attr("content","Giải trí thả ga - Tự tin thể hiện mình cùng teenidol, giao lưu với dàn idol xinh xắn, đa tài, đa phong cách trên nền platform ưu việt nhất.")})}]);giasinhvienApp.controller("layoutController",["$window","$http","$scope","$rootScope","$location","$cookies","helperService","authenticationService","Notification","formService","webService","modalService",function($window,$http,$scope,$rootScope,$location,$cookies,helperService,authenticationService,Notification,formService,webService){$scope.layoutTitle="GiaSinhVien";$scope.layoutShowHeader=!0;$scope.layoutShowFooter=!0;$scope.layoutShowBanner=!0;$scope.layoutFullBody=!1;$scope.layoutShowRightBar=!0;$scope.layoutShowHeaderevent=!1;$scope.ListMenuHead=[{Name:"Giới Thiệu",Link:"/"},{Name:"Chính Sách",Link:"/"},{Name:"Liên Hệ",Link:"/"}];$scope.ListCategory=[{Id:1,Name:"Đồ Điện Tử",Photo:"http://i1150.photobucket.com/albums/o617/redsvn/slide/slide-ewaste.jpg",Link:"/",Status:1},{Id:7,Name:"Nội Ngoại Thất",Photo:"http://i1150.photobucket.com/albums/o617/redsvn/slide/slide-ewaste.jpg",Link:"/",Status:1},{Id:4,Name:"Gia Dụng",Photo:"http://i1150.photobucket.com/albums/o617/redsvn/slide/slide-ewaste.jpg",Link:"/",Status:1},{Id:10,Name:"Sách Báo",Photo:"http://i1150.photobucket.com/albums/o617/redsvn/slide/slide-ewaste.jpg",Link:"/",Status:1},{Id:13,Name:"Bất Động Sản",Photo:"http://i1150.photobucket.com/albums/o617/redsvn/slide/slide-ewaste.jpg",Link:"/",Status:1},{Id:15,Name:"Các Loại Khác",Photo:"http://i1150.photobucket.com/albums/o617/redsvn/slide/slide-ewaste.jpg",Link:"/",Status:1}];console.log($scope.ListCategory);$scope.resetLayout=function(){$("body").css("background-image","");$scope.layoutTitle="GiaSinhVien";$scope.layoutShowHeader=!0;$scope.layoutShowFooter=!0;$scope.layoutShowBanner=!0;$scope.layoutFullBody=!1;$scope.layoutShowRightBar=!0;$scope.layoutShowLeftBar=!0;$scope.layoutShowHeaderevent=!1};$scope.dangNhapBangEmail=function(){webService.call({name:"DangNhapBangEmail",data:{email:"tai_@tfl.vn",passwork:"654321"},onError:function(){},onSuccess:function(r){console.log(r);$scope.$$phase||$scope.$apply()}})};$scope.$watch("dropdownUserId",function(data){data&&($scope.dropdownStatus="loading",$scope.dropdownMessage=undefined,$scope.dropdownUserId.vipId&&$scope.dropdownUserId.vipId===100||webService.call({name:"User_GetDetails",data:{actionUserId:sessionService.userId(),userId:data.userId,isStar:!1,key:sessionService.key()},onError:function(errorCode,message){$scope.dropdownStatus="error";$scope.dropdownMessage=message;$scope.$apply()},onSuccess:function(r1){webService.call({name:"User_IsUserCanChatShow",data:{actionUserId:sessionService.userId(),userId:data.userId,scheduleId:$scope.dropdownUserId.scheduleId,key:sessionService.key()},onError:function(errorCode,message){$scope.dropdownStatus="error";$scope.dropdownMessage=message;$scope.$apply()},onSuccess:function(r2){r1.Result.Guild&&r1.Result.GuildLevel?($scope.guildInfo.guildBusy=!0,$scope.guildInfo.nameGuild=r1.Result.Guild.Name,$scope.guildInfo.Id=r1.Result.Guild.Id,$scope.guildInfo.photoGuild=r1.Result.Guild.PhotoLink,$scope.guildInfo.iconGuild=r1.Result.Guild.Avatar,$scope.guildInfo.levelPhoto=r1.Result.GuildLevel.Photo,$scope.guildInfo.nameMaster=r1.Result.GuildLeader.Name,$scope.guildInfo.totalUserGuild=r1.Result.Guild.TotalUser,$scope.guildInfo.totalUserMaxGuild=r1.Result.GuildLevel.TotalUser):$scope.guildInfo.guildBusy=!1;$scope.dropdownUserData=r1.Result;$scope.dropdownUserData.isCanChat=r2.Result;$scope.dropdownUserData.isMod=r2.Extra;$scope.dropdownStatus="loaded";$scope.$apply()}})}}))});$scope.redirectlink=function(){$scope.showvideo=$scope.showvideo?!1:!0};helperService.checkCookies()||Notification.showAlert({title:"Xin bật Cookies",message:"Hiện bạn đã tắt chức năng Cookies của trình duyệt.<br/> Xin vui lòng kiểm tra và bật lại để có những trải nghiệm tốt nhất tại TeenIdol.",buttons:[{text:"OK",type:"close"}]})}]);giasinhvienApp.controller("detailnewsController",["$scope","$rootScope","$routeParams","$log","$sce","sessionService","webService","helperService","$window","authenticationService","Notification",function($scope,$rootScope,$routeParams,$log,$sce,sessionService,webService,helperService,$window,authenticationService,Notification){$scope.htmlContent=undefined;var link="";$scope.$p=$scope.$parent;$routeParams&&(link=$routeParams.link);$scope.$p.resetLayout();$scope.$p.layoutFullBody=!1;$scope.getTimeFormat=function(e){return helperService.formatStortDate(e)};$scope.getNewsLink=function(link){return"/detailnews/"+link};$scope.getLinkShare=function(link){return"//detailnews/"+link};$scope.onLoadMainNews=function(){webService.call({name:"GetNewsDetailByLink",data:{actionUserId:$scope.$p.sessionService.userId(),link:link,key:$scope.$p.sessionService.key()},onSuccess:function(r){console.log(r);$scope.newsId=r.Result.Id;$scope.title=r.Result.Title;$scope.description=r.Result.Summary;$scope.linkNews=r.Result.LinkNews;$scope.createDate=r.Result.CreateDate;$scope.photoImage=r.Result.LinkPhoto;$rootScope.DetailNewsTitle=r.Result.Title;$rootScope.DetailNewsUrl=+r.Result.LinkNews;$rootScope.DetailNewsImage=r.Result.LinkPhoto;r.Result.HtmlText=r.Result.HtmlText.replace(/\\r\\n/g,"");$scope.htmlContent=$sce.trustAsHtml($("<div/>").html(r.Result.HtmlText).text());webService.call({name:"New_GetListNewsReference",data:{actionUserId:$scope.$p.sessionService.userId(),categoryNewsId:1,newsId:$scope.newsId,key:$scope.$p.sessionService.key()},onSuccess:function(rs){$scope.listNewsReference=rs.Items;$scope.$apply()}});$scope.newsId==293&&webService.call({name:"User_GetDetails",data:{actionUserId:sessionService.userId(),userId:127479,isStar:!0,key:sessionService.key()},onError:function(errorCode,message){$scope.starError=message;$scope.starStatus="error";$scope.$apply()},onSuccess:function(r){$scope.rubuidoltrungthu=r.Result.UserStarData?r.Result.UserStarData.CoinGetFromGift:undefined;$scope.$apply()}})}});webService.call({name:"New_GetListNews",data:{actionUserId:$scope.$p.sessionService.userId(),newsCategoryId:2,pageIndex:0,pageSize:2,key:$scope.$p.sessionService.key()},onSuccess:function(rs){$scope.listEvent=rs.Items}});webService.call({name:"List_SuggestStars",data:{createUserId:$scope.$p.sessionService.userId(),pageIndex:0,pageSize:2,getStarType:1,key:$scope.$p.sessionService.key()},onSuccess:function(rs){$scope.listShowItem=rs.Items;$scope.$apply()}})};$scope.onShareFacebook=function(){FB.ui({method:"feed",link:"https://teenidol.vn/detailnews/"+$scope.linkNews,picture:$scope.photoImage,name:$scope.title,description:$scope.description,caption:"",message:""})};$scope.liststatus={quantitytrungthu:"500",data:[{id:100,qualiti:100},{id:300,qualiti:300},{id:500,qualiti:500},{id:999,qualiti:1e3},]};$scope.onSendRuByTrungThu=function(){if(!$scope.liststatus.quantitytrungthu){Notification.error("Bạn chưa chọn số tiền khuyên góp");return}if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}webService.call({type:"POST",name:"User_GiveAwayGiftEvent",data:{actionUserId:sessionService.userId(),giftId:8,quantity:$scope.liststatus.quantitytrungthu*1,scheduleId:"70294",starId:127479,isInEvent:!1,key:sessionService.key()},displayError:!0,onError:function(){},onSuccess:function(){Notification.success("Bạn vừa khuyên góp thành công");webService.call({name:"User_GetDetails",data:{actionUserId:sessionService.userId(),userId:127479,isStar:!0,key:sessionService.key()},onError:function(errorCode,message){$scope.starError=message;$scope.starStatus="error";$scope.$apply()},onSuccess:function(r){$scope.rubuidoltrungthu=r.Result.UserStarData?r.Result.UserStarData.CoinGetFromGift:undefined;$scope.$apply()}})}})};sessionService.isReady(function(){$scope.onLoadMainNews();$($window).bind("scroll",function(){this.pageYOffset>750?($(".crolltop").css("position","fixed"),$(".crolltop").css("top","0"),$(".crolltop").css("width","23.4%")):($(".crolltop").css("position","relative"),$(".crolltop").css("top","0"),$(".crolltop").css("width","auto"))})})}]);giasinhvienApp.controller("eventnewsController",["$scope","$routeParams","$log","sessionService","webService","helperService",function($scope,$routeParams,$log,sessionService,webService,helperService){$scope.$p=$scope.$parent;$scope.newsCategoryId=2;$scope.pageIndex=0;$scope.pageSize=6;$scope.$p.resetLayout();$scope.$p.layoutFullBody=!1;$scope.getTimeFormat=function(e){return helperService.formatStortDate(e)};$scope.getNewsLink=function(id){return"/detailnews/"+id};$scope.onLoadMainNews=function(){webService.call({name:"New_GetListNews",data:{actionUserId:$scope.$p.sessionService.userId(),newsCategoryId:$scope.newsCategoryId,pageIndex:$scope.pageIndex,pageSize:$scope.pageSize,key:$scope.$p.sessionService.key()},onSuccess:function(rs){$scope.mainObject=rs.Items[0];$scope.listEvent=rs.Items.slice(1,6);$scope.canNext=rs.PageIndex<rs.PageCount-1;$scope.$apply()}});webService.call({name:"New_GetListNews",data:{actionUserId:$scope.$p.sessionService.userId(),newsCategoryId:1,pageIndex:0,pageSize:2,key:$scope.$p.sessionService.key()},onSuccess:function(rs){$scope.listNews=rs.Items;$scope.$apply()}});webService.call({name:"List_SuggestStars",data:{createUserId:$scope.$p.sessionService.userId(),pageIndex:0,pageSize:3,getStarType:1,key:$scope.$p.sessionService.key()},onSuccess:function(rs){$scope.listShowItem=rs.Items;$scope.$apply()}})};$scope.onLoadNewsNext=function(){$scope.pageIndex=$scope.pageIndex+1;webService.call({name:"New_GetListNews",data:{actionUserId:$scope.$p.sessionService.userId(),newsCategoryId:$scope.newsCategoryId,pageIndex:$scope.pageIndex,pageSize:$scope.pageSize,key:$scope.$p.sessionService.key()},onSuccess:function(rs){$scope.listEvent=$scope.listEvent.concat(rs.Items);$scope.canNext=rs.PageIndex<rs.PageCount-1;$scope.$apply()}})};sessionService.isReady(function(){$scope.onLoadMainNews()})}]);giasinhvienApp.controller("usercoinlogController",["$scope","$routeParams","sessionService","webService","authenticationService","formService","helperService","$log",function($scope,$routeParams,sessionService,webService,authenticationService,formService,helperService){var pageindex;$scope.popup1={opened:!1,date:new Date};$scope.popup2={opened:!1,date:new Date};$scope.$p=$scope.$parent;$scope.helperService=helperService;$scope.IdUserSession=$scope.$p.sessionService.userId();pageindex=0;$scope.CurrentPage=1;$routeParams&&($scope.userId=$routeParams.id);$scope.userSession=function(){return sessionService.isSigned()?sessionService.data().user:undefined};$scope.$p.layoutShowHeader=!0;$scope.$p.layoutShowFooter=!0;$scope.$p.layoutShowBanner=!0;$scope.$p.layoutFullBody=!0;$scope.open1=function(){$scope.popup1.opened=!0};$scope.open2=function(){$scope.popup2.opened=!0};$scope.onLoadUserGetDetails=function(){webService.call({name:"User_GetDetails",data:{actionUserId:$scope.IdUserSession,userId:$scope.userId,isStar:!0,key:$scope.$p.sessionService.key()},onSuccess:function(r){$scope.userSession=r.Result;$scope.$apply()}})};$scope.onLoadUserSpend=function(a){var type=1;$scope.a=1;pageindex=$scope.CurrentPage-1;a&&(type=a,$scope.a=a);webService.call({name:"List_UserSpend",data:{pageIndex:pageindex,pageSize:10,userId:$scope.IdUserSession,type:type,startTime:0,endTime:0,key:$scope.$p.sessionService.key()},onSuccess:function(r){$scope.total=r.Total;$scope.ListUserSpend=r.Items;$scope.TotalItems=r.Total;$scope.CurrentPage=pageindex+1;$scope.numPages=r.PageCount;$scope.maxSize=3;$scope.b=1;$scope.$apply()}});$(".type a").click(function(){$(".type a").removeClass("active");$(event.target).addClass("active")})};$scope.onLoadSeachCoinLog=function(a){pageindex=$scope.CurrentPage-1;var type=a;webService.call({name:"List_UserSpend",data:{pageIndex:pageindex,pageSize:10,userId:$scope.IdUserSession,type:type,startTime:$scope.popup1.date.getTime(),endTime:$scope.popup2.date.getTime(),key:$scope.$p.sessionService.key()},onSuccess:function(r){$scope.total=r.Total;$scope.ListUserSpend=r.Items;$scope.TotalItems=r.Total;$scope.CurrentPage=pageindex+1;$scope.numPages=r.PageCount;$scope.maxSize=3;$scope.b=2;$scope.$apply()}})};sessionService.isReady(function(){$scope.onLoadUserGetDetails();$scope.onLoadUserSpend()})}]);giasinhvienApp.controller("userfollowController",["$scope","$rootScope","$location","$routeParams","sessionService","webService","authenticationService","formService",function($scope,$rootScope,$location,$routeParams,sessionService,webService){$scope.$p=$scope.$parent;$scope.ListUserFollow=undefined;$scope.ListStarFollow=undefined;$scope.ListFollow={status:"loading"};$routeParams&&($scope.userId=$routeParams.id);$scope.userSession=function(){return sessionService.isSigned()?sessionService.data().user:undefined};$scope.getDisplayPoint=function(x){return x!=undefined?x.TotalSumValue:0};$scope.$p.layoutShowHeader=!0;$scope.$p.layoutShowFooter=!0;$scope.$p.layoutShowBanner=!0;$scope.$p.layoutFullBody=!0;$scope.onLoadUserGetDetails=function(){webService.call({name:"User_GetDetails",data:{actionUserId:$scope.$p.sessionService.userId(),userId:$scope.userId,isStar:!0,key:$scope.$p.sessionService.key()},onSuccess:function(r){$scope.name=r.Result.User.Name;$scope.$apply()}})};$scope.onLoadListFollow=function(a){var pageindex=0,type=1,currentTab;$scope.a=1;a&&(pageindex=$scope.CurrentPage-1,type=a,$scope.a=a);currentTab=$(".right-panel .tab-pane.active").attr("id");switch(currentTab){default:case"user-follow":webService.call({name:"User_GetListUserFollow",data:{actionUserId:$scope.$p.sessionService.userId(),userId:$scope.userId,pageIndex:pageindex,pageSize:8,key:$scope.$p.sessionService.key()},onSuccess:function(r){$scope.TotalUser=r.Total;$scope.CurrentPage=pageindex+1;$scope.numPages=r.PageCount;$scope.maxSize=5;$scope.ListUserFollow=$scope.TotalUser>0?r.Items:[];$scope.$apply();$(".right-panel a[data-toggle='tab'].active").removeClass("active");$(".right-panel a[data-target='#user-follow']").addClass("active");$("#page-"+(parseInt($scope.pageUserindex)+1)).addClass("active")}});break;case"star-follow":webService.call({name:"User_GetListStarFollow",data:{actionUserId:$scope.$p.sessionService.userId(),userId:$scope.userId,pageIndex:pageindex,pageSize:8,key:$scope.$p.sessionService.key()},onSuccess:function(r){$scope.totalStar=r.Total;$scope.CurrentPage=pageindex+1;$scope.numPages=r.PageCount;$scope.maxSize=5;$scope.ListStarFollow=$scope.totalStar>0?r.Items:[];$scope.ListFollow.status="loaded";$scope.$apply();$(".right-panel a[data-toggle='tab'].active").removeClass("active");$(".right-panel a[data-target='#star-follow']").addClass("active");$("#page-"+(parseInt($scope.pageStarindex)+1)).addClass("active")}})}};sessionService.isReady(function(){$(".right-panel a[data-toggle='tab']").on("shown.bs.tab",function(){$scope.onLoadListFollow()});$(".right-panel .active a[data-toggle='tab']").trigger("shown.bs.tab");$scope.onLoadUserGetDetails()})}]);giasinhvienApp.controller("userinboxController",["$scope","$rootScope","$location","$routeParams","sessionService","webService","authenticationService","formService",function($scope,$rootScope,$location,$routeParams,sessionService){$scope.$p=$scope.$parent;$scope.IdUserSession=$scope.$p.sessionService.userId();$routeParams&&(userId=$routeParams.id);$scope.$p.layoutShowHeader=!0;$scope.$p.layoutShowFooter=!0;$scope.$p.layoutShowBanner=!0;$scope.$p.layoutFullBody=!0;sessionService.isReady(function(){})}]);giasinhvienApp.controller("userinventoryController",["$scope","$rootScope","$location","$routeParams","sessionService","webService","authenticationService","formService",function($scope,$rootScope,$location,$routeParams,sessionService,webService){var now,today;$scope.$p=$scope.$parent;$scope.IdUserSession=$scope.$p.sessionService.userId();$routeParams&&(userId=$routeParams.id);pageIndex=0;now=new Date;today=now.getTime();$scope.today=today;$scope.userSession=function(){return sessionService.isSigned()?sessionService.data().user:undefined};$scope.$p.layoutShowHeader=!0;$scope.$p.layoutShowFooter=!0;$scope.$p.layoutShowBanner=!0;$scope.$p.layoutFullBody=!0;$scope.onLoadListAnimationItem=function(){webService.call({name:"User_GetListAnimationItem",data:{actionUserId:$scope.IdUserSession,userId:userId,pageIndex:0,pageSize:9999,key:$scope.$p.sessionService.key()},onSuccess:function(r){$scope.total=r.Total;$scope.ListAnimationItem=r.Items;$scope.$apply()}})};$scope.DefaultItem=function(a,b){webService.call({name:"Store_ChoseAnimationDefaultItem",data:{actionUserId:$scope.IdUserSession,animationItemId:a,rootCategoryId:b,key:$scope.$p.sessionService.key()},onError:function(code,msg){console.log(code,msg)},onSuccess:function(){$scope.onLoadListAnimationItem();$scope.$apply()}})};sessionService.isReady(function(){$scope.onLoadListAnimationItem()})}]);giasinhvienApp.controller("usermodroomController",["$scope","$rootScope","$location","$routeParams","sessionService","webService","authenticationService","formService",function($scope,$rootScope,$location,$routeParams,sessionService,webService){$scope.$p=$scope.$parent;$scope.IdUserSession=$scope.$p.sessionService.userId();$routeParams&&(userId=$routeParams.id);$scope.userSession=function(){return sessionService.isSigned()?sessionService.data().user:undefined};$scope.$p.layoutShowHeader=!0;$scope.$p.layoutShowFooter=!0;$scope.$p.layoutShowBanner=!0;$scope.$p.layoutFullBody=!0;$scope.onLoadUserGetDetails=function(){webService.call({name:"User_GetDetails",data:{actionUserId:$scope.$p.sessionService.userId(),userId:userId,isStar:!0,key:$scope.$p.sessionService.key()},onSuccess:function(r){$scope.name=r.Result.User.Name;$scope.$apply()}})};sessionService.isReady(function(){$scope.onLoadUserGetDetails()})}]);giasinhvienApp.controller("userrewardController",["$scope","$rootScope","$location","$routeParams","sessionService","webService","authenticationService","formService","helperService",function($scope,$rootScope,$location,$routeParams,sessionService,webService,authenticationService,formService,helperService){var now;$scope.popup1={opened:!1,date:new Date};$scope.popup2={opened:!1,date:new Date};$scope.$p=$scope.$parent;pageindex=0;$routeParams.p&&(pageindex=$routeParams.p-1);$scope.IdUserSession=$scope.$p.sessionService.userId();$routeParams&&($scope.userId=$routeParams.id);now=new Date;$scope.userSession=function(){return sessionService.isSigned()?sessionService.data().user:undefined};$scope.$p.layoutShowHeader=!0;$scope.$p.layoutShowFooter=!0;$scope.$p.layoutShowBanner=!0;$scope.$p.layoutFullBody=!0;$scope.open1=function(){$scope.popup1.opened=!0};$scope.open2=function(){$scope.popup2.opened=!0};$scope.onLoadGetRewardLog=function(){webService.call({name:"User_GetRewardLog",data:{actionUserId:$scope.IdUserSession,userId:$scope.userId,pageIndex:pageindex,pageSize:10,key:$scope.$p.sessionService.key(),startTime:0,endTime:now.getTime()},onSuccess:function(r){$scope.helperService=helperService;$scope.total=r.Total;$scope.pageindex=r.PageIndex;$scope.pagecount=r.PageCount;$scope.GetRewardLog=r.Items;$scope.$apply();$("#page-"+(parseInt($scope.pageindex)+1)).addClass("active")}})};$scope.onLoadSeachReward=function(){webService.call({name:"User_GetRewardLog",data:{actionUserId:$scope.IdUserSession,userId:$scope.userId,pageIndex:pageindex,pageSize:12,key:$scope.$p.sessionService.key(),startTime:$scope.popup1.date.getTime(),endTime:$scope.popup2.date.getTime()},onSuccess:function(r){$scope.helperService=helperService;$scope.total=r.Total;$scope.pageindex=r.PageIndex;$scope.pagecount=r.PageCount;$scope.GetRewardLog=r.Items;$("#page-"+(parseInt($scope.pageindex)+1)).addClass("active");$scope.$apply()}})};sessionService.isReady(function(){$scope.onLoadGetRewardLog()})}]);giasinhvienApp.directive("compile",["$compile",function($compile){return function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.compile)},function(value){element.html(value);$compile(element.contents())(scope)})}}]);giasinhvienApp.directive("jqDropdown",["$timeout","helperService",function(){return{restrict:"C",link:function(scope,element,attrs){element.on("show",function(event,dropdownData){var bw=$(window).width(),bh=$(window).height(),tw=dropdownData.trigger.width(),th=dropdownData.trigger.height(),to=dropdownData.trigger.offset(),t="",b="",l="",r="";bw-(to.left+tw)>200?(element.removeClass("jq-dropdown-anchor-right"),l=to.left):(element.addClass("jq-dropdown-anchor-right"),r=bw-(to.left+tw));bh-(to.top+th)>200?(element.addClass("jq-dropdown-tip"),t=to.top+th):(element.removeClass("jq-dropdown-tip"),b=bh-to.top);element.css("top",t);element.css("bottom",b);element.css("left",l);element.css("right",r)});$(".jq-dropdown-menu, .jq-dropdown-panel").on("show",function(){var $target=$(e.target).closest("[ud-role=user-popup]"),right=$target.offset().left+$target.width(),windowWidth=$(window).width();$("#dropdown-user-info").data("user-id",attrs.userId*1);$("#dropdown-user-info").data("schedule-id",attrs.scheduleId?attrs.scheduleId*1:undefined);right>=windowWidth-300?$("#dropdown-user-info").addClass("jq-dropdown-anchor-right"):$("#dropdown-user-info").removeClass("jq-dropdown-anchor-right")})}}}]);giasinhvienApp.directive("fbLike",["$window","$rootScope",function($window){return{restrict:"A",scope:{fbLike:"=?"},link:function(scope,element,attrs){function renderLikeButton(){if(!attrs.fbLike||scope.fbLike||watchAdded)element.html('<div class="fb-like"'+(!scope.fbLike?"":' data-href="'+scope.fbLike+'"')+' data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"><\/div>'),$window.FB.XFBML.parse(element.parent()[0]);else{watchAdded=!0;var unbindWatch=scope.$watch("fbLike",function(newValue){newValue&&(renderLikeButton(),unbindWatch())});return}}$window.FB?renderLikeButton():$.getScript("//connect.facebook.net/en_US/sdk.js",function(){$window.FB.init({appId:0xb24e3345b694,xfbml:!0,version:"v2.0"});renderLikeButton()});var watchAdded=!1}}}]);giasinhvienApp.directive("fileread",[function(){return{scope:{fileread:"="},link:function(scope,element){element.bind("change",function(changeEvent){var reader=new FileReader,a;reader.onload=function(loadEvent){scope.$apply(function(){scope.fileread=loadEvent.target.result})};a=reader.readAsDataURL(changeEvent.target.files[0])})}}}]);giasinhvienApp.factory("formatText",[function(){return new function(){this.formatText=function(input){var textreplace=input.replace(/á|à|ả|ã|ạ|ă|ắ|ặ|ằ|ẳ|ẵ|â|ấ|ầ|ẩ|ẫ|ậ|A|Á|À|Ả|Ã|Ạ|Ă|Ắ|Ặ|Ằ|Ẳ|Ẵ|Â|Ấ|Ầ|Ẩ|Ẫ|Ậ/g,"a").replace(/đ|Đ|D/g,"d").replace(/ý|ỳ|ỷ|ỹ|ỵ|Y|Ý|Ỳ|Ỷ|Ỹ|Ỵ/g,"y").replace(/ú|ù|ủ|ũ|ụ|ư|ứ|ừ|ử|ữ|ự|U|Ú|Ù|Ủ|Ũ|Ụ|Ư|Ứ|Ừ|Ử|Ữ|Ự/g,"u").replace(/ó|ò|ỏ|õ|ọ|ô|ố|ồ|ổ|ỗ|ộ|ơ|ớ|ờ|ở|ỡ|ợ|O|Ó|Ò|Ỏ|Õ|Ọ|Ô|Ố|Ồ|Ổ|Ỗ|Ộ|Ơ|Ớ|Ờ|Ở|Ỡ|Ợ/g,"o").replace(/é|è|ẻ|ẽ|ẹ|ê|ế|ề|ể|ễ|ệ|E|É|È|Ẻ|Ẽ|Ẹ|Ê|Ế|Ề|Ể|Ễ|Ệ/g,"e").replace(/í|ì|ỉ|ĩ|ị|Í|Ì|Ỉ|Ĩ|Ị|I/g,"i"),output=textreplace.replace(/!|@|%|\^|\*|\”|\“|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\;|\'| |\"|\&|\#|\[|\]|~|$|_/g,"-").replace(/-+-/g,"-");return output.toLowerCase()}}}]);giasinhvienApp.directive("head",["$rootScope","$compile","$window","$location","sessionService",function($rootScope,$compile){return{restrict:"E",link:function(scope,element){element.append($compile("<link type='text/css' rel='stylesheet' ng-repeat='(routeCtrl, cssUrl) in routeStyles' ng-href='{{cssUrl}}' />")(scope));scope.routeStyles={};$rootScope.$on("$routeChangeStart",function(e,next,current){current&&current.$$route&&current.$$route.css&&(angular.isArray(current.$$route.css)||(current.$$route.css=[current.$$route.css]),angular.forEach(current.$$route.css,function(sheet){delete scope.routeStyles[sheet]}));next&&next.$$route&&next.$$route.css&&(angular.isArray(next.$$route.css)||(next.$$route.css=[next.$$route.css]),angular.forEach(next.$$route.css,function(sheet){scope.routeStyles[sheet]=sheet}))})}}}]);giasinhvienApp.directive("img",[function(){return{restrict:"E",link:function(){}}}]);giasinhvienApp.directive("imgScale",[function(){return{restrict:"E",transclude:!0,replace:!0,scope:{link:"@",errorSrc:"@",rescaleonresize:"@"},template:"<div class='img-container'><img ng-src='{{link}}' error-src='{{errorSrc}}'><\/div>",link:function(scope,element,attrs){rescaleonresize=scope.rescaleonresize?attrs.rescaleonresize:!1;element.find("img").imageScale({rescaleOnResize:rescaleonresize,scale:attrs.scale,align:attrs.align})}}}]);giasinhvienApp.directive("isLoading",[function(){return{restrict:"A",scope:{isLoading:"="},link:function(scope,element){scope.$watch("isLoading",function(newValue){newValue?element.button("loading"):element.button("reset")})}}}]);giasinhvienApp.directive("kendoTemplate",["$compile",function($compile){return{restrict:"E",transclude:!0,scope:{templateId:"@",templateData:"@"},link:function(scope,element){var html,template;if(isNoUoW(scope.templateId))throw"'template-id' must be declared";if(html="",$("#"+scope.templateId).length===0)console.warn("Can not find the template '"+scope.templateId+"'");else{if(template=kendo.template($("#"+scope.templateId).html()),scope.templateData=getOrDefault(scope.templateData,{}),typeof scope.templateData!="object")try{scope.templateData=JSON.parse(scope.templateData)}catch(e){scope.templateData={};console.warn("Can not parse template-data of template: '"+scope.templateId+"'")}html=template(scope.templateData)}element.replaceWith($compile(html)(scope.$parent.$parent))}}}]);giasinhvienApp.directive("modal",[function(){return{restrict:"C",link:function(scope,element){element.on("show.bs.modal",function(){modalReposition(element)})}}}]);giasinhvienApp.directive("wrapOwlcarousel",function(){return{restrict:"E",transclude:!1,link:function(scope){scope.initCarousel=function(element){$(element).owlCarousel({loop:!1,margin:0,items:4,nav:!0,autoplay:!0,autoplayTimeout:4e4,autoplayHoverPause:!0,responsiveClass:!0,dots:!1,slideBy:1,navText:["<i class='fa fa-angle-left'><\/i>","<i class='fa fa-angle-right'><\/i>"],responsive:{0:{items:4},600:{items:4},1e3:{items:4}}})}}}});giasinhvienApp.directive("owlCarouselItem",[function(){return{restrict:"A",transclude:!1,link:function(scope,element){scope.$last&&scope.initCarousel(element.parent())}}}]);giasinhvienApp.directive("paging",["helperService","$routeParams",function(helperService,$routeParams){return{restrict:"E",transclude:!0,replace:!0,scope:{pageindex:"@",pagesize:"@",pagecount:"@",rank:"@",url:"@"},template:"<div class='list-wrapper'><ul class='page-list'> <li ng-if='dk'><a class='page-link'  href='{{url}}?p={{prev}}' ><i class='fa fa-angle-left'><\/i><\/a><\/li> <li ng-repeat='count in listpage'><a class='page-link'  id='page-{{count}}' data-page='{{count}}' href='{{url}}?p={{count}}'>{{count}}<\/a><\/li> <li ng-if='dk1'><a class='page-link'  href='{{url}}?p={{next}}' ><i class='fa fa-angle-right'><\/i><\/a><\/li><\/ul><\/div>",link:function(scope){$routeParams.p&&(scope.pageindex=$routeParams.p);scope.url||(scope.url=scope.url);scope.dk=parseInt(scope.pageindex)>parseInt(scope.rank)+1;scope.dk1=parseInt(scope.pagecount)-parseInt(scope.rank)>parseInt(scope.pageindex)+1;scope.listpage=[1,2,3];parseInt(scope.pageindex)==1&&(scope.listpage=[parseInt(scope.pageindex),parseInt(scope.pageindex)+1,parseInt(scope.pageindex)+2]);parseInt(scope.pageindex)==parseInt(scope.pagecount)&&parseInt(scope.pageindex)>=3&&(scope.listpage=[parseInt(scope.pagecount)-2,parseInt(scope.pagecount)-1,parseInt(scope.pagecount)]);parseInt(scope.pageindex)<parseInt(scope.pagecount)&&parseInt(scope.pageindex)>1&&(scope.listpage=[parseInt(scope.pageindex)-1,parseInt(scope.pageindex),parseInt(scope.pageindex)+1]);scope.prev=scope.pageindex-1==0?parseInt(scope.pagecount):parseInt(scope.pageindex)-1;scope.next=parseInt(scope.pageindex)+1>parseInt(scope.pagecount)?1:parseInt(scope.pageindex)+1}}}]);giasinhvienApp.directive("toggle",[function(){return{restrict:"A",link:function(scope,element,attrs){scope.$watch(function(){attrs.toggle==="tooltip"?$(element).tooltip({container:"body"}):attrs.toggle==="popover"&&$(element).popover()})}}}]);giasinhvienApp.directive("udRole",["authenticationService","sessionService","modalService",function(authenticationService,sessionService,modalService){return{restrict:"A",link:function(scope,element,attrs){switch(attrs.udRole){case"sign-in":element.on("click",function(){authenticationService.showModal({mode:"sign-in",message:element.data("message"),messageType:element.data("message-type")})});break;case"sign-up":element.on("click",function(){authenticationService.showModal({mode:"sign-up",message:element.data("message"),messageType:element.data("message-type")})});break;case"re-pass":element.on("click",function(){authenticationService.showModal({mode:"re-pass",message:element.data("message"),messageType:element.data("message-type")})});break;case"sign-out":element.on("click",function(){authenticationService.showModal({mode:"sign-out"})});break;case"modal-youtube-inshow":element.on("click",function(){$(function(){$("#modal-youtube-inshow").draggable({handle:".modal-header"}).resizable()})});break;case"user-popup":element.jqDropdown("attach","#dropdown-user-info");element.on("click",function(){$("#dropdown-user-info").data("user-id",attrs.userId*1);$("#dropdown-user-info").data("vip-id",attrs.vipId*1);$("#dropdown-user-info").data("schedule-id",attrs.scheduleId?attrs.scheduleId*1:undefined)});break;case"message-emoticon":element.jqDropdown("attach","#dropdown-message-emoticon");element.on("click",function(){$("#dropdown-message-emoticon").data("emoticon-target",attrs.emoticonTarget)});break;case"open-guild":element.on("click",function(){modalService.showDetailGuild({Id:attrs.id})});break;default:console.warn("ud-role: '"+attrs.udRole+"' is not declared")}}}}]);giasinhvienApp.directive("validateError",["$compile",function($compile){return{restrict:"E",scope:{target:"="},link:function(scope,element){var child=element.html().replace(new RegExp('when="',"g"),'ng-if="target.'),html="<div class='validate-error' ng-if='target.$invalid && (target.$touched || target.$$parentForm.$submitted)'>"+child+"<\/div>";element.replaceWith($compile(html)(scope))}}}]);giasinhvienApp.directive("validateSubmit",[function(){return{restrict:"A",link:function(scope,element,attributes){element.attr("novalidate","");element.bind("submit",function(e){e.preventDefault();element.data("$formController").$valid&&scope.$eval(attributes.validateSubmit)})}}}]);giasinhvienApp.filter("currentListSeatPrice",function(){return function(input,currentPrice){if(!currentPrice||input.constructor!==Array||isNaN(currentPrice))return input;var r=[];return $(input).each(function(i,x){x<=currentPrice||r.push(x)}),r}});giasinhvienApp.controller("modalAlertController",["$scope","$uibModalInstance","data",function($scope,$uibModalInstance,data){$scope.title=data.title;$scope.message=data.message;$scope.listButton=data.buttons;$scope.onButtonClick=function(index){var btn=$scope.listButton[index];typeof btn.onClick=="function"&&btn.onClick();btn.closeModal&&$uibModalInstance.close()}}]);giasinhvienApp.controller("modalBannerEventController",["$scope","$uibModalInstance","data","sessionService","webService",function($scope,$uibModalInstance,data,sessionService){$scope.openingShow={status:"loading",error:undefined};$scope.onClose=function(){$uibModalInstance.dismiss()};data.data&&($scope.newBannerImg=data.data.newBannerImage,$scope.newBannerLink=data.data.newBannerLink);sessionService.isReady(function(){})}]);giasinhvienApp.controller("modalChangePasswordController",["$scope","$uibModalInstance","data","sessionService","webService","authenticationService","Notification",function($scope,$uibModalInstance,data,sessionService,webService,authenticationService,Notification){$scope.changePassword={oldpass:undefined,repass:undefined,newrepass:undefined,isBusy:!1};$scope.UpdateNewPassWord=function(){if($scope.changePassword.isBusy=!0,$scope.changePassword.repass!=$scope.changePassword.newrepass){Notification.error("Nhập lại mật khẩu không đúng");$scope.changePassword.isBusy=!1;return}webService.call({type:"POST",name:"User_UpdateNewPassWord",data:{actionUserId:sessionService.userId(),oldPass:$scope.changePassword.oldpass,newPass:$scope.changePassword.repass,key:sessionService.key()},displayError:!0,onError:function(){$scope.changePassword.isBusy=!1},onSuccess:function(){Notification.success("Đổi Mật Khẩu Thành Công !");$scope.changePassword.isBusy=!1;$scope.changePassword.oldpass="";$scope.changePassword.repass="";$uibModalInstance.dismiss();$scope.$apply()}})};$scope.onClose=function(){$uibModalInstance.dismiss()}}]);giasinhvienApp.controller("modalDayCheckController",["$scope","$uibModalInstance","data","sessionService","webService","authenticationService","Notification",function($scope,$uibModalInstance,data,sessionService,webService,authenticationService,Notification){$scope.listDayCheck={Items:undefined,PageCount:undefined,status:"loading"};$scope.countDayCheck={Length:undefined,status:"loading"};$scope.onClose=function(){$uibModalInstance.dismiss()};webService.call({name:"User_GetListDaySignIn",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:5,key:sessionService.key()},onSuccess:function(r){$scope.listDayCheck.PageCount=r.PageCount;$scope.listDayCheck.Items=r.Items}});webService.call({name:"User_GetUserDaySignInReward",data:{actionUserId:sessionService.userId(),key:sessionService.key()},onSuccess:function(r){$scope.countDayCheck.Length=r.Result!=null?r.Result.SignInContinuesCount:0}});$scope.DoDaySignIn=function(){webService.call({type:"POST",name:"User_DoDaySignIn",data:{actionUserId:sessionService.userId(),key:sessionService.key()},displayError:!0,onSuccess:function(r){Notification.success("Bạn Báo Danh Thành Công !");$scope.countDayCheck.Length=r.Result.User_DaySignInReward.SignInContinuesCount}})}}]);giasinhvienApp.controller("modalDetailGuildController",["$scope","$rootScope","$uibModalInstance","sessionService","webService","data","Notification",function($scope,$rootScope,$uibModalInstance,sessionService,webService,data,Notification){$scope.openingShow={status:"loading",error:undefined};$scope.ListUserInGuild={Items:undefined,Items1:undefined,status:"loading",message:undefined,pageIndex:0,pageSize:20,nextList:!1,isBusy:!1};$scope.onClose=function(){$rootScope.$broadcast("onCloseDetailGuild");$uibModalInstance.dismiss()};$scope.onGetListUserInGuild=function(page){page>=0&&($scope.ListUserInGuild.pageIndex=$scope.ListUserInGuild.pageIndex+1);webService.call({name:"User_GetListUserInGuild",type:"POST",data:{creatorId:sessionService.userId(),pageIndex:$scope.ListUserInGuild.pageIndex,pageSize:$scope.ListUserInGuild.pageSize,guildId:data.Id,nameUser:"",key:sessionService.key()},onError:function(msg){$scope.ListUserInGuild.message=msg;$scope.ListUserInGuild.status="error"},onSuccess:function(r){$scope.ListUserInGuild.Items?$scope.ListUserInGuild.Items.concat(r.Items):$scope.ListUserInGuild.Items=r.Items;$scope.ListUserInGuild.status="loaded";$scope.ListUserInGuild.nextList=r.PageIndex+1===r.PageCount;$scope.$$phase||$scope.$apply()}});webService.call({name:"User_GetGuildInfo",type:"POST",data:{actionUserId:sessionService.userId(),guildId:data.Id,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.ListUserInGuild.Items1=r.Result;$scope.$$phase||$scope.$apply()}})};$scope.onUserSendRequestJoinGuild=function(){webService.call({name:"User_SendRequestJoinGuild",type:"POST",data:{actionUserId:sessionService.userId(),guildId:data.Id,userId:sessionService.userId(),key:sessionService.key()},displayError:!0,onError:function(){$scope.ListUserInGuild.isBusy=!1},onSuccess:function(){Notification.success("Yêu cầu vào gia tộc đã được gửi đi.");$scope.ListUserInGuild.isBusy=!1}});$scope.$$phase||$scope.$apply()};$scope.onWhatDetailUser=function(data){window.open("/user/"+data,"_blank")};sessionService.isReady(function(){$scope.onGetListUserInGuild()})}]);giasinhvienApp.controller("modalEditAvatarGuildController",["$scope","$rootScope","$uibModalInstance","sessionService","webService","data","Notification",function($scope,$rootScope,$uibModalInstance,sessionService,webService,data,Notification){$scope.uploadavatarguild={linkPhoto:undefined};$scope.onClose=function(){$uibModalInstance.dismiss()};$scope.UploadImage=function(){$(".image-cropper .cropit-image-input.hidden").trigger("click")};data.icongiatoc?($scope.title="Thay đổi icon gia tộc",$scope.class="icon"):$scope.title="Thay đổi ảnh gia tộc";$scope.EditAvarta=function(){var file_data,f,Nameicon,img,res;if(data.icongiatoc)if(img=$scope.uploadavatarguild.linkPhoto,img){if(file_data=$("#icon-gia-toc"),f=file_data.prop("files")[0],f)Nameicon=f.name;else{Notification.error("Vui lòng chọn lại icon gia tộc !");return}res=img.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,"");webService.call({type:"POST",name:"User_UploadFile",data:{actionUserId:sessionService.userId(),base64Photo:res,name:Nameicon,key:sessionService.key()},displayError:!0,onSuccess:function(r){$scope.url=r.Result;r.ErrorCode==null?webService.call({type:"POST",name:"User_UpdateGuild",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,name:null,description:null,photolink:null,avatar:$scope.url,key:sessionService.key()},onError:function(err){Notification.error(err)},onSuccess:function(a){$rootScope.$broadcast("editiconguild",{Items:a.Result});Notification.success("Đổi icoin Gia Tộc Thành Công !");$uibModalInstance.dismiss();$scope.$apply()}}):Notification.error("Bạn chưa chọn hình upload!");$scope.$apply()}})}else Notification.error("Bạn chưa chọn hình upload!");else img=$scope.uploadavatarguild.linkPhoto,img?(res=img.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""),webService.call({type:"POST",name:"User_UploadPhoto",data:{actionUserId:sessionService.userId(),base64Photo:res,key:sessionService.key()},displayError:!0,onSuccess:function(r){$scope.url=r.Result;r.ErrorCode==null?webService.call({type:"POST",name:"User_UpdateGuild",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,name:null,description:null,photolink:$scope.url,key:sessionService.key()},onError:function(err){Notification.error(err)},onSuccess:function(a){$rootScope.$broadcast("editavatarguild",{Items:a.Result});Notification.success("Đổi Avarta Gia Tộc Thành Công !");$uibModalInstance.dismiss();$scope.$apply()}}):Notification.error("Bạn chưa chọn hình upload!");$scope.$apply()}})):Notification.error("Bạn chưa chọn hình upload!")}}]);giasinhvienApp.controller("modalEditGuildController",["$scope","$rootScope","$uibModalInstance","sessionService","webService","data","Notification",function($scope,$rootScope,$uibModalInstance,sessionService,webService,data,Notification){$scope.uploadavatarguild={linkPhoto:undefined};$scope.UserGuildInfo={name:data.GuildInfo.Guild.Name,description:data.GuildInfo.Guild.Description,photolink:data.GuildInfo.Guild.PhotoLink,Avatar:data.GuildInfo.Guild.Avatar,isBusy:!1};$scope.onClose=function(){$uibModalInstance.dismiss()};$scope.EditAvarta=function(){var avatar_giatoc=$("#avatar-giatoc"),f=avatar_giatoc.prop("files")[0],icon_giatoc=$("#icon-giatoc"),f1=icon_giatoc.prop("files")[0],Nameicon,base64Photo;if(f&&f1){var base64Photo=$scope.UserGuildInfo.Avatar.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""),Nameicon=f1.name,base64Photo1=$scope.UserGuildInfo.photolink.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,"");webService.call({type:"POST",name:"User_UploadFile",data:{actionUserId:sessionService.userId(),base64Photo:base64Photo,name:Nameicon,key:sessionService.key()},displayError:!0,onSuccess:function(r){$scope.url_icon=r.Result;webService.call({type:"POST",name:"User_UploadPhoto",data:{actionUserId:sessionService.userId(),base64Photo:base64Photo1,key:sessionService.key()},displayError:!0,onSuccess:function(r){$scope.url_avatar=r.Result;$scope.uploadguild($scope.url_avatar,$scope.url_icon)}});$scope.$apply()}})}else f||f1?!f&&f1?(Nameicon=f1.name,base64Photo=$scope.UserGuildInfo.Avatar.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""),webService.call({type:"POST",name:"User_UploadFile",data:{actionUserId:sessionService.userId(),base64Photo:base64Photo,name:Nameicon,key:sessionService.key()},displayError:!0,onSuccess:function(r){$scope.url_icon=r.Result;$scope.uploadguild($scope.UserGuildInfo.photolink,$scope.url_icon);$scope.$apply()}})):f&&!f1&&(base64Photo=$scope.UserGuildInfo.photolink.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""),webService.call({type:"POST",name:"User_UploadPhoto",data:{actionUserId:sessionService.userId(),base64Photo:base64Photo,key:sessionService.key()},displayError:!0,onSuccess:function(r){$scope.url_avatar=r.Result;$scope.uploadguild($scope.url_avatar,$scope.UserGuildInfo.Avatar)}})):$scope.uploadguild($scope.UserGuildInfo.photolink,$scope.UserGuildInfo.Avatar)};$scope.uploadguild=function(avatar,icon){$scope.UserGuildInfo.isBusy=!0;webService.call({type:"POST",name:"User_UpdateGuild",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,name:$scope.UserGuildInfo.name,description:$scope.UserGuildInfo.description,photolink:avatar,avatar:icon,key:sessionService.key()},onError:function(err){Notification.error(err);$scope.UserGuildInfo.isBusy=!1},onSuccess:function(a){$scope.UserGuildInfo.isBusy=!1;$rootScope.$broadcast("onEditGuild",{Items:a.Result});Notification.success("Đổi thông tin gia tộc thành công !");$uibModalInstance.dismiss();$scope.$apply()}})}}]);giasinhvienApp.controller("modalFacebookLiveController",["$scope","$uibModalInstance","data","Notification","webService","sessionService","apiService",function($scope,$uibModalInstance,data,notification,webService,sessionService,apiService){$scope.customStream={host:undefined,key:undefined};$scope.message=undefined;$scope.pageId=undefined;$scope.locations={list:[{id:0,text:"Trang cá nhân"},{id:1,text:"Fan Page của tôi"},{id:2,text:"Facebook Stream Link"}],selected:undefined};$scope.liststatus=[{status:"Mọi người vào #Teenidol chơi với e nhé! Muốn xem e đẹp hơn, âm thanh hay hơn và ko lag thì mọi người vào link này nhé! :* \nhttps://teenidol.vn/show/"+data.showId+"\n#livestreamteenidol"},{status:"Đố ai định nghĩa được chữ yêu \nCó khó gì đâu mà hỏi nhiều... \nVào #Teenidol xem em diễn \nNhìn thấy em cười thế là yêu! :*\nhttps://teenidol.vn/show/"+data.showId+"\n#livestreamteenidol"},{status:"Để tiết kiệm tiền bạc và thời gian, chúng ta hãy... yêu nhau từ cái nhìn đầu tiên! :v \nMọi người vào chơi với e nhé! :*\nhttps://teenidol.vn/show/"+data.showId+"\n#Teenidol #livestreamteenidol"},{status:"Đẹp cũng chỉ để yêu, yêu kiều cũng chỉ để ngắm <3 <3 \nNhưng … vừa đẹp vừa đằm thắm thì say đắm cả đời ! :v \nMọi người vào chơi với e nhé! :*\nhttps://teenidol.vn/show/"+data.showId+"\n#Teenidol #livestreamteenidol"},{status:"Khi bạn buồn hãy gọi cho tôi, tôi không hứa sẽ làm bạn cười, nhưng tôi hứa … sẽ cười vào mặt bạn! =)) \nNói chứ ai buồn vào show coi e diễn là vui lại ngay mà! :*\nhttps://teenidol.vn/show/"+data.showId+"\n#Teenidol #livestreamteenidol"},{status:"Giang hồ hiểm ác em không sợ, chỉ sợ lên diễn không ai xem!:v \nBà coan cô bác zô show chơi với em nhé! :*\nhttps://teenidol.vn/show/"+data.showId+"\n#Teenidol #livestreamteenidol"},{status:"Em không hát hay :v \nNhưng em hay hát\nVào chơi với em nha <3\nhttps://teenidol.vn/show/"+data.showId+"\n#Teenidol #livestreamteenidol"},{status:"Vào https://teenidol.vn/show/"+data.showId+" quẫy cùng em nào <3 <3 <3\n#Teenidol #livestreamteenidol"},{status:"Anhonxeo :* Sáng zui zẻ, vào nghe em hát nhé <3 <3 <3\nhttps://teenidol.vn/show/"+data.showId+"\n#Teenidol #livestreamteenidol"},{status:"Lướt FB làm giề??? VÀOhttps://teenidol.vn/show/"+data.showId+" chém gió với chế nè! <3\n#Teenidol #livestreamteenidol"},{status:"Nghĩ suy gì nữa mà không vàohttps://teenidol.vn/show/"+data.showId+" đi nào!!! <3 <3 <3\n#Teenidol #livestreamteenidol"}];$scope.locations.selected=$scope.locations.list[0];$scope.isBusy=!1;$scope.onClose=function(){$uibModalInstance.dismiss()};$scope.onLive=function(){if($scope.locations.selected.id===1&&!$scope.pageId){notification.error("Bạn chưa nhập Page Id");return}if($scope.locations.selected.id===2&&(!$scope.customStream.host||!$scope.customStream.key)){notification.error("Bạn chưa nhập thông tin Stream của Facebook");return}if($scope.locations.selected.id===2){data.player.jsCallStartStream1({host:$scope.customStream.host,chanel:$scope.customStream.key});$uibModalInstance.close({isCustom:!0});return}var action=function(accessToken){apiService.post({module:"Teenidol.Admin.LiveFacebook",method:"GoLiveSelf",data:{starId:sessionService.userId(),scheduleId:data.scheduleId,accessToken:accessToken,postStatus:$scope.message,session:sessionService.key()},displayError:!0,onError:function(){$scope.isBusy=!1},onSuccess:function(r){$scope.isBusy=!1;$scope.$$phase||$scope.$apply();data.player.jsCallStartStream1({host:r.Data.LiveLink.substr(0,r.Data.LiveLink.lastIndexOf("/")),chanel:r.Data.LiveLink.substr(r.Data.LiveLink.lastIndexOf("/")+1)});$uibModalInstance.close(r.Data)}})};$scope.isBusy=!0;$scope.$$phase||$scope.$apply();FB.getLoginStatus(function(response){response.status==="connected"?action(response.authResponse.accessToken):FB.login(function(response){if(response.error){notification.error(response.error.message);return}action(response.authResponse.accessToken)},{scope:"public_profile,email,publish_actions,manage_pages,publish_pages",auth_type:"reauthenticate"})})}}]);giasinhvienApp.controller("modalGoldMineController",["$scope","$uibModalInstance","data","sessionService","webService","modalService","Notification",function($scope,$uibModalInstance,data,sessionService,webService,modalService,Notification){$scope.UserGuildInfo={Items:undefined};$scope.showInfoTower=function(){webService.call({name:"Guild_GetTowers",type:"POST",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,key:sessionService.key()},onError:function(){},onSuccess:function(rs){modalService.showInfoTower({data:rs.Result[1]})}})};$scope.onReceiveBonusCoin=function(){webService.call({name:"User_ReceiveBonusCoin",type:"POST",data:{actionUserId:sessionService.userId(),key:sessionService.key()},onError:function(){},onSuccess:function(){Notification.success("Nhận thành công");$uibModalInstance.dismiss()}})};$scope.onClose=function(){$uibModalInstance.dismiss()};sessionService.isReady(function(){webService.call({name:"User_GetUserGuildInfo",type:"POST",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,userId:sessionService.userId(),key:sessionService.key()},onError:function(){},onSuccess:function(rs){console.log(rs);$scope.UserGuildInfo.Items=rs.Result;$scope.$$phase||$scope.$apply}})})}]);giasinhvienApp.controller("modalGuildMasterController",["$scope","$uibModalInstance","data","sessionService","webService","modalService","Notification","$rootScope",function($scope,$uibModalInstance,data,sessionService,webService,modalService,Notification){$scope.sessionService=sessionService;$scope.ListUserInGuild={Items:undefined,Items1:undefined,status:"loading",message:undefined,pageIndex:0,pageSize:20,nextList:!0};$scope.ListUserJoinGuild={Items:undefined,status:"loading",message:undefined,pageIndex:0,pageSize:20,nextList:!1};$scope.listStar={Items:undefined,status:"loading"};$scope.support='<p align="left">- Sử dụng RUBY hoặc TIM trong show diễn của idol bất kì sẽ giúp tăng cống hiến cho gia tộc.<\/p><p align="left">- Cống hiến giúp tăng level gia tộc, gia tộc level càng cao giới hạn số thành viên sẽ càng tăng.<\/p><p align="left">- Top 3 user cống hiến nhiều nhất của gia tộc sẽ là trưởng lão của gia tộc (cập nhật lúc 11h59 chủ nhật hàng tuần).<\/p>';$scope.ListUserInGuild.remove=function(userId){$($scope.ListUserInGuild.Items).each(function(i,x){if(x.User.Id===userId)return $scope.ListUserInGuild.Items.splice(i,1),!1});$scope.$$phase||$scope.$apply()};$scope.ListUserJoinGuild.remove=function(userId){$($scope.ListUserJoinGuild.Items).each(function(i,x){if(x.User.Id===userId)return $scope.ListUserJoinGuild.Items.splice(i,1),!1});$scope.$$phase||$scope.$apply()};data.data&&($scope.nexlevel=data.data);$scope.onClose=function(){$uibModalInstance.dismiss()};$scope.onUserKickOutUser=function(id){var massage;massage=sessionService.data().user.User.Id==id?"Bạn chắc chắn muốn rời khỏi gia tộc này chứ?":"Bạn chắc chắn muốn kick người này chứ?";modalService.showAlert({title:"Xác nhận",message:massage,buttons:[{text:"Không",style:"btn-default",closeModal:!0},{text:"Có",style:"btn-primary",closeModal:!0,onClick:function(){webService.call({name:"User_KickOutUser",type:"POST",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,userId:id,key:sessionService.key()},onError:function(err,msg){Notification.error(msg)},onSuccess:function(){sessionService.data().user.User.Id==id?(Notification.success("Rút khỏi gia tộc thành công"),window.location="/guild"):Notification.success("Kích ra khỏi gia tộc thành công");$(".get-reward").tooltip("hide");$scope.ListUserInGuild.remove(id);$scope.$$phase||$scope.$apply()}})}}]})};$scope.onGetListUserInGuild=function(page){if(page>=0&&($scope.ListUserInGuild.pageIndex=$scope.ListUserJoinGuild.pageIndex+1),!sessionService.isSigned()){$scope.ListUserInGuild.status="error";$scope.ListUserInGuild.message="Bạn cần đăng nhập để xem thông tin gia tộc";return}if(sessionService.data().user.Guild==null){$scope.ListUserInGuild.status="error";$scope.ListUserInGuild.message="Hiện bạn chưa gia nhập gia tộc nào";return}webService.call({name:"User_GetListUserInGuild",type:"POST",data:{creatorId:sessionService.userId(),pageIndex:$scope.ListUserInGuild.pageIndex,pageSize:$scope.ListUserInGuild.pageSize,guildId:sessionService.data().user.Guild.Id,nameUser:"",key:sessionService.key()},onError:function(msg){$scope.ListUserInGuild.message=msg;$scope.ListUserInGuild.status="error"},onSuccess:function(r){$scope.ListUserInGuild.Items?$scope.ListUserInGuild.Items.concat(r.Items):$scope.ListUserInGuild.Items=r.Items;$scope.ListUserInGuild.status="loaded";$scope.ListUserInGuild.nextList=r.PageIndex+1===r.PageCount;$scope.Total=r.Total;$scope.Totalmax=r.Total;$scope.$$phase||$scope.$apply()}});webService.call({name:"User_GetGuildInfo",type:"POST",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.ListUserInGuild.Items1=r.Result;$scope.phantram=r.Result.Guild.Ruby>0?(r.Result.Guild.Ruby-r.Result.GuildLevel.Point)/(r.Result.NextLevel.Point-r.Result.GuildLevel.Point)*100:0;$scope.$$phase||$scope.$apply()}})};$scope.showInfoTower=function(){webService.call({name:"Guild_GetTowers",type:"POST",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,key:sessionService.key()},onError:function(){},onSuccess:function(rs){modalService.showInfoTower({data:rs.Result[0]})}})};$scope.onGetListUserJoinGuild=function(page){if(page>=0&&($scope.ListUserJoinGuild.pageIndex=$scope.ListUserJoinGuild.pageIndex+1),!sessionService.isSigned()){$scope.ListUserJoinGuild.status="error";$scope.ListUserJoinGuild.message="Bạn cần đăng nhập để xem thông tin gia tộc";return}webService.call({name:"User_GetListUserJoinGuild",type:"POST",data:{creatorId:sessionService.userId(),pageIndex:$scope.ListUserJoinGuild.pageIndex,pageSize:$scope.ListUserJoinGuild.pageSize,guildId:sessionService.data().user.Guild.Id,nameUser:"",key:sessionService.key()},onError:function(msg){$scope.ListUserJoinGuild.message=msg;$scope.ListUserJoinGuild.status="error"},onSuccess:function(r){$scope.ListUserJoinGuild.Items?$scope.ListUserJoinGuild.Items.concat(r.Items):$scope.ListUserJoinGuild.Items=r.Items;$scope.ListUserJoinGuild.nextList=r.PageIndex===r.PageCount;$scope.ListUserJoinGuild.status="loaded";$scope.$$phase||$scope.$apply()}})};$scope.onAcceptUserJoinGuild=function(id){webService.call({name:"User_AcceptUserJoinGuild",type:"POST",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,userId:id,key:sessionService.key()},onError:function(error,msg){error==5||error==6?Notification.error(msg):(Notification.error(msg),$scope.ListUserJoinGuild.remove(id))},onSuccess:function(){Notification.success("Chấp nhận user vào gia tộc thành công");$scope.onGetListUserInGuild();$scope.ListUserJoinGuild.remove(id)}})};$scope.onDeclineUserJoinGuild=function(id){webService.call({name:"User_DeclineUserJoinGuild",type:"POST",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,userId:id,key:sessionService.key()},onError:function(){Notification.error("Có lỗi xin thử lại")},onSuccess:function(){Notification.success("Không chấp nhận thành công");$scope.ListUserJoinGuild.remove(id)}})};$scope.onGetListIdolInGuild=function(){webService.call({name:"User_GetListIdolInGuild",type:"POST",data:{creatorId:sessionService.userId(),pageIndex:0,pageSize:4,guildId:sessionService.data().user.Guild.Id,nameUser:null,key:sessionService.key()},onSuccess:function(r){$scope.listStar.Items=r.Items;$scope.$apply()}})};$scope.$on("editavatarguild",function(event,args){$scope.ListUserInGuild.Items1.Guild.PhotoLink=args.Items.PhotoLink;$scope.$$phase||$scope.$apply});$scope.openEditAvatar=function(){modalService.showEditAvatarGuild({})}}]);giasinhvienApp.controller("modalIdolDoneMissionController",["$scope","$uibModalInstance","data","sessionService","webService","modalService","Notification",function($scope,$uibModalInstance,data,sessionService,webService,modalService,Notification){$scope.sessionService=sessionService;$scope.RewardIdol={Items:undefined,status:"loading"};$scope.onClose=function(){$uibModalInstance.dismiss()};$scope.onUserDoneIdolQuest=function(){webService.call({name:"User_DoneIdolQuest",type:"POST",data:{actionUserId:sessionService.userId(),scheduleId:data.scheduleId,key:sessionService.key()},onError:function(error){Notification.error(error)},onSuccess:function(){Notification.success("Nhận thưởng thành công");$scope.onClose()}})};sessionService.isReady(function(){webService.call({name:"User_GetRewardInfo",type:"GET",data:{actionUserId:sessionService.userId(),starId:data.starId,key:sessionService.key()},onError:function(error){Notification.error(error)},onSuccess:function(rs){$scope.RewardIdol.Items=rs.Result}})})}]);giasinhvienApp.controller("modalIdolMissionController",["$scope","$uibModalInstance","data","sessionService","webService","modalService","Notification",function($scope,$uibModalInstance,data,sessionService,webService){$scope.onClose=function(){$uibModalInstance.dismiss()};$scope.level={Items:undefined,level:1,numberlevel:undefined,checked:0};$scope.showMission={Items:undefined,status:"loading"};console.log(data);data&&($scope.showMission.Items=data,$scope.level.numberlevel=data.questInfo.Level-1);webService.call({name:"Config_GetConfig",type:"GET",data:{actionUserId:sessionService.userId(),value:"IdolQuestMaxLevel",key:sessionService.key()},onError:function(){},onSuccess:function(rs){for(var number=rs.Result.Value*1,res=[],i=0;i<number;i++)res.push(i);$scope.level.Items=res;$scope.$$phase||$scope.$apply()}});sessionService.isReady(function(){})}]);giasinhvienApp.controller("modalIframeRechargeCoinController",["$scope","$uibModalInstance","sessionService",function($scope,$uibModalInstance,sessionService){$scope.openingShow={status:"loading",error:undefined};$scope.onClose=function(){$uibModalInstance.dismiss()};sessionService.isReady(function(){})}]);giasinhvienApp.controller("modalInfoTowerController",["$scope","sessionService","webService","helperService","Notification","modalService","$uibModalInstance","data",function($scope,sessionService,webService,helperService,Notification,modalService,$uibModalInstance,data){$scope.isShowButton={status:"loading",isBusy:!1};$scope.amount={Items:undefined};$scope.listMoney=[{value:10},{value:50},{value:100},{value:150},{value:200},{value:300},{value:500},{value:1e3},];$scope.isShow=function(){$scope.isShowButton.isBusy=!0};data.data&&($scope.infoTower=data.data,$scope.phantram=$scope.infoTower.BankAccount.Balance>0&&$scope.infoTower.NextLevel?$scope.infoTower.BankAccount.Balance/$scope.infoTower.NextLevel.Coin*100:0);$scope.onDonateTower=function(){if(!$scope.amount.Items){Notification.error("Bạn chưa chọn tiền cống hiến !");return}webService.call({name:"User_DonateTower",type:"POST",data:{actionUserId:sessionService.userId(),towerId:$scope.infoTower.Tower.Id,guildId:sessionService.data().user.Guild.Id,amount:$scope.amount.Items,key:sessionService.key()},onError:function(error,msg){Notification.error(msg)},onSuccess:function(r){$scope.infoTower=r.Result;Notification.success("Cống hiến thành công");$uibModalInstance.dismiss()}})};$scope.onClose=function(){$uibModalInstance.dismiss()}}]);giasinhvienApp.controller("modalListUserJoinController",["$scope","$uibModalInstance","data","sessionService","webService","modalService","Notification","$rootScope",function($scope,$uibModalInstance,data,sessionService,webService,modalService,Notification){$scope.sessionService=sessionService;$scope.ListUserJoinGuild={Items:undefined,status:"loading",message:undefined,pageIndex:0,pageSize:20,nextList:!1};$scope.ListUserJoinGuild.remove=function(userId){$($scope.ListUserJoinGuild.Items).each(function(i,x){if(x.User.Id===userId)return $scope.ListUserJoinGuild.Items.splice(i,1),!1});$scope.$$phase||$scope.$apply()};$scope.onGetListUserJoinGuild=function(page){page>=0&&($scope.ListUserJoinGuild.pageIndex=$scope.ListUserJoinGuild.pageIndex+1);webService.call({name:"User_GetListUserJoinGuild",type:"POST",data:{creatorId:sessionService.userId(),pageIndex:$scope.ListUserJoinGuild.pageIndex,pageSize:$scope.ListUserJoinGuild.pageSize,guildId:sessionService.data().user.Guild.Id,nameUser:"",key:sessionService.key()},onError:function(msg){$scope.ListUserJoinGuild.message=msg;$scope.ListUserJoinGuild.status="error"},onSuccess:function(r){$scope.ListUserJoinGuild.Items?$scope.ListUserJoinGuild.Items.concat(r.Items):$scope.ListUserJoinGuild.Items=r.Items;$scope.ListUserJoinGuild.nextList=r.PageIndex===r.PageCount;$scope.ListUserJoinGuild.status="loaded";$scope.$$phase||$scope.$apply()}})};$scope.onAcceptUserJoinGuild=function(id){webService.call({name:"User_AcceptUserJoinGuild",type:"POST",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,userId:id,key:sessionService.key()},onError:function(error,msg){error==5||error==6?Notification.error(msg):(Notification.error(msg),$scope.ListUserJoinGuild.remove(id))},onSuccess:function(){Notification.success("Chấp nhận user vào gia tộc thành công");$scope.ListUserJoinGuild.remove(id)}})};$scope.onDeclineUserJoinGuild=function(id){webService.call({name:"User_DeclineUserJoinGuild",type:"POST",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,userId:id,key:sessionService.key()},onError:function(){Notification.error("Có lỗi xin thử lại")},onSuccess:function(){Notification.success("Không chấp nhận thành công");$scope.ListUserJoinGuild.remove(id)}})};sessionService.isReady(function(){$scope.onGetListUserJoinGuild()})}]);giasinhvienApp.controller("modalPopupEventController",["$scope","$uibModalInstance","$timeout","data","sessionService","webService",function($scope,$uibModalInstance,$timeout,data){$scope.PopupEvent={titleUp:undefined,titleItem:undefined,PhotoLink:undefined,PromotionName:undefined};$scope.onClose=function(){$uibModalInstance.dismiss()};data&&($scope.PopupEvent={titleUp:data.titleUp,titleItem:data.titleItem,PhotoLink:data.PhotoLink,PromotionName:data.PromotionName},$scope.countGift=data.PhotoLink.length,$timeout(function(){$uibModalInstance.dismiss();$("#PromotionValueDescription").remove()},2e4),$timeout(function(){$("#bannerCarousel").carousel({interval:3e3})},1500));$scope.$on("$viewContentLoaded",function(){})}]);giasinhvienApp.controller("modalRankGuildController",["$scope","$routeParams","$log","sessionService","webService","helperService","Notification","modalService","$uibModalInstance",function($scope,$routeParams,$log,sessionService,webService,helperService,Notification,modalService,$uibModalInstance){$scope.ListguildRank={status:"loading",Items1:undefined,Items2:undefined,Items3:undefined,Items4:undefined};$scope.onClose=function(){$uibModalInstance.dismiss()};$scope.onUserKickOutUser=function(id){webService.call({name:"User_KickOutUser",type:"POST",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,userId:id,key:sessionService.key()},onError:function(){notificationService.screenNotification.error("Có lỗi xin thử lại")},onSuccess:function(){notificationService.screenNotification.success("Bạn đã rời khỏi gia tộc");$scope.ListUserInGuild.remove(id)}})};sessionService.isReady(function(){webService.call({name:"User_GetListGuild",type:"POST",data:{creatorId:sessionService.userId(),pageIndex:0,pageSize:200,nameGuild:"",key:sessionService.key()},onError:function(msg){$scope.ListguildRank.message=msg;$scope.ListguildRank.status="error"},onSuccess:function(r){$scope.Total=r.Total;$scope.ListguildRank.status="loaded";$scope.ListguildRank.Items1=r.Items[0];$scope.ListguildRank.Items2=r.Items[1];$scope.ListguildRank.Items3=r.Items[2];$scope.ListguildRank.Items4=r.Items.slice(3,100);$scope.$$phase||$scope.$apply()}})})}]);giasinhvienApp.controller("modalRechargeCoinController",["$scope","$uibModalInstance","data","sessionService","webService","Notification","helperService","formService","$window","modalService","$timeout",function($scope,$uibModalInstance,data,sessionService,webService,Notification,helperService,formService,$window,modalService){$scope.rechargeCoin={card:{status:"loading",message:undefined,isBusy:!1},bank:{status:"loading",message:undefined,isBusy:!1},visa:{money:undefined,isBusy:!1},teenidol:{status:"loading",message:undefined,isBusy:!1}};$scope.IsSelected=!1;$scope.sessionService=sessionService;$scope.helper=helperService;$scope.onClose=function(){$uibModalInstance.dismiss()};$scope.onRechargeCoinCardLoad=function(){$scope.rechargeCoin.card.status="loading";webService.call({name:"GetListSmsTypes",data:{actionUserId:sessionService.userId(),key:sessionService.key()},onError:function(errorCode,message){$scope.rechargeCoin.card.status="error";$scope.rechargeCoin.card.message=message},onSuccess:function(r){$scope.rechargeCoin.card.list=[];$(r.Result).each(function(i,x){$scope.rechargeCoin.card.list.push({id:x.Value,name:x.Name,photo:"/Content/Image/Card/"+x.Name+".png"})});$scope.rechargeCoin.card.type=$scope.rechargeCoin.card.list[0].id;$scope.rechargeCoin.card.status="loaded"}})};$scope.onRechargeCoinBankLoad=function(){$scope.rechargeCoin.bank.status="loading";webService.call({name:"GetBankInfo",data:{actionUserId:sessionService.userId(),key:sessionService.key()},onError:function(errorCode,message){$scope.rechargeCoin.bank.status="error";$scope.rechargeCoin.bank.message=message},onSuccess:function(r){$(r.ListMethod).each(function(i){i===0?r.ListMethod[i].Name="Thẻ ATM nội địa":i===1&&(r.ListMethod[i].Name="Thẻ tín dụng quốc tế")});$scope.rechargeCoin.bank.minimumMoney=r.MinimumMoney;$scope.rechargeCoin.bank.bonusCoinPercent=r.BonusCoinPercent;$scope.rechargeCoin.bank.listMethod=r.ListMethod;$scope.rechargeCoin.bank.currentMethodId=$scope.rechargeCoin.bank.listMethod[0].Method;$scope.rechargeCoin.bank.currentBankId=$scope.rechargeCoin.bank.listMethod[0].ListBank[0].Id;$scope.rechargeCoin.bank.status="loaded";$scope.$apply()}})};$scope.onRechargeCoinCardSubmit=function(){var isUseVoucher;$scope.rechargeCoin.card.isBusy=!0;isUseVoucher=!1;$scope.rechargeCoin.card.makhyenmai&&(isUseVoucher=!0);webService.call({type:"POST",name:"User_DoPayment",data:{actionUserId:sessionService.userId(),type:$scope.rechargeCoin.card.type,cardSerial:$scope.rechargeCoin.card.serial,cardPin:$scope.rechargeCoin.card.pin,code:$scope.rechargeCoin.card.makhyenmai,isUseVoucher:isUseVoucher,key:sessionService.key()},displayError:!0,onError:function(){$scope.rechargeCoin.card.isBusy=!1},onSuccess:function(r){$scope.rechargeCoin.card.isBusy=!1;r.Result.Amount>99e3&&modalService.showIframeRechargeCoin({});sessionService.reload();$scope.rechargeCoin.card.type=$scope.rechargeCoin.card.list[0].id;$scope.rechargeCoin.card.pin=undefined;$scope.rechargeCoin.card.serial=undefined;Notification.success("Nạp tiền thành công");$scope.rechargeCoin.card.serial="";$scope.rechargeCoin.card.pin="";$scope.rechargeCoin.card.makhyenmai="";$scope.$apply()}})};$scope.onRechargeCoinBankSubmit=function(){var isUseVoucher;if($scope.rechargeCoin.bank.isBusy=!0,$scope.rechargeCoin.bank.currentBankId==="number"){Notification.error("Bạn chưa chọn phương thức thanh toán.");$scope.rechargeCoin.bank.isBusy=!1;return}if($scope.rechargeCoin.bank.money<$scope.rechargeCoin.bank.minimumMoney){Notification.error("Số tiền phải >= "+formatNumber($scope.rechargeCoin.bank.minimumMoney)+".");$scope.rechargeCoin.bank.isBusy=!1;return}isUseVoucher=!1;$scope.rechargeCoin.bank.makhyenmai&&(isUseVoucher=!0);webService.call({type:"POST",name:"ChargeBank",data:{actionUserId:sessionService.userId(),totalAmount:$scope.rechargeCoin.bank.money,paymentMethodId:$scope.rechargeCoin.bank.currentBankId,isUseVoucher:isUseVoucher,code:$scope.rechargeCoin.bank.khuyenmai,key:sessionService.key()},displayError:!0,onError:function(){$scope.rechargeCoin.bank.isBusy=!1;Notification.error(messsage)},onSuccess:function(r){$scope.rechargeCoin.bank.isBusy=!1;$scope.rechargeCoin.bank.money="";$scope.rechargeCoin.bank.khuyenmai="";modalService.showAlert({title:"Nạp tiền",message:"Chúng tôi đã chuyển thao tác cho BaoKim, xin hãy tiếp tục quá trình nạp tiền tại đó.<br/><br/>Nếu bạn không thấy trang web BaoKim được mở, rất có thể là do hệ thống chặn pop-up tại trình duyệt ở mấy bạn. Xin hãy cho phép TeenIdol được sử dụng popup hoặc <a href='"+r.Result+"' target='_blank'>Click đây để mở web BaoKim<\/a>",buttons:[{text:"OK",style:"btn-primary"}]});$window.open(r.Result,"_blank")}});$scope.$$phase||$scope.$apply()};$scope.onVisa=function($event){var btn=$($event.target).find(".btn");if(!$scope.rechargeCoin.visa.money){Notification.error("Xin nhập số tiền");return}$scope.rechargeCoin.visa.isBusy=!0;webService.call({type:"POST",name:"ChargeVisa",data:{actionUserId:sessionService.userId(),money:$scope.rechargeCoin.visa.money,promoCode:null,platform:1,key:sessionService.key()},displayError:!0,onError:function(){$scope.rechargeCoin.visa.isBusy=!1},onSuccess:function(r){$scope.rechargeCoin.visa.isBusy=!1;modalService.showAlert({title:"Nạp tiền",message:"Chúng tôi đã chuyển thao tác cho 1Pay Global Bank, xin hãy tiếp tục quá trình nạp tiền tại đó.<br/><br/>Nếu bạn không thấy trang web của 1Pay Global Bank được mở, <a href='"+r.Result.PayUrl+"' target='_blank'>Xin click vào đây<\/a>",buttons:[{text:"OK",style:"btn-primary",closeModal:!0}]});$window.open(r.Result.PayUrl,"_blank");console.log(r.Result.PayUrl)}})};$scope.onRechargeCoinTeenidol=function(){$scope.rechargeCoin.teenidol.isBusy=!0;webService.call({type:"POST",name:"User_UseVoucher",data:{actionUserId:sessionService.userId(),code:$scope.rechargeCoin.teenidol.pin,serial:$scope.rechargeCoin.teenidol.serial,key:sessionService.key()},displayError:!0,onError:function(){$scope.rechargeCoin.teenidol.isBusy=!1},onSuccess:function(r){$scope.rechargeCoin.teenidol.isBusy=!1;$scope.testEvent=r.Extra;r.Extra!=null&&$("#modal-up-event").modal("show");sessionService.reload();$scope.rechargeCoin.card.type=$scope.rechargeCoin.card.list[0].id;$scope.rechargeCoin.card.pin=undefined;$scope.rechargeCoin.card.serial=undefined;Notification.success("Nạp tiền thành công");$scope.rechargeCoin.teenidol.serial="";$scope.rechargeCoin.teenidol.pin="";$scope.$apply()}})};$scope.onIsSelected=function(){$scope.IsSelected=!0;$scope.$$phase||$scope.$apply()}}]);giasinhvienApp.controller("modalRegisterstarController",["$scope","$uibModalInstance","data","sessionService","webService","Notification",function($scope,$uibModalInstance,data,sessionService,webService,Notification){$scope.register={email:undefined,name:undefined,phone:undefined,youtube:undefined,facebook:undefined,talent:undefined,isBusy:!1};$scope.onClose=function(){$uibModalInstance.dismiss()};$scope.onRegisterStar=function(){if($scope.register.isBusy=!0,!$scope.register.name||!$scope.register.phone||!$scope.register.email){$scope.register.email||Notification.error("Bạn chưa nhập email");$scope.register.name||Notification.error("Bạn chưa nhập tên");$scope.register.phone||Notification.error("Bạn chưa nhập số điện thoại");return}webService.call({type:"POST",name:"Star_RegisterStar",data:{actionUserId:sessionService.userId(),name:$scope.register.name,phone:$scope.register.phone,email:$scope.register.email,facebookLink:$scope.register.facebook,youtubeLink:$scope.register.youtube,talenDescription:$scope.register.talent,key:sessionService.key()},displayError:!0,onError:function(){$scope.register.isBusy=!1;return},onSuccess:function(){Notification.success("Cảm ơn ban đã đăng ký làm idol . Teenidol sẽ liên lạc với bạn sớm nhất !");$uibModalInstance.dismiss();$scope.register.isBusy=!1}})}}]);giasinhvienApp.controller("modalReportController",["$scope","$uibModalInstance","data","sessionService","webService","Notification","data","authenticationService",function($scope,$uibModalInstance,data,sessionService,webService,Notification,data,authenticationService){$scope.Content={Photo:undefined,Description:undefined,isBusy:!1};html2canvas(document.body,{onrendered:function(canvas){$scope.Content.Photo=canvas.toDataURL()}});$scope.onUserReportIdol=function(){if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}if(!$scope.Content.Photo){Notification.error("Bạn chưa chọn hình upload");return}if(!$scope.Content.Description){Notification.error("Bạn chưa mô tả thông tin báo xấu");return}var base64Photo=$scope.Content.Photo.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,"");webService.call({type:"POST",name:"User_ReportIdol",data:{actionUserId:sessionService.userId(),base64Photo:base64Photo,starId:data.data.starId,note:$scope.Content.Description,platform:1,key:sessionService.key()},displayError:!0,onSuccess:function(r){Notification.success(r.Message);$scope.onClose();$scope.Content={Photo:undefined,Description:undefined,isBusy:!1}}})};$scope.onClose=function(){$uibModalInstance.dismiss()}}]);giasinhvienApp.controller("modalShopGuildController",["$scope","$uibModalInstance","data","sessionService","webService","modalService",function($scope,$uibModalInstance,data,sessionService,webService,modalService){var pageindex=0;$scope.onClose=function(){$uibModalInstance.dismiss()};data.data&&($scope.nexlevel=data.data,$scope.phantram=$scope.nexlevel.BankAccount.Balance>0?$scope.nexlevel.NextLevel?$scope.nexlevel.BankAccount.Balance/$scope.nexlevel.NextLevel.Coin*100:0:0);$scope.showInfoTower=function(){webService.call({name:"Guild_GetTowers",type:"POST",data:{actionUserId:sessionService.userId(),guildId:sessionService.data().user.Guild.Id,key:sessionService.key()},onError:function(){},onSuccess:function(rs){modalService.showInfoTower({data:rs.Result[2]})}})};$scope.onLoadListItemCategories=function(){webService.call({name:"List_ItemCategories",data:{pageIndex:pageindex,pageSize:15,key:sessionService.key()},onSuccess:function(r){$scope.ListItemCatelogy=r.Items;array=[];var data={pageIndex:0,pageSize:15,key:sessionService.key(),categoryId:10,isNewVersion:!0,guildId:sessionService.data().user.Guild.Id};webService.call({name:"List_ItemsAnimationInStoreForGuild",data:data,onSuccess:function(r){$scope.list=r.Items;angular.forEach($scope.list,function(attr){array.push(attr)});$scope.ListShopCatelogy=r.Items;$scope.$apply()}});$scope.$apply()}})};$scope.onLoadShopItem=function(){var currentTab=$(".star-panel .tab-pane.active").attr("id"),nameService,data;switch(currentTab){default:case"shop-catelogy":if($scope.ListShopCatelogy)return;$scope.ListShopCatelogy={};$scope.onLoadListItemCategories();break;case"shop-vip":if($scope.ListShopVip)return;$scope.ListShopVip={};nameService="List_ItemsVipInStore";data={pageIndex:pageindex,pageSize:15,key:sessionService.key()};webService.call({name:nameService,data:data,onSuccess:function(r){console.log(r);$scope.ListShopVip=r.Items;$scope.$apply()}})}};sessionService.isReady(function(){$(".star-panel a[data-toggle='tab']").on("shown.bs.tab",function(){$scope.onLoadShopItem()});$(".star-panel .active a[data-toggle='tab']").trigger("shown.bs.tab")})}]);giasinhvienApp.controller("modalShowOpeningController",["$scope","$uibModalInstance","data","sessionService","webService","Notification",function($scope,$uibModalInstance,data,sessionService,webService){$scope.openingShow={status:"loading",error:undefined};$scope.onClose=function(){$uibModalInstance.dismiss()};$scope.onLoadShowOpening=function(){var now=new Date,start=now.setHours(0,0,0,0),end=now.setHours(23,59,59,999);webService.call({name:"ShowSchedule_GetListShowByStatus",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:999999,scheduleStatus:2,startTime:start,endTime:end,key:sessionService.key()},onError:function(errorCode,message){$scope.openingShow.status="error";$scope.openingShow.error=message;$scope.$apply()},onSuccess:function(r){$scope.openingShow.listItem=[];$(r.Items).each(function(i,x){x.ListShow[0].StarUser.Id!==sessionService.userId()&&$scope.openingShow.listItem.push(x)});$scope.openingShow.status="loaded";$scope.$apply()}})};sessionService.isReady(function(){$scope.onLoadShowOpening()})}]);giasinhvienApp.controller("modalShowRankController",["$scope","$uibModalInstance","data","sessionService","webService",function($scope,$uibModalInstance,data,sessionService,webService){$scope.showRank={currentStatus:"loading",currentError:undefined,listCurrent:undefined,allStatus:"loading",allError:undefined,listAll:undefined};$scope.onClose=function(){$uibModalInstance.dismiss()};data&&(webService.call({name:"User_GetListTopUserUseCoinInShow",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:10,scheduleId:data.data.scheduleId,showId:data.data.showId,starId:data.data.starId,startDate:-1,endDate:-1,key:sessionService.key()},onError:function(errorCode,message){$scope.showRank.currentStatus="error";$scope.showRank.currentError=message;$scope.$apply()},onSuccess:function(r){$scope.showRank.listCurrent=r.Items;$scope.showRank.currentStatus="loaded";$scope.$apply()}}),webService.call({name:"User_GetListTopUserUseCoinInShow",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:10,scheduleId:-1,showId:data.data.showId,starId:data.data.starId,startDate:-1,endDate:-1,key:sessionService.key()},onError:function(errorCode,message){$scope.showRank.allStatus="error";$scope.showRank.allError=message;$scope.$apply()},onSuccess:function(r){console.log(r);$scope.showRank.listAll=r.Items;$scope.showRank.allStatus="loaded";$scope.$apply()}}))}]);giasinhvienApp.controller("modalShowScheduleController",["$scope","$uibModalInstance","data","sessionService","webService","helperService",function($scope,$uibModalInstance,data,sessionService,webService,helperService){$scope.data=data.data;$scope.showSchedule={currentStatus:"loading",currentError:undefined,listCurrent:undefined,otherStatus:"loading",otherError:undefined,listOther:undefined};$scope.helper=helperService;$scope.onClose=function(){$uibModalInstance.dismiss()};$scope.onShowSchedule=function(){var now=new Date,startTime=new Date(now.getFullYear(),now.getMonth(),now.getDate()),endTime=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1,23,59,59),d=now.getDate();webService.call({name:"Star_GetListShowTime",data:{actionUserId:sessionService.userId(),starId:$scope.data.starId,pageIndex:0,pageSize:999999,key:sessionService.key()},onError:function(errorCode,message){$scope.showSchedule.currentStatus="error";$scope.showSchedule.currentError=message;$scope.$apply()},onSuccess:function(r){$scope.showSchedule.listCurrent=[[],[]];$(r.Items).each(function(i,x){var startTime=new Date(x.StarSchedule.StartTime),l=startTime.getUTCDate()===d?$scope.showSchedule.listCurrent[0]:$scope.showSchedule.listCurrent[1];l[startTime.getUTCHours()]||(l[startTime.getUTCHours()]={startTime:x.StarSchedule.StartTime,endTime:x.StarSchedule.EndTime})});$scope.showSchedule.currentStatus="loaded";$scope.$apply()}});webService.call({name:"List_ShowSchedule",data:{actionUserId:sessionService.userId(),startTime:startTime.getTime(),endTime:endTime.getTime(),pageIndex:0,pageSize:999999,key:sessionService.key()},onError:function(errorCode,message){$scope.showSchedule.otherStatus="error";$scope.showSchedule.otherError=message;$scope.$apply()},onSuccess:function(r){$scope.showSchedule.listOther=[[],[]];$(r.Items).each(function(i,x){var startTime=new Date(x.Schedule.StartTime),l=startTime.getUTCDate()===d?$scope.showSchedule.listOther[0]:$scope.showSchedule.listOther[1];l.push(x)});$scope.showSchedule.otherStatus="loaded";$scope.$apply();$("#modal-show-schedule-other a[data-toggle='tab']").on("shown.bs.tab",function(){$("#modal-show-schedule-other .photo img").imageScale()})}})};sessionService.isReady(function(){$scope.onShowSchedule();$(".modal-show-schedule").on("shown.bs.modal",$scope.onShowSchedule)})}]);giasinhvienApp.controller("modalTakingMissionController",["$scope","$uibModalInstance","data","sessionService","webService","modalService","Notification","$rootScope",function($scope,$uibModalInstance,data,sessionService,webService,modalService,Notification){$scope.level={Items:undefined,level:0,numberlevel:undefined,checked:-1,countQuestInDay:undefined,maxQuestInDay:undefined};$scope.getNumber=function(num){return new Array(num)};$scope.onClose=function(){$uibModalInstance.dismiss()};webService.call({name:"User_CheckIdolQuest",type:"GET",data:{actionUserId:sessionService.userId(),starId:data.starId,key:sessionService.key()},onError:function(){},onSuccess:function(rs){$scope.level.countQuestInDay=rs.Result.countQuestInDay;$scope.level.maxQuestInDay=rs.Result.maxQuestInDay}});webService.call({name:"Config_GetConfig",type:"GET",data:{actionUserId:sessionService.userId(),value:"IdolQuestMaxLevel",key:sessionService.key()},onError:function(){},onSuccess:function(rs){for(var number=rs.Result.Value*1,res=[],i=0;i<number;i++)res.push(i);$scope.level.numberlevel=number;$scope.level.Items=res;$scope.$$phase||$scope.$apply()}});$scope.onIdolGetQuest=function(){if($scope.level.level==0){Notification.error("Bạn vui lòng chọn cấp độ nhiệm vụ");return}webService.call({name:"User_IdolGetQuest",type:"POST",data:{actionUserId:sessionService.userId(),scheduleId:data.scheduleId,level:$scope.level.level,key:sessionService.key()},onError:function(){Notification.error("Bạn đã hết số lần nhận nhiệm vụ");$scope.onClose()},onSuccess:function(rs){var nhannhiemvu=rs.Result;Notification.success("Nhận nhiệm vụ thành công");$scope.onClose();$scope.$$phase||$scope.$apply()}})};$scope.editlevelmission=function(level){$scope.level.level=level+1;$scope.level.checked=level};sessionService.isReady(function(){})}]);giasinhvienApp.controller("modalUserMissionController",["$scope","$uibModalInstance","data","sessionService","webService","Notification",function($scope,$uibModalInstance,data,sessionService,webService,Notification){$scope.GetListMission={status:"loading",Items:undefined};$scope.GetListMissionother={status:"loading",Items:undefined};$scope.onClose=function(){$uibModalInstance.dismiss()};webService.call({name:"User_GetListPromotionGift",data:{creatorId:sessionService.userId(),pageIndex:0,pageSize:9999,list_PromotionGiftId:"",list_ActionId:"",userId:sessionService.userId(),key:sessionService.key()},onSuccess:function(r){$scope.listItems=r.Items;var array=[],array1=[],array2=[];for(i=2;i<=15;i++)$(r.Items).each(function(j,y){y.GroupLevelUser&&y.GroupLevelUser.LevelIndex===i&&array1.push(y)}),array.push({rs:array1,name:array1[0].GroupLevelUser.Name,photo:array1[0].GroupLevelUser.Photo,UserHad:array1[0].UserHad,id:array1[0].GroupLevelUser.LevelIndex}),array1=[];$(r.Items).each(function(j,y){y.GroupLevelUser||array2.push(y)});$scope.GetListMission.Items=array;$scope.GetListMissionother.Items=array2}});$scope.RewardMission=function(event){var listPromotionGiftId=event,listid="",str;$($scope.listItems).each(function(j,y){y.GroupLevelUser&&y.GroupLevelUser.LevelIndex===listPromotionGiftId&&(listid+=y.PromotionGift.Id+",")});str=listid.substring(0,listid.length-1);webService.call({type:"POST",name:"User_ReceivePromotionGift",data:{actionUserId:sessionService.userId(),listPromotionGiftId:str,key:sessionService.key()},displayError:!0,onSuccess:function(){Notification.success("Nhận Thưởng Thành Công!");webService.call({name:"User_GetListPromotionGift",data:{creatorId:sessionService.userId(),pageIndex:0,pageSize:9999,list_PromotionGiftId:"",list_ActionId:"",userId:sessionService.userId(),key:sessionService.key()},onSuccess:function(r){$scope.listItems=r.Items;var array=[],array1=[],array2=[];for(i=2;i<=15;i++)$(r.Items).each(function(j,y){y.GroupLevelUser&&y.GroupLevelUser.LevelIndex===i&&array1.push(y)}),array.push({rs:array1,name:array1[0].GroupLevelUser.Name,photo:array1[0].GroupLevelUser.Photo,UserHad:array1[0].UserHad,id:array1[0].GroupLevelUser.LevelIndex}),array1=[];$(r.Items).each(function(j,y){y.GroupLevelUser||array2.push(y)});$scope.GetListMission.Items=array;$scope.GetListMissionother.Items=array2;$scope.$$phase||$scope.$apply()}})}})};$scope.RewardMissionother=function(event){var listPromotionGiftId=event;webService.call({type:"POST",name:"User_ReceivePromotionGift",data:{actionUserId:sessionService.userId(),listPromotionGiftId:listPromotionGiftId,key:sessionService.key()},displayError:!0,onSuccess:function(){Notification.success("Nhận Thưởng Thành Công!")}})}}]);giasinhvienApp.controller("popoverSeatMenuController",["$scope","sessionService","webService","popoverService",function($scope,sessionService,webService,popoverService){$scope.status="loading";$scope.message=undefined;$scope.data=popoverService.seatMenu;$scope.scheduleId=undefined;$scope.user={id:undefined,name:undefined,avatar:undefined,vipName:undefined,vipPhoto:undefined,vipColor:undefined,levelName:undefined,levelPhoto:undefined,coin:undefined};$scope.seat={index:undefined,listBasePrice:undefined,currentPrice:undefined,createDate:undefined,endDate:undefined};$scope.buy={listPrice:[],selectedPrice:undefined,isBusy:!1};$scope.$watch("data",function(value){$scope.scheduleId=value.scheduleId;$scope.seat.index=value.index;$scope.seat.listBasePrice=value.listPrice;$scope.seat.currentPrice=value.price;$scope.seat.createDate=value.createDate;$scope.seat.endDate=value.endDate;value.userId?($scope.status="loading",webService.call({name:"User_GetDetails",data:{actionUserId:sessionService.userId(),userId:value.userId,isStart:!1,key:sessionService.key()},onError:function(msg){$scope.status="error";$scope.message=msg},onSuccess:function(r){$scope.user.id=r.Result.User.Id;$scope.user.name=r.Result.User.Name;$scope.user.avatar=r.Result.User.AvatarPhoto;$scope.user.vipName=r.Result.VipItem?r.Result.VipItem.Name:undefined;$scope.user.vipPhoto=r.Result.VipItem?r.Result.VipItem.PhotoLink:undefined;$scope.user.vipColor=r.Result.VipItem?r.Result.VipItem.HexColor:undefined;$scope.user.levelName=r.Result.GroupLevel.Name;$scope.user.levelPhoto=r.Result.GroupLevel.Photo;$scope.user.coin=r.Result.User.TotalCoinUsed;$scope.status="loaded"}})):($scope.user=undefined,$scope.status="loaded")});$scope.$watch("seat.currentPrice",function(value){$scope.seat.listBasePrice&&($scope.buy.listPrice=[],$($scope.seat.listBasePrice).each(function(i,x){(!value||x>value)&&$scope.buy.listPrice.push(x)}),$scope.buy.listPrice.length>0&&($scope.buy.selectedPrice=$scope.buy.listPrice[0]))});$scope.onSubmit=function(){if($scope.data.onSubmit)$scope.data.onSubmit({$popoverScope:$scope})}}]);giasinhvienApp.factory("apiService",["$rootScope","mogolab_config","Notification",function($rootScope,config,notification){var service=new function(){this.call=function(o){if(o===undefined&&(o={}),o.type=o.type===undefined?"GET":o.type.toUpperCase(),o.async=o.async===undefined?!0:o.async,o.type!=="GET"&&o.type!=="POST")throw"'type' must be GET or POST";if(o.module===undefined)throw"'module' is undefined";if(o.method===undefined)throw"'method' is undefined";if(o.onDone!==undefined&&typeof o.onDone!="function")throw"'onDone' must be function";if(o.onError!==undefined&&typeof o.onError!="function")throw"'onError' must be function";if(o.onSuccess!==undefined&&typeof o.onSuccess!="function")throw"'onSuccess' must be function";(o.data===undefined||o.data===null)&&(o.data={});o.data.timezoneOffset=moment().utcOffset();$.ajax({url:config.baseManagerService+"/"+o.module+"/"+o.method,type:o.type,contentType:o.type==="GET"?undefined:"application/json",data:o.type==="GET"?o.data:JSON.stringify(o.data),async:o.async,error:function(r){o.onDone&&o.onDone();var msg="Có lỗi từ phía máy chủ";if(r.responseJSON.Status?msg=r.responseJSON.Message:msg+=": "+r.statusText,o.displayError&&notification.error(msg),o.onError)o.onError(msg);$rootScope.$$phase||$rootScope.$apply()},success:function(r){if(o.onDone&&o.onDone(),r.Status===undefined||r.Status!==0){if(o.displayError&&notification.error(r.Message),o.onError)o.onError(r.Message)}else if(o.onSuccess)o.onSuccess(r);$rootScope.$$phase||$rootScope.$apply()}})};this.get=function(o){return o===undefined&&(o={}),o.type="GET",service.call(o)};this.post=function(o){return o===undefined&&(o={}),o.type="POST",service.call(o)}};return service}]);giasinhvienApp.factory("authenticationService",["$rootScope","webService","sessionService","modalService",function($rootScope,webService,sessionService,modalService){var service=new function(){this.signUp=function(o){if(o=getOrDefault(o,{}),isNoUoW(o.email))throw"email must be declared";if(isNoUoW(o.password))throw"password must be declared";if(isNoUoW(o.name))throw"name must be declared";if(o.gender=getOrDefault(o.gender,!0),typeof o.gender!="number")throw"gender must be number";if(o.onDone&&typeof o.onDone!="function")throw"onDone must be function";if(isNoUoW(o.secretkey))throw"secretkey must be declared";sessionService.isSigned()?($rootScope.$broadcast("authentication_onSignUp"),$rootScope.$broadcast("authentication_onSignIn"),o.onDone&&o.onDone()):sessionService.getFingerprint(function(userkey){webService.call({type:"POST",name:"User_RegisterByTeenIdolForWeb",data:{user:{Email:o.email,Password:o.password,Name:o.name,Gender:o.gender,UserToken:userkey},secretkey:o.secretkey,key:sessionService.key()},displayError:!0,onError:function(){return o.onDone&&o.onDone(),null},onSuccess:function(r){r.Result&&r.Result.Id&&r.Result.Key&&sessionService.set(r.Result.Id,r.Result.Key,function(){$rootScope.$broadcast("authentication_onSignUp");$rootScope.$broadcast("authentication_onSignIn");o.onDone&&o.onDone()})}})})};this.signIn=function(o){if(o=getOrDefault(o,{}),o.mode=getOrDefault(o.mode,"teenidol"),o.mode!=="teenidol"&&o.mode!=="facebook")throw"mode must be 'teenidol', 'facebook'";if(o.onDone&&typeof o.onDone!="function")throw"onDone must be function";if(sessionService.isSigned())$rootScope.$broadcast("authentication_onSignIn"),o.onDone&&o.onDone();else switch(o.mode){case"teenidol":sessionService.getFingerprint(function(userkey){webService.call({type:"POST",name:"User_LoginTeenIdol",data:{email:o.email,password:o.password,key:sessionService.key(),userToken:userkey},displayError:!0,onError:function(){o.onDone&&o.onDone()},onSuccess:function(r){r.Result&&r.Result.Id&&r.Result.Key&&sessionService.set(r.Result.Id,r.Result.Key,function(){$rootScope.$broadcast("authentication_onSignIn");o.onDone&&o.onDone()})}})});break;case"facebook":var callback=function(r){webService.call({type:"POST",name:"User_LoginByFacebook",data:{accessToken:r.accessToken,key:sessionService.key()},displayError:!0,onError:function(){o.onDone&&o.onDone()},onSuccess:function(r){r.Result&&r.Result.Id&&r.Result.Key&&sessionService.set(r.Result.Id,r.Result.Key,function(){$rootScope.$broadcast("authentication_onSignIn");o.onDone&&o.onDone()})}})};FB.getLoginStatus(function(r){r.status==="connected"?callback(r.authResponse):FB.login(function(r){r.status==="connected"&&callback(r.authResponse)},{scope:"public_profile,email"})})}};this.signOut=function(){webService.call({type:"POST",name:"User_LogoutTeenIdol",data:{key:sessionService.key()}});sessionService.clear();$rootScope.$broadcast("authentication_onSignOut")};this.showModal=function(o){var $alertElement,setshowpopup;if(o=getOrDefault(o,{}),isNoUoW(o.mode)||(o.mode=o.mode.trim().toLowerCase()),o.mode!=="sign-in"&&o.mode!=="sign-up"&&o.mode!=="sign-out"&&o.mode!=="re-pass")throw"mode must be 'sign-in' or 'sign-up' or 'sign-out' or 're-pass'";if(o.message=getOrDefault(o.message,undefined),o.messageType=getOrDefault(o.messageType,"warning"),o.mode==="sign-in"||o.mode==="sign-up"||o.mode==="re-pass"){if(sessionService.isSigned()){console.info("Không thể thực hiện lệnh đăng ký / đăng nhập nữa vì bạn hiện đang đăng nhập với tài khoản userId: "+sessionService.userId());return}$alertElement=$("#modal-authentication .alert");$alertElement.removeClass().addClass("alert");o.message?$alertElement.addClass("alert-"+o.messageType).html(o.message):$alertElement.addClass("hidden").html("");$("#modal-authentication-sign-in .email").val("");$("#modal-authentication-sign-in .password").val("");$("#modal-authentication-sign-up .email").val("");$("#modal-authentication-sign-up .password").val("");$("#modal-authentication-sign-up .re-password").val("");$("#modal-authentication-sign-up .name").val("");$("#modal-authentication-sign-up .gender").val("0");setshowpopup=$rootScope.showPopupInterval?{backdrop:"static",keyboard:!1}:"show";$("#modal-authentication").modal(setshowpopup).find("a[data-target='#modal-authentication-"+o.mode+"']").tab("show")}else sessionService.isSigned()?modalService.showAlert({title:"Đăng xuất",message:"Bạn chắc chắn muốn đăng xuất khỏi tài khoản '"+sessionService.data().user.User.Name+"' chứ?",buttons:[{text:"Không",style:"btn-default",closeModal:!0},{text:"Có",style:"btn-primary",closeModal:!0,onClick:function(){service.signOut()}}]}):service.signOut()}};return service}]);giasinhvienApp.factory("formService",[function(){return new function(){this.validate=function(o){if(!o||typeof o!="object")return!0;if(!o.target)throw"target must be declared";if(o.rule&&o.rule.constructor!==Array)throw"rule must be array";o.position=getOrDefault(o.position,"top");var tooltip=o.target.data("kendoTooltip");return(tooltip||(tooltip=o.target.kendoTooltip({autoHide:!1,position:o.position,showOn:"",show:function(){tooltip.popup.element.find(".k-tooltip-button").remove();tooltip.popup.element.addClass("form-error-container")}}).data("kendoTooltip")),tooltip.hide(),tooltip.options.content="",tooltip.refresh(),!o.rule)?!0:($(o.rule).each(function(i,x){x.constructor===Array?$(x).each(function(j,y){if(!y.check())return tooltip.options.content+="<li>"+y.message+"<\/li>",!1}):x.check()||(tooltip.options.content+="<li>"+x.message+"<\/li>")}),tooltip.options.content!==""&&(tooltip.options.content="<ul>"+tooltip.options.content+"<\/ul>",tooltip.refresh(),tooltip.show()),tooltip.options.content==="")};this.isLoading=function(target){return target.data("bs.button")?target.data("bs.button").isLoading:!1};this.isDisabled=function(target){return target.hasClass("disabled")}}}]);giasinhvienApp.factory("helperService",[function(){return new function(){this.formatMessage=function(message){function urlify(text){return text.replace(/(https?:\/\/(?!file.teenidol|teenidol.vn\/Flash)[^\s]+)/g,function(url){return'<a style="font-style: italic" href="'+url+'" target="_blank">'+url+"<\/a>"})}var m;return message=message.replace(/<[^<>]+>/gi,""),message=message.replace(/\\n/gi,"<br/>"),m=message.match(/\{user(\|(\d+)){2}(\|([^|{}]*)){1}\}/g),$(m).each(function(i,x){var id,scheduleId,name,r;try{for(x=x.replace("{","").replace("}",""),x=x.substring(x.indexOf("|")+1),id=parseInt(x.substring(0,x.indexOf("|"))),x=x.substring(x.indexOf("|")+1),scheduleId=parseInt(x.substring(0,x.indexOf("|"))),x=x.substring(x.indexOf("|")+1),name=urlify(x),x=m[i],r=id==123456789?"<span style='color:#f15d69;font-style: italic'>"+name+"<\/span>":"<a href='#' ud-role='user-popup' user-id='"+id+"' schedule-id='"+scheduleId+"'>"+name+"<\/a>";message.indexOf(x)!==-1;)message=message.replace(x,r)}catch(ex){}}),m=message.match(/\{user(\|(\d+)){2}(\|([^|{}]*)){5}\}/g),$(m).each(function(i,x){var id,scheduleId,name,vipPhoto,badgePhoto,vipColor,rankTitle,r;try{for(x=x.replace("{","").replace("}",""),x=x.substring(x.indexOf("|")+1),id=parseInt(x.substring(0,x.indexOf("|"))),x=x.substring(x.indexOf("|")+1),scheduleId=parseInt(x.substring(0,x.indexOf("|"))),x=x.substring(x.indexOf("|")+1),name=x.indexOf("|")===-1?x:x.substring(0,x.indexOf("|")),x=x.substring(x.indexOf("|")+1),vipPhoto=x.substring(0,x.indexOf("|")),x=x.substring(x.indexOf("|")+1),badgePhoto=x.substring(0,x.indexOf("|")),x=x.substring(x.indexOf("|")+1),vipColor=x.substring(0,x.indexOf("|")),x=x.substring(x.indexOf("|")+1),rankTitle=x,x=m[i],console.log(rankTitle),r="<span style='color:#00a8c3;FONT-WEIGHT: bold;font-size: 10px;margin-right: 3px; '>"+rankTitle+"<\/span><a class='vip-text' "+(vipColor?"style='color: "+vipColor+";'":"")+" href='#' ud-role='user-popup' user-id='"+id+"' schedule-id='"+scheduleId+"'>"+(vipPhoto&&!isNoUoW(vipPhoto)&&vipPhoto!=="null"?"<img class='vip' src='"+vipPhoto+"'/>":"")+(badgePhoto&&!isNoUoW(badgePhoto)&&badgePhoto!=="null"?"<img class='badge' src='"+badgePhoto+"'/>":"")+name+"<\/a>";message.indexOf(x)!==-1;)message=message.replace(x,r)}catch(ex){}}),m=message.match(/\{gift\|(\d+)(\|([^|{}]*)){2}\}/g),$(m).each(function(i,x){var quantity,name,photo,r;try{for(x=x.replace("{","").replace("}",""),x=x.substring(x.indexOf("|")+1),quantity=parseInt(x.substring(0,x.indexOf("|"))),x=x.substring(x.indexOf("|")+1),name=x.indexOf("|")===-1?x:x.substring(0,x.indexOf("|")),x=x.substring(x.indexOf("|")+1),photo=x,x=m[i],r=quantity==10001?"<img-scale class='gift' link='"+photo+"' scale='best-fit' uib-tooltip='"+name+"' tooltip-placement='top'><\/img-scale>":"<img-scale class='gift' link='"+photo+"' scale='best-fit' uib-tooltip='"+quantity+" "+name+"' tooltip-placement='top'><\/img-scale>";message.indexOf(x)!==-1;)message=message.replace(x,r)}catch(ex){}}),m=message.match(/\{animation-item(\|([^|{}]*)){2}\}/g),$(m).each(function(i,x){var name,photo,r;try{for(x=x.replace("{","").replace("}",""),x=x.substring(x.indexOf("|")+1),name=x.substring(0,x.indexOf("|")),x=x.substring(x.indexOf("|")+1),photo=x,x=m[i],r="<img-scale class='animation-item' link='"+photo+"' scale='best-fit' uib-tooltip='"+name+"' tooltip-placement='top'><\/img-scale>";message.indexOf(x)!==-1;)message=message.replace(x,r)}catch(ex){}}),m=message.match(/\{free-coin\|(\d+)\}/g),$(m).each(function(i,x){var quantity,r;try{for(x=x.replace("{","").replace("}",""),x=x.substring(x.indexOf("|")+1),quantity=x,x=m[i],r="<span><b>"+formatNumber(quantity)+"<\/b> <i class='free-coin-icon'><\/i><span>";message.indexOf(x)!==-1;)message=message.replace(x,r)}catch(ex){}}),m=message.match(/\{(\w+)-(\d+)\}/g),$(m).each(function(i,x){var link,r;try{for(x=x.replace("{","").replace("}",""),x=x.split("-"),link="/Content/Image/Emoticon/"+x[0]+"/"+x[1]+".gif",x=m[i],r="<img class='emoticon' src='"+link+"'/>";message.indexOf(x)!==-1;)message=message.replace(x,r)}catch(ex){}}),message};this.linkAction=function(link){return link};this.urlify=function(text){return text.replace(/(https?:\/\/[^\s]+)/g,function(url){return'<a style="font-style: italic" href="'+url+'" target="_blank">'+url+"<\/a>"})};this.linkImage=function(link,size){return!link||!size?link:link.indexOf("https://file.teenidol.vn/image/")===-1?link:link.substring(0,link.lastIndexOf("/"))+"/"+size+".jpg"};this.formatNumber=formatNumber;this.formatTime=function(timeTamps){var d=new Date(timeTamps);return d.getUTCHours()+":"+kendo.toString(d.getUTCMinutes(),"00")};this.formatDate=function(timeTamps){var d=new Date(timeTamps);return d.getUTCDate()+"-"+(d.getUTCMonth()+1)+"-"+d.getUTCFullYear()+" "+d.getUTCHours()+":"+kendo.toString(d.getUTCMinutes(),"00")};this.formatStortDate=function(timeTamps){var d=new Date(timeTamps);return d.getUTCDate()+"/"+(d.getUTCMonth()+1)+"/"+d.getUTCFullYear()};this.formatString=function(string){var str=string;return str.replace(/\$/g,"")};this.isYoutubeVideo=function(link){return link?link.indexOf("https://www.youtube.com/embed")!==-1:!1};this.playNotificationSound=function(){$("#sound").attr("src","/Content/Sound/notification.mp3")};this.replaceLinkSlider=function(LinkBaner){return LinkBaner.replace("o.jpg","715x402.jpg")};this.isLoading=function(target){return target.data("bs.button")?target.data("bs.button").isLoading:!1};this.isDisabled=function(target){return target.hasClass("disabled")};this.detectBrowser=function(){return navigator.userAgent.match(/Android/i)?"android":navigator.userAgent.match(/webOS/i)?"webos":navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)?"ios":navigator.userAgent.match(/BlackBerry/i)?"blackberry":navigator.userAgent.match(/Windows Phone/i)?"windowsphone":"desktop"};this.checkCookies=function(){var cookieEnabled=navigator.cookieEnabled?!0:!1;return typeof navigator.cookieEnabled!="undefined"||cookieEnabled||(document.cookie="testcookie",cookieEnabled=document.cookie.indexOf("testcookie")!==-1?!0:!1),cookieEnabled}}}]);giasinhvienApp.factory("modalService",["$uibModal","sessionService",function($uibModal){return new function(){this.showAlert=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-alert",animation:!0,templateUrl:"/Layouts/Modal/Alert.html",controller:"modalAlertController",resolve:{data:function(){return o}}})};this.showAlertKickAdmin=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-alert",animation:!0,templateUrl:"/Layouts/Modal/AlertKickAdmin.html",controller:"modalAlertController",resolve:{data:function(){return o}}})};this.showFacebookLive=function(o){(o===undefined||o===null)&&(o={});var modal=$uibModal.open({windowClass:"modal-facebook-live",animation:!0,backdrop:"static",keyboard:!1,templateUrl:"/Layouts/Modal/FacebookLive.html",controller:"modalFacebookLiveController",resolve:{data:function(){return o}}});modal.result.then(function(r){o.onSuccess(r)})};this.showUserDayCheck=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-daycheck",animation:!0,size:"",templateUrl:"/Layouts/Modal/DayCheck.html",controller:"modalDayCheckController",resolve:{data:function(){return o}}})};this.showRegisterstar=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-registerstar",animation:!0,size:"lg",templateUrl:"/Layouts/Modal/Registerstar.html",controller:"modalRegisterstarController",resolve:{data:function(){return o}}})};this.showUserMission=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-usermission",animation:!0,size:"lg",templateUrl:"/Layouts/Modal/UserMission.html",controller:"modalUserMissionController",resolve:{data:function(){return o}}})};this.showUserRechargeCoin=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-recharge-coin",animation:!0,size:"lg",templateUrl:"/Layouts/Modal/RechargeCoin.html",controller:"modalRechargeCoinController",resolve:{data:function(){return o}}})};this.showShowRank=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-show-rank",animation:!0,size:"",templateUrl:"/Layouts/Modal/ShowRank.html",controller:"modalShowRankController",resolve:{data:function(){return o}}})};this.showShowOpening=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-show-opening",animation:!0,size:"",templateUrl:"/Layouts/Modal/ShowOpening.html",controller:"modalShowOpeningController",resolve:{data:function(){return o}}})};this.showShowSchedule=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-show-schedule",animation:!0,size:"",templateUrl:"/Layouts/Modal/ShowSchedule.html",controller:"modalShowScheduleController",resolve:{data:function(){return o}}})};this.showPopupEvent=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-popup-event",animation:!0,size:"",templateUrl:"/Layouts/Modal/ShowPopupEvent.html",controller:"modalPopupEventController",resolve:{data:function(){return o}}})};this.showBannerEvent=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-show-banner-event",animation:!0,size:"lg",templateUrl:"/Layouts/Modal/BannerEvent.html",controller:"modalBannerEventController",resolve:{data:function(){return o}}})};this.showIframeRechargeCoin=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-show-iframe-recharge-coin",animation:!0,size:"lg",templateUrl:"/Layouts/Modal/IframeRechargeCoin.html",controller:"modalIframeRechargeCoinController",resolve:{data:function(){return o}}})};this.showDetailGuild=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-show-detail-guild",animation:!0,backdrop:"static",size:"lg",keyboard:!1,templateUrl:"/Layouts/Modal/DetailGuild.html",controller:"modalDetailGuildController",resolve:{data:function(){return o}}})};this.showChangePassword=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-show-change-password",animation:!0,size:"",templateUrl:"/Layouts/Modal/ChangePassword.html",controller:"modalChangePasswordController",resolve:{data:function(){return o}}})};this.showGuildMaster=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-guild-master",animation:!0,size:"lg",templateUrl:"/Layouts/Modal/GuildMaster.html",controller:"modalGuildMasterController",resolve:{data:function(){return o}}})};this.showListUserJoin=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-list-user-join",animation:!0,size:"lg",templateUrl:"/Layouts/Modal/ListUserJoin.html",controller:"modalListUserJoinController",resolve:{data:function(){return o}}})};this.showShopGuild=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-shop-guild",animation:!0,size:"lg",templateUrl:"/Layouts/Modal/ShopGuild.html",controller:"modalShopGuildController",resolve:{data:function(){return o}}})};this.showGoldMine=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-gold-mine",animation:!0,size:"",templateUrl:"/Layouts/Modal/GoldMine.html",controller:"modalGoldMineController",resolve:{data:function(){return o}}})};this.showRankGuild=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-rank-guild",animation:!0,size:"lg",templateUrl:"/Layouts/Modal/RankGuild.html",controller:"modalRankGuildController",resolve:{data:function(){return o}}})};this.showInfoTower=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-info-tower",animation:!0,size:"",templateUrl:"/Layouts/Modal/InfoTower.html",controller:"modalInfoTowerController",resolve:{data:function(){return o}}})};this.showEditAvatarGuild=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-edit-avatar-guild",animation:!0,size:"sm",templateUrl:"/Layouts/Modal/EditAvatarGuild.html",controller:"modalEditAvatarGuildController",resolve:{data:function(){return o}}})};this.showEditGuild=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-edit-guild",animation:!0,size:"sm",templateUrl:"/Layouts/Modal/EditGuild.html",controller:"modalEditGuildController",resolve:{data:function(){return o}}})};this.showTakingMission=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-taking-mission",animation:!0,size:"sm",templateUrl:"/Layouts/Modal/TakingMission.html",controller:"modalTakingMissionController",resolve:{data:function(){return o}}})};this.showIdolMission=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-idol-mission",animation:!0,size:"sm",templateUrl:"/Layouts/Modal/IdolMission.html",controller:"modalIdolMissionController",resolve:{data:function(){return o}}})};this.showIdolDoneMission=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-idol-done-mission",animation:!0,size:"sm",templateUrl:"/Layouts/Modal/IdolDoneMission.html",controller:"modalIdolDoneMissionController",resolve:{data:function(){return o}}})};this.showReport=function(o){if((o===undefined||o===null)&&(o={}),o.title===undefined&&(o.title=""),o.buttons!==undefined&&o.buttons.constructor!==Array)throw"buttons must be array type";var modal=$uibModal.open({windowClass:"modal-report",animation:!0,size:"sm",templateUrl:"/Layouts/Modal/Report.html",controller:"modalReportController",resolve:{data:function(){return o}}})}}}]);giasinhvienApp.factory("popoverService",[function(){return new function(){this.userMenu={template:function(){return"/Layouts/Popover/UserMenu.html"}};this.seatMenu={template:function(){return"/Layouts/Popover/SeatMenu.html"}};this.emoticon={template:function(){return"/Layouts/Popover/Emoticon.html"}}}}]);giasinhvienApp.factory("sessionService",["$rootScope","$http","$interval","$cookies","webService","helperService","Notification",function($rootScope,$http,$interval,$cookies){var _userId,_key,_data,_level,_groupUserId,_status="unloaded",service=new function(){this.isSigned=function(){return!isNoU(_userId)&&!isNoUoW(_key)&&_data!==undefined};this.isLoaded=function(){return _status==="loaded"};this.userId=function(){return _userId?_userId:-1};this.groupUserId=function(){return _groupUserId?_groupUserId:-1};this.vipId=function(){return _data&&_data.user&&_data.user.VipItem&&_data.user.VipItem.Id?_data.user.VipItem.Id:-1};this.key=function(){return _key?_key:""};this.data=function(){return _data};this.clear=function(){_userId=undefined;_key=undefined;_data=undefined;_groupUserId=undefined;$cookies.remove("session")};this.set=function(userId,key){_userId=userId;_key=key};this.levelidol=function(){return _level};this.clearlevel=function(){_level=undefined;$cookies.remove("sessionlevel")};this.setlevel=function(level){_level=level;$cookies.putObject("sessionlevel",{_level:level},{expires:moment().add(1,"days").toDate()})};this.load=function(){if(_status==="unloaded"){_status="loading";var data=$cookies.getObject("session");data?service.set(data.userId,data.key,function(){_status="loaded";$rootScope.$broadcast("session_onLoad")}):(_status="loaded",$rootScope.$broadcast("session_onLoad"))}};this.reload=function(){};this.isReady=function(callback){var handler=$interval(function(){_status==="loaded"&&($interval.cancel(handler),angular.element(document).ready(callback))},100)};this.getFingerprint=function(callback){new Fingerprint2({excludeLanguage:!0,excludeCpuClass:!0,excludePlatform:!0,excludeAdBlock:!0,excludeHasLiedOs:!0}).get(function(r){callback(r)})}};return service}]);giasinhvienApp.factory("signalRService",["mogolab_config",function(mogolab_config){var _hostLink=mogolab_config.baseUrlSignalRService,_hub;return $("head").append("<script type='text/javascript' src='"+_hostLink+"/signalr/hubs'><\/script>"),new function(){this.hub=function(){return _hub};this.createConnection=function(o){if(o=getOrDefault(o,{}),o.onInit&&typeof o.onInit!="function")throw"onInit must be function";if(o.onSuccess&&typeof o.onSuccess!="function")throw"onSuccess must be function";var connection=$.hubConnection(_hostLink+"/signalr",{useDefaultPath:!1});if(connection.qs=o.queryString,_hub=connection.createHubProxy("teenidol"),o.onInit)o.onInit(_hub);connection.start({waitForPageLoad:!1}).done(function(){if(o.onSuccess)o.onSuccess(_hub)}).fail(function(r){if(o.onError)o.onError(r)})};this.getShowCount=function(listId,success,error){$.ajax({url:"https://teenidol.vn:9239/showCount/"+listId.join(),error:function(){error&&typeof error=="function"&&error()},success:function(r){success&&typeof success=="function"&&success(r)}})}}}]);giasinhvienApp.factory("webService",["Notification","mogolab_config",function(Notification,mogolab_config){var _hostLink=mogolab_config.baseUrlWebService;return new function(){this.call=function(o){if(!o||typeof o!="object")return undefined;if(isNoUoW(o.name))throw"name must be declared";if(o.type=getOrDefault(o.type,"GET").trim().toUpperCase(),o.type!=="GET"&&o.type!=="POST")throw"type must be 'GET' or 'POST'";if(o.onSuccess&&typeof o.onSuccess!="function")throw"success must be function type";if(o.onError&&typeof o.onError!="function")throw"error must be function type";if(o.displayError=getOrDefault(o.displayError,!1),o.displayError&&typeof o.displayError!="boolean")throw"displayError must be boolean type";console.log("aaaaa");$.ajax({url:_hostLink+o.name,type:o.type,dataType:o.type==="GET"?undefined:"text",contentType:o.type==="GET"?undefined:"application/json",data:o.type==="GET"?o.data:JSON.stringify(o.data),error:function(){console.log("sssss");o.displayError&&Notification.error("Có lỗi, xin thử lại");o.onError&&o.onError()},success:function(response){if(console.log("gdsgs"),response&&typeof response=="string"&&response.indexOf("$Exception$")!==-1&&(o.displayError&&Notification.error(response),o.onError&&o.onError()),response&&o.type==="POST")try{response=JSON.parse(response)}catch(e){}if(isNoU(response.ErrorCode)===!1&&response.ErrorCode>0||isNoU(response.errorCode)===!1&&response.errorCode>0){if(o.displayError&&Notification.error(response.Message?response.Message:response.message),o.onError)o.onError(response.ErrorCode?response.ErrorCode:response.errorCode,response.Message?response.Message:response.message)}else if(o.onSuccess)o.onSuccess(response)}})}}}]);giasinhvienApp.directive("guildInfo",[function(){return{replace:!0,restrict:"E",templateUrl:"/Layouts/Template/GuildInfo.html",scope:{showId:"@"},controllerAs:"$ctrl",controller:["$scope","modalService","webService","sessionService","$rootScope","Notification",function($scope,modalService,webService,sessionService){$scope.eventId=1;$scope.sessionService=sessionService;$scope.eventId==1&&($scope.currNum=0,$scope.guildId=null,$scope.currName=null,$scope.listReward=null,webService.call({name:"User_GetListGuildEvent",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,getGuild:1,startdate:14900688e5,enddate:149076e7,key:sessionService.key()},onError:function(){},onSuccess:function(r){r.Items[0].Guild.Id>0&&($scope.guildId=r.Items[0].Guild.Id,$scope.currName=r.Items[0].Guild.Name,$scope.currNum=r.Items[0].Total,$scope.currphoto=r.Items[0].Guild.PhotoLink,$scope.$$phase||$scope.$apply());r.Items[0].ListPoint&&($scope.listReward=r.Items[0].ListPoint,$scope.$$phase||$scope.$apply())}}),$scope.$on("LoadThongTinGuild",function(){webService.call({name:"User_GetListGuildEvent",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,getGuild:1,startdate:14900688e5,enddate:149076e7,key:sessionService.key()},onError:function(){},onSuccess:function(r){r.Items[0].Guild.Id>0&&($scope.currNum=r.Items[0].Value,$scope.$$phase||$scope.$apply())}})}));$scope.RedirectRank=function(){window.open("https://teenidol.vn/dang-cap-gia-toc","_blank")}}]}}]);giasinhvienApp.directive("listGuildRank",[function(){return{replace:!0,restrict:"E",templateUrl:"/Layouts/Template/ListGuildRank.html",scope:{link:"@",linkNewTab:"@",avatar:"@",teamName:"@",name:"@",namePosition:"@",vipName:"@",vipPhoto:"@",vipColor:"@",levelName:"@",levelPhoto:"@",nextLevelPointNeed:"@",display:"@",coin:"=",indexValue:"=",onClick:"&"},controllerAs:"$ctrl",controller:["$scope","helperService",function($scope,helperService){$scope.helper=helperService}]}}]);giasinhvienApp.directive("luckyWheel",[function(){return{replace:!0,restrict:"E",templateUrl:"/Layouts/Template/LuckyWheel.html",scope:{scheduleId:"@",starId:"@"},controllerAs:"$ctrl",controller:["$scope","modalService","webService","sessionService","$rootScope","Notification","$rootScope",function($scope,modalService,webService,sessionService,$rootScope,Notification,$rootScope){$scope.sessionService=sessionService;$scope.resetButton=!0;webService.call({name:"User_GetNumberTurnRotation",data:{actionUserId:sessionService.userId(),key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberTurnRotation=r.Result;$rootScope.$broadcast("User_GetNumberTurnRotation",{numberTurnRotation:$scope.numberTurnRotation})}});$scope.theWheel=new Winwheel({drawMode:"image",numSegments:12,outerRadius:170,pointerAngle:0,textFontSize:11,strokeStyle:"white",textMargin:10,lineWidth:2,textLineWidth:2,innerRadius:40,textAlignment:"inner",segments:[{fillStyle:"#14b9c5",text:"Trang bị Thanh tước 7 ngày"},{fillStyle:"#48b962",text:"500 Tim"},{fillStyle:"#e0e439",text:"Vip chí tôn 7 ngày"},{fillStyle:"#f6ee2d",text:"50 nụ hôn"},{fillStyle:"#faa52b",text:"Tre non x5"},{fillStyle:"#f36e39",text:"Quà idol: răng long đầu bạc"},{fillStyle:"#f05446",text:"Vip tím 7 ngày"},{fillStyle:"#ee3032",text:"May mắn lần sau"},{fillStyle:"#a24198",text:"10 nụ hôn"},{fillStyle:"#7b489c",text:"Quà idol: vợ người ta x1"},{fillStyle:"#3e4a9f",text:"Vip đỏ 7 ngày"},{fillStyle:"#1988c7",text:"bánh trung thu x1"},],animation:{type:"spinToStop",duration:4,spins:8,callbackFinished:"alertPrize()",stopAngle:245}});$scope.loadedImg=new Image;$scope.loadedImg.onload=function(){$scope.theWheel.wheelImage=$scope.loadedImg;$scope.theWheel.draw()};$scope.loadedImg.src="/Content/Image/Event-2017/Thang2/main.png";$scope.wheelPower=3;$scope.wheelSpinning=!1;$scope.powerSelected=function(powerLevel){$scope.wheelSpinning==!1&&($scope.wheelPower=powerLevel)};$scope.startSpin=function(){if(!$scope.resetButton){Notification.error("Bạn cần hoàn thành vòng quay để tiếp tục");return}$scope.resetvongtron==!0&&($scope.theWheel.stopAnimation(!1),$scope.theWheel.rotationAngle=0,$scope.theWheel.draw(),$scope.wheelSpinning=!1);$scope.resetButton=!1;webService.call({name:"User_StartTurnRotation",type:"POST",data:{actionUserId:sessionService.userId(),starId:$scope.starId,scheduleId:$scope.scheduleId,key:sessionService.key()},onError:function(errorCode,message){sessionService.isSigned()?Notification.error(message):Notification.error("Bạn cần đăng nhập để thực hiện chức năng này.");$scope.resetButton=!0},onSuccess:function(r){var a,b,c,d;$scope.idgift=r.Result.EventGiftRotation.Id;$scope.giftid=r.Result.EventLogTurnRotation.Id;console.log($scope.idgift);a=$scope.idgift==15?1:$scope.idgift==16?2:$scope.idgift==17?3:$scope.idgift==18?4:$scope.idgift==19?5:$scope.idgift==20?6:$scope.idgift==21?7:$scope.idgift==22?3:$scope.idgift==23?9:$scope.idgift==24?10:$scope.idgift==25?11:$scope.idgift==26?12:22;b=30*a-5;c=b-20;a==1&&(c=5);d=b-c+1;$scope.theWheel.animation.stopAngle=Math.floor(Math.random()*d+c)+180;$scope.wheelSpinning==!1&&($scope.theWheel.startAnimation(),$scope.wheelSpinning=!0,webService.call({name:"User_GetNumberTurnRotation",data:{actionUserId:sessionService.userId(),key:sessionService.key()},onError:function(errorCode,message){Notification.error(message)},onSuccess:function(r){$scope.numberTurnRotation=r.Result;$scope.$$phase||$scope.$apply();$rootScope.$broadcast("User_GetNumberTurnRotation",{numberTurnRotation:$scope.numberTurnRotation})}}))}})};$scope.resetWheel=function(){if($scope.resetButton)$scope.theWheel.stopAnimation(!1),$scope.theWheel.rotationAngle=0,$scope.theWheel.draw(),$scope.wheelSpinning=!1;else{Notification.error("Bạn cần hoàn thành vòng quay để tiếp tục");return}};$scope.alertPrize=function(){$scope.resetButton=!0;$scope.resetvongtron=!0;webService.call({name:"User_EndTurnRotation",type:"POST",data:{actionUserId:sessionService.userId(),rotationLogId:$scope.giftid,starId:$scope.starId,scheduleId:$scope.scheduleId,key:sessionService.key()},onError:function(errorCode,message){Notification.error(message);Notification.error(errorCode);$scope.setNumberTurn=!0;$scope.resetButton=!0},onSuccess:function(r){r.Result.MessageGiftUser!=null&&Notification({message:r.Result.MessageGiftUser,title:"Vòng quay may mắn",delay:1e4,positionX:"right",positionY:"bottom"})}});$scope.theWheel};$scope.custum=function(){var ctx=$scope.theWheel.ctx;ctx.strokeStyle="navy";ctx.fillStyle="aqua";ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(170,5);ctx.lineTo(230,5);ctx.lineTo(200,40);ctx.lineTo(171,5);ctx.stroke();ctx.fill()};$scope.$watchCollection("missionIdol",function(){})}]}}]);giasinhvienApp.directive("showGift",[function(){return{restrict:"E",replace:!0,scope:{listGiftCategory:"=",scheduleId:"@",starId:"@"},templateUrl:"/Layouts/Template/ShowGift.html",controllerAs:"$ctrl",controller:["$scope","webService","$rootScope","sessionService","helperService","authenticationService","Notification",function($scope,webService,$rootScope,sessionService,helperService,authenticationService){$scope.helper=helperService;$scope.freeCoinQuantity=undefined;$scope.onAfterSendGift=function(gift,coin){$scope.updateUserCoin(-coin)};$scope.onAfterSendFreeCoin=function(freeCoin){$scope.updateUserFreeCoin(-freeCoin)};$scope.updateUserCoin=function(amount){sessionService.data().user.User.Coin+=amount;$scope.$$phase||$scope.$apply()};$scope.updateUserFreeCoin=function(amount){sessionService.data().user.User.TotalFreeCoin+=amount;$scope.$apply()};$scope.onSelectGiftItem=function($event){var $target=$($event.target).closest(".gift-item");$scope.selectedGift&&$scope.selectedGift.id===$target.data("id")||($scope.selectedGift=$scope.listGiftCategory[$target.closest(".gift-category").data("index")].listGift[$target.data("index")],$scope.selectedGift.selectedQuantity=$scope.selectedGift.listQuantity[0])};$scope.onSendGift=function($event){var $target=$($event.target.closest("button"));if(!$scope.helper.isLoading($target)){if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}$target.button("loading"),function(sendGift){webService.call({type:"POST",name:"User_GiveAwayGift",data:{actionUserId:sessionService.userId(),giftId:sendGift.id,quantity:sendGift.selectedQuantity.quantity,scheduleId:$scope.scheduleId,starId:$scope.starId,isInEvent:!1,key:sessionService.key()},displayError:!0,onError:function(){$target.button("reset")},onSuccess:function(){$target.button("reset");$scope.onAfterSendGift({id:sendGift.id,name:sendGift.name,quantity:sendGift.selectedQuantity.quantity,photo:sendGift.selectedQuantity.photo,animation:sendGift.selectedQuantity.animation,type:sendGift.selectedQuantity.type,animationTime:sendGift.selectedQuantity.animationTime,animationWidth:sendGift.selectedQuantity.animationWidth,animationHeight:sendGift.selectedQuantity.animationHeight,photoGif:sendGift.selectedQuantity.photoGif,animationGifTime:sendGift.selectedQuantity.animationGifTime},sendGift.price*sendGift.selectedQuantity.quantity)}})}($scope.selectedGift)}};$scope.onSendFreeCoin=function($event){var $target=$($event.target.closest("button")),freeCoinQuantity;if(!$scope.helper.isLoading($target)&&!$scope.helper.isDisabled($target)){if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}freeCoinQuantity=$scope.freeCoinQuantity?$scope.freeCoinQuantity:10;webService.call({type:"POST",name:"User_GiveFreeCoin",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,starId:$scope.starId,freeCoin:freeCoinQuantity,key:sessionService.key()},displayError:!0,onError:function(){},onSuccess:function(){$scope.onAfterSendFreeCoin(freeCoinQuantity)}})}};$scope.onUserRechargeCoin=function(){$rootScope.$broadcast("onUserRechargeCoin")};$scope.setfreeCoinQuantity=function(number){$scope.freeCoinQuantity=number;$(".give-free-coin").html("Tặng "+number+' <i class="free-coin-icon"><\/i>')}}]}}]);giasinhvienApp.directive("showItem",[function(){return{replace:!0,restrict:"E",templateUrl:"/Layouts/Template/ShowItem.html",scope:{link:"@",photo:"@",phone:"=",name:"@",levelName:"@",levelPhoto:"@",startTime:"=",isLive:"=",view:"=",issample:"=",persamper:"="},controllerAs:"$ctrl",controller:["$scope","helperService",function($scope,helperService){if($scope.helper=helperService,$scope.startTime){var now=new Date;$scope.s=$scope.startTime-252e5;$scope.startTime=new Date($scope.s);$scope.startTimeType=now.getFullYear()===$scope.startTime.getFullYear()&&now.getMonth()===$scope.startTime.getMonth()&&now.getDate()===$scope.startTime.getDate()?"time":"date"}}]}}]);giasinhvienApp.directive("showListUser",[function(){return{replace:!0,restrict:"E",templateUrl:"/Layouts/Template/ShowListUser.html",scope:{nextView:"=",scheduleId:"=",listUser:"=",listUserKick:"=",listUserAntiChat:"=",listUserSetMod:"=",decentralizationUser:"=",userCount:"=",facebookLiveViews:"=",onLoadKick:"&",onLoadAntiChat:"&",onLoadSetMod:"&",onNextListUserInShow:"&"},controllerAs:"$ctrl",controller:["$scope","signalRService",function($scope,signalrService){var updateCount=function(){$scope.scheduleId&&$scope.listUser?signalrService.getShowCount([$scope.scheduleId],function(r){r&&r[0].TotalUser?$scope.userCount=r[0].TotalUser:$scope.listUser&&($scope.userCount=$scope.listUser.length)},function(){$scope.listUser&&($scope.userCount=$scope.listUser.length)}):$scope.listUser&&($scope.userCount=$scope.listUser.length)};$scope.$watchCollection("listUser",function(value){$scope.vipCount=0;$(value).each(function(i,x){x.VipItem&&($scope.vipCount+=1)});updateCount()});$scope.$watch("scheduleId",function(){updateCount()});$scope.$watchCollection("listUserKick",function(value){$scope.userKickCount=0;value&&($scope.userKickCount=value.length)});$scope.$watchCollection("listUserAntiChat",function(value){$scope.userAntiChatCount=0;value&&($scope.userAntiChatCount=value.length)});$scope.$watchCollection("listUserSetMod",function(value){$scope.userSetModCount=0;value&&($scope.userSetModCount=value.length)});$scope.$watchCollection("decentralizationUser",function(value){value&&($scope.decentralizationUser=value)})}]}}]);giasinhvienApp.directive("showMessage",[function(){return{replace:!0,restrict:"E",templateUrl:"/Layouts/Template/ShowMessage.html",scope:{listSentGift:"=",scheduleId:"@",starId:"@",showId:"@",message:"="},controllerAs:"$ctrl",controller:["$rootScope","$scope","helperService","sessionService","webService",function($rootScope,$scope,helperService,sessionService){$scope.sessionService=sessionService;$scope.$on("User_GetNumberTurnRotation",function(event,data){$scope.numberTurnRotation=data.numberTurnRotation});$rootScope.$on("User_GetUserGranary",function(event,data){$scope.numberUnit=data.numberUnit});var SetUcControl=null;SetUcControl=setInterval(function(){$(".uc-private-message").data("$ucPrivateMessageController")!=undefined&&($scope.privateMessageCtrl=$(".uc-private-message").data("$ucPrivateMessageController"),clearInterval(SetUcControl))},100);$scope.helper=helperService;$scope.privateMessagePanelIsSelected=!1;$scope.privateMessagePanel=!1;$scope.onPrivateMessagePanelDeselect=function(){$scope.privateMessagePanelIsSelected=!1};$scope.onPrivateMessagePanelSelect=function(){$scope.privateMessagePanelIsSelected=!0;$scope.privateMessageCtrl&&$scope.privateMessagePanel===!1&&($scope.privateMessageCtrl.load([$scope.starId]),$scope.privateMessagePanel=!0)};$scope.$on("dropdownUser_onSendPrivateMessage",function(event,data){$scope.privateMessagePanelIsSelected=!0;$scope.onPrivateMessagePanelSelect();$scope.privateMessageCtrl.addTarget(data.userData.User.Id,data.userData.User.Name,data.userData.User.AvatarPhoto);var $list=$(".list-target");$("#dropdown-user-info").jqDropdown("hide")})}]}}]);giasinhvienApp.directive("showSeat",["helperService",function(){return{restrict:"E",transclude:!0,replace:!0,templateUrl:"/Layouts/Template/ShowSeat.html",scope:{scheduleId:"=",listSeat:"=",onSeatSubmit:"&"},controllerAs:"$ctrl",controller:["$scope","helperService","popoverService",function($scope,helperService,popoverService){$scope.helper=helperService;$scope.popover=popoverService;$scope.onItemClick=function($index){popoverService.seatMenu.scheduleId=$scope.scheduleId;popoverService.seatMenu.index=$scope.listSeat.items[$index].index;popoverService.seatMenu.userId=$scope.listSeat.items[$index].buyer?$scope.listSeat.items[$index].buyer.id:undefined;popoverService.seatMenu.price=$scope.listSeat.items[$index].buyer?$scope.listSeat.items[$index].buyer.price:undefined;popoverService.seatMenu.listPrice=$scope.listSeat.prices;popoverService.seatMenu.onSubmit=$scope.onSeatSubmit;popoverService.seatMenu.createDate=$scope.listSeat.items[$index].buyer?$scope.listSeat.items[$index].buyer.createDate:undefined;popoverService.seatMenu.endDate=$scope.listSeat.items[$index].buyer?$scope.listSeat.items[$index].buyer.endDate:undefined}}]}}]);giasinhvienApp.directive("showSentGift",[function(){return{replace:!0,restrict:"E",templateUrl:"/Layouts/Template/ShowSentGift.html",scope:{scheduleId:"=",listGift:"="},controllerAs:"$ctrl",controller:["$scope",function($scope){$scope.$watchCollection("listGift.items",function(){$scope.listGift.items&&$scope.listGift.maximunItem&&$scope.listGift.items.length>$scope.listGift.maximunItem&&$scope.listGift.items.splice($scope.listGift.maximunItem-1,$scope.listGift.items.length-$scope.listGift.maximunItem)})}]}}]);giasinhvienApp.directive("showStatus",[function(){return{replace:!0,restrict:"E",templateUrl:"/Layouts/Template/ShowStatus.html",scope:{showInfo:"=",missionIdol:"=",missionNoel:"=",eventMissionIdol:"=",statusCode:"@",message:"=",showId:"@",starId:"@",scheduleId:"@"},controllerAs:"$ctrl",controller:["$scope","modalService","webService","sessionService","$rootScope","Notification",function($scope,modalService,webService,sessionService,$rootScope,Notification){$scope.sessionService=sessionService;$scope.Percent=0;$scope.CurrentHp=0;$scope.CurrentMiss=0;$scope.check=!1;(sessionService.userId()==5||sessionService.userId()==28)&&($scope.check=!0);$scope.statusCode==1&&($scope.TypeMission=0,$scope.NumStarPoint=0,$scope.ListGiftInfo=[],$scope.NameMission="",$scope.UserMission=undefined,$scope.NameTypeMission="",$scope.TextSmsMission="",$scope.PopupSmsMissionOne="",$scope.PopupUserImage=undefined,$scope.PopupIdolImage=undefined,$scope.PopupIdolName="",webService.call({name:"Star_GetInfoMission",data:{actionUserId:sessionService.userId(),starId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){rs.Result!=null&&(rs.Result.StateMission==0&&($scope.TypeMission=0,$scope.NameTypeMission="[CẦU HÔN]",$scope.starId==sessionService.userId()&&webService.call({name:"Star_GetListIdolQuestMission",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:5,num_Type:1,key:sessionService.key()},onSuccess:function(rrs){$scope.ListFirstMission=rrs.Items.slice(0,3);$scope.ListSecondMission=rrs.Items.slice(3,5);$("#modal-info-thang-4-1").show()}})),rs.Result.StateMission==1&&($scope.TypeMission=1,$scope.NameTypeMission="[THÁCH CƯỚI]",$scope.ListGiftInfo=rs.Result.GiftInfo,$scope.NameMission=rs.Result.questInfo.Name,$scope.UserMission=rs.Result.userInfo,$scope.NumStarPoint=rs.Result.IdolPoint),rs.Result.StateMission==2&&($scope.TypeMission=2,$scope.NameTypeMission="[CẦU HÔN]",$scope.ListGiftInfo=rs.Result.GiftInfo,$scope.NameMission=rs.Result.questInfo.Name,$scope.TextSmsMission=rs.Result.InfoSms,$scope.UserMission=rs.Result.userInfo,$scope.NumStarPoint=rs.Result.IdolPoint),rs.Result.StateMission==3&&$scope.starId==sessionService.userId()&&($scope.PopupSmsMissionOne=rs.Result.Sms,$scope.UserMission=rs.Result.User,$scope.NumStarPoint=rs.Result.IdolPoint,$("#modal-info-thang-4-2").show()));$scope.$$phase||$scope.$apply()}}),$scope.IdolAddNewQuest=missionId=>{webService.call({name:"User_StarAddIdolQuest",type:"POST",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,missionId:missionId,key:sessionService.key()},onError:function(errorCode,message){Notification.error(message)},onSuccess:function(){$("#modal-info-thang-4-1").hide()}})},$scope.onDeleteQuest=()=>{sessionService.isSigned()?sessionService.data().user.GroupUser.Id==2?modalService.showAlert({title:"Xác nhận",message:"Bạn chắc chắn muốn hủy nhiệm vụ này chứ ?",buttons:[{text:"Không",style:"btn-default",closeModal:!0},{text:"Có",style:"btn-primary",closeModal:!0,onClick:function(){$scope.onCallDeleteQuest()}}]}):Notification.error("Idol mới hủy được nhiệm vụ."):Notification.error("Bạn cần đăng nhập để nhận nhiệm vụ.")},$scope.onCallDeleteQuest=()=>{var userId=0;$scope.UserMission!=null&&$scope.UserMission!=undefined&&(userId=$scope.UserMission.Id);webService.call({name:"User_CancelIdolQuest",type:"POST",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,userId:userId,key:sessionService.key()},onError:function(errorCode,message){Notification.error(message)},onSuccess:function(rs){rs.ErrorCode==null&&($scope.TypeMission=0,$scope.NameTypeMission="[CẦU HÔN]",webService.call({name:"Star_GetListIdolQuestMission",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:5,num_Type:1,key:sessionService.key()},onSuccess:function(rrs){$scope.ListFirstMission=rrs.Items.slice(0,3);$scope.ListSecondMission=rrs.Items.slice(3,5);$("#modal-info-thang-4-1").show();$scope.$$phase||$scope.$apply()}}))}})},$scope.onRefuseQuest=()=>{$("#modal-info-thang-4-2").hide(),$scope.onCallDeleteQuest()},$scope.onAcceptQuest=()=>{$("#modal-info-thang-4-2").hide(),webService.call({name:"User_StarCompleteQuest",type:"POST",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,key:sessionService.key()},onError:function(errorCode,message){Notification.error(message)},onSuccess:function(){var userId=0;$scope.UserMission!=null&&$scope.UserMission!=undefined&&(userId=$scope.UserMission.Id);$scope.starId==sessionService.userId()}})},$scope.onClosePopupKetHon=()=>{$("#modal-info-thang-4-3").hide(),$scope.starId==sessionService.userId()&&webService.call({name:"Star_GetListIdolQuestMission",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:5,num_Type:1,key:sessionService.key()},onSuccess:function(rrs){$scope.ListFirstMission=rrs.Items.slice(0,3);$scope.ListSecondMission=rrs.Items.slice(3,5);$("#modal-info-thang-4-1").show()}})},$scope.showGetMission=function(){sessionService.isSigned()?sessionService.data().user.GroupUser.Id==2?webService.call({name:"Star_GetListIdolQuestMission",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:5,num_Type:1,key:sessionService.key()},onSuccess:function(rrs){$scope.ListFirstMission=rrs.Items.slice(0,3);$scope.ListSecondMission=rrs.Items.slice(3,5);$("#modal-info-thang-4-1").show();$scope.$$phase||$scope.$apply()}}):Notification.error("Idol mới được nhận nhiệm vụ."):Notification.error("Bạn cần đăng nhập để nhận nhiệm vụ.")},$rootScope.$on("LoadIdolNhanNhiemVu",function(){webService.call({name:"Star_GetInfoMission",data:{actionUserId:sessionService.userId(),starId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){rs.Result!=null&&(rs.Result.StateMission==1&&($scope.TypeMission=1,$scope.NameTypeMission="[THÁCH CƯỚI]",$scope.ListGiftInfo=rs.Result.GiftInfo,$scope.NameMission=rs.Result.questInfo.Name,$scope.UserMission=rs.Result.userInfo,$scope.NumStarPoint=rs.Result.IdolPoint),rs.Result.StateMission==2&&($scope.TypeMission=2,$scope.NameTypeMission="[CẦU HÔN]",$scope.ListGiftInfo=rs.Result.GiftInfo,$scope.NameMission=rs.Result.questInfo.Name,$scope.TextSmsMission=rs.Result.InfoSms,$scope.UserMission=rs.Result.userInfo,$scope.NumStarPoint=rs.Result.IdolPoint));$scope.$$phase||$scope.$apply()}})}),$rootScope.$on("LoadIdolCancelQuest",function(){$scope.starId!=sessionService.userId()&&($scope.TypeMission=0,$scope.NameTypeMission="[CẦU HÔN]")}),$rootScope.$on("LoadInfoQuestIdol",function(event,data){$scope.ListGiftInfo=data.data.GiftInfo;$scope.$$phase||$scope.$apply()}),$rootScope.$on("LoadUserDoneMissionOne",function(event,data){$scope.starId==sessionService.userId()&&($scope.PopupSmsMissionOne=data.data.Sms,$scope.UserMission=data.data.User,$scope.NumStarPoint=data.data.IdolPoint,$("#modal-info-thang-4-2").show())}),$rootScope.$on("LoadUserDoneMissionTwo",function(event,data){$scope.TypeMission=0;$scope.NameTypeMission="[CẦU HÔN]";$scope.UserMission=data.data.User;$scope.PopupUserImage=data.data.User.AvatarPhoto;$scope.PopupIdolImage=data.data.Idol.Photo;$scope.NumStarPoint=data.data.IdolPoint}),$rootScope.$on("LoadIdolAcceptQuest",function(){webService.call({name:"Star_GetInfoMission",data:{actionUserId:sessionService.userId(),starId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){rs.Result!=null&&rs.Result.StateMission==2&&($scope.TypeMission=2,$scope.NameTypeMission="[CẦU HÔN]",$scope.ListGiftInfo=rs.Result.GiftInfo,$scope.NameMission=rs.Result.questInfo.Name,$scope.TextSmsMission=rs.Result.InfoSms,$scope.UserMission=rs.Result.userInfo,$scope.NumStarPoint=rs.Result.IdolPoint);$scope.$$phase||$scope.$apply()}})}));$scope.statusCode==2&&($rootScope.$on("User_GetTopUserGranary",function(event,data){$scope.IdolValue=data.IdolValue}),webService.call({name:"User_GetTopUserGranary",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,userId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){rs.Items==null?$scope.IdolRank=0:($scope.IdolRank=rs.Items[0].Rank,$scope.IdolValue=rs.Items[0].Total);$scope.$$phase||$scope.$apply()}}));$scope.statusCode==3&&($rootScope.$on("LoadDataIdol",function(){webService.call({name:"User_GetTopUserGranary",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,type:15,userId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){$scope.ChocoValue=rs.Items==null?0:rs.Items[0].Total;$scope.$$phase||$scope.$apply()}})}),webService.call({name:"User_GetTopUserGranary",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,type:15,userId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){$scope.ChocoValue=rs.Items==null?0:rs.Items[0].Total;$scope.$$phase||$scope.$apply()}}));$scope.statusCode==4&&($rootScope.$on("LoadHoaDo",function(){webService.call({name:"Star_GetIdolInfoGiveAway",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,startdate:14887728e5,enddate:1488992399e3,starId:$scope.starId,giftId:1,key:sessionService.key()},onSuccess:function(rs){$scope.HoaDo=rs.Items==null?0:rs.Items[0].Quanlity;$scope.$$phase||$scope.$apply()}})}),webService.call({name:"Star_GetIdolInfoGiveAway",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,startdate:14887728e5,enddate:1488992399e3,starId:$scope.starId,giftId:1,key:sessionService.key()},onSuccess:function(rs){$scope.HoaDo=rs.Items==null?0:rs.Items[0].Quanlity;$scope.$$phase||$scope.$apply()}}),$rootScope.$on("LoadHoaXanh",function(){webService.call({name:"Star_GetIdolInfoGiveAway",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,startdate:14887728e5,enddate:1488992399e3,starId:$scope.starId,giftId:112,key:sessionService.key()},onSuccess:function(rs){$scope.HoaXanh=rs.Items==null?0:rs.Items[0].Quanlity;$scope.$$phase||$scope.$apply()}})}),webService.call({name:"Star_GetIdolInfoGiveAway",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,startdate:14887728e5,enddate:1488992399e3,starId:$scope.starId,giftId:112,key:sessionService.key()},onSuccess:function(rs){$scope.HoaXanh=rs.Items==null?0:rs.Items[0].Quanlity;$scope.$$phase||$scope.$apply()}}),$rootScope.$on("LoadHoaHong",function(){webService.call({name:"Star_GetIdolInfoGiveAway",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,startdate:14887728e5,enddate:1488992399e3,starId:$scope.starId,giftId:117,key:sessionService.key()},onSuccess:function(rs){$scope.HoaHong=rs.Items==null?0:rs.Items[0].Quanlity;$scope.$$phase||$scope.$apply()}})}),webService.call({name:"Star_GetIdolInfoGiveAway",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,startdate:14887728e5,enddate:1488992399e3,starId:$scope.starId,giftId:117,key:sessionService.key()},onSuccess:function(rs){$scope.HoaHong=rs.Items==null?0:rs.Items[0].Quanlity;$scope.$$phase||$scope.$apply()}}));$scope.statusCode==5&&($rootScope.$on("LoadDataIdol",function(){webService.call({name:"User_GetTopUserGranary",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,type:16,userId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){$scope.ThinhUnitType=rs.Items==null?0:rs.Items[0].Total;$scope.$$phase||$scope.$apply()}})}),webService.call({name:"User_GetTopUserGranary",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,type:16,userId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){$scope.ThinhUnitType=rs.Items==null?0:rs.Items[0].Total;$scope.$$phase||$scope.$apply()}}),$rootScope.$on("LoadCurrentDataIdol",function(){webService.call({name:"User_GetCurrentGranaryValue",data:{actionUserId:sessionService.userId(),starId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){$scope.currentThinh=rs.Result;$scope.$$phase||$scope.$apply()}})}),$scope.openListUserGiveCoin=()=>{$("#modal-event-thang-3").show(),webService.call({name:"User_GetListTopUserUseCoinInShow",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:10,scheduleId:$scope.scheduleId,showId:$scope.showId,starId:$scope.starId,startDate:-1,endDate:-1,key:sessionService.key()},onError:function(errorCode,message){$scope.currentStatus="error";$scope.currentError=message;$scope.$apply()},onSuccess:function(r){$scope.listCurrent=r.Items;$scope.currentStatus="loaded";$scope.$apply()}}),webService.call({name:"User_GetCurrentGranaryValue",data:{actionUserId:sessionService.userId(),starId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){$scope.currentThinh=rs.Result;$scope.$$phase||$scope.$apply()}})},$scope.closeListUserGiveCoin=()=>{$("#modal-event-thang-3").hide()},$scope.onStarGiveGranary=userId=>{sessionService.userId()!=$scope.starId?Notification.error("Chức năng này chỉ dành riêng cho Idol."):webService.call({name:"User_IdolGiveGranaryUser",type:"POST",data:{actionUserId:sessionService.userId(),userId:userId,scheduleId:$scope.scheduleId,key:sessionService.key()},onError:function(errorCode,message){sessionService.isSigned()?Notification.error(message):Notification.error("Bạn cần đăng nhập để thực hiện chức năng này.");$scope.resetButton=!0},onSuccess:function(r){r.Result&&webService.call({name:"User_GetCurrentGranaryValue",data:{actionUserId:sessionService.userId(),starId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){$scope.currentThinh=rs.Result;$scope.$$phase||$scope.$apply()}})}})});$scope.statusCode==6&&($scope.TypeMission=0,$scope.Mission=undefined,$scope.IdolMission=undefined,$scope.ReloadPopover=()=>{setTimeout(function(){$(".percent-level-process").popover({trigger:"hover",html:!0,content:function(){return $(".popover-data").html()}})},3e3)},$scope.SetBackGround=type=>{setTimeout(function(){type==1&&$(".mission30_4").css("background","url('/Content/Image/Event-2017/Thang4/event2_sttbr1.png')");type==2&&$(".mission30_4").css("background","url('/Content/Image/Event-2017/Thang4/event2_sttbr2.png')");type==3&&$(".mission30_4").css("background","url('/Content/Image/Event-2017/Thang4/event2_sttbr3.png')")},1500)},webService.call({name:"Star_GetInfoIdolMission",data:{actionUserId:sessionService.userId(),starId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){$scope.TypeMission=rs.Result.MissionState;$scope.Mission=rs.Result.IdolMission;$scope.IdolMission=rs.Result.IdolMissionIdol;$scope.Percent=rs.Result.Percent;$scope.CurrentHp=rs.Result.IdolMissionIdol.CurrentHp;$scope.CurrentMiss=rs.Result.IdolMission.PercentMiss;$scope.SetBackGround(rs.Result.IdolMission.TypeMission);$scope.ReloadPopover();$scope.$$phase||$scope.$apply()}}),$scope.ReloadMission=()=>{webService.call({name:"Star_GetInfoIdolMission",data:{actionUserId:sessionService.userId(),starId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){$scope.TypeMission=rs.Result.MissionState;$scope.Mission=rs.Result.IdolMission;$scope.IdolMission=rs.Result.IdolMissionIdol;$scope.Percent=rs.Result.Percent;$scope.CurrentHp=rs.Result.IdolMissionIdol.CurrentHp;$scope.CurrentMiss=rs.Result.IdolMission.PercentMiss;$scope.SetBackGround(rs.Result.IdolMission.TypeMission);$scope.ReloadPopover();$scope.$$phase||$scope.$apply()}})},$scope.IdolGetMission=type=>{webService.call({name:"Star_AddIdolMission",type:"POST",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,type:type,key:sessionService.key()},onError:function(errorCode,message){Notification.error(message)},onSuccess:function(){}})},$scope.IdolDeleteMission=()=>{sessionService.isSigned()?sessionService.data().user.GroupUser.Id==2?modalService.showAlert({title:"Xác nhận",message:"Rút lui! Mỗi ngày chỉ có thể rút lui được 1 lần Bạn có chắc chắn không??",buttons:[{text:"Không",style:"btn-default",closeModal:!0},{text:"Có",style:"btn-primary",closeModal:!0,onClick:function(){webService.call({name:"Star_DeleteIdolMission",type:"POST",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,key:sessionService.key()},onError:function(errorCode,message){Notification.error(message)},onSuccess:function(){$scope.ReloadMission()}})}}]}):Notification.error("Idol mới hủy được nhiệm vụ."):Notification.error("Bạn cần đăng nhập để nhận nhiệm vụ.")},$rootScope.$on("LoadIdolLoadMission",function(event,data){console.log(data);$scope.Percent=data.data.Percent;data.data.isCrit==1?$scope.ShowDamge(data.data.NumberMinus):$scope.ShowCrit(data.data.NumberMinus);$scope.ReloadMission()}),$rootScope.$on("LoadIdolDeleteMission",function(event,data){console.log(data);$scope.Percent=data.data.Percent;data.data.isCrit==1?$scope.ShowCrit(data.data.NumberMinus):$scope.ShowDamge(data.data.NumberMinus);$scope.ReloadMission()}),$rootScope.$on("LoadIdolUpdateMission",function(event,data){$scope.Percent=data.data.Percent;$scope.CurrentHp=data.data.IdolMissionIdol.CurrentHp;data.data.isCrit==1?$scope.ShowCrit(data.data.NumberMinus):$scope.ShowDamge(data.data.NumberMinus)}),$rootScope.$on("LoadIdolMissMission",function(){$scope.ShowMiss()}),$rootScope.$on("LoadIdolCritMission",function(event,data){$scope.Percent=data.data.Percent;$scope.ShowCrit(data.data.NumberMinus)}),$scope.ShowDamge=damge=>{var number=1+Math.floor(Math.random()*1e15),it;it="<div class='point' id='point-"+number+"'>-"+damge+"<\/div>";$(".point-list").append(it);$("#point-"+number).hide();$("#point-"+number).show();setTimeout(function(){$("#point-"+number).remove()},2e3)},$scope.ShowCrit=damge=>{var number=1+Math.floor(Math.random()*1e15),it;it="<div class='point' id='point-"+number+"'><div class='div-item' >-"+damge+"<\/div><\/div>";$(".point-list").append(it);$("#point-"+number).hide();$("#point-"+number).show();setTimeout(function(){$("#point-"+number).remove()},2e3)},$scope.ShowMiss=()=>{var number=1+Math.floor(Math.random()*1e15),it;it="<div class='point' id='point-"+number+"'><img style='width:50px' src='Content/Image/Event-2017/Thang4/event2_sttmiss.png'><\/div>";$(".point-list").append(it);$("#point-"+number).hide();$("#point-"+number).show();setTimeout(function(){$("#point-"+number).remove()},2e3)});$scope.showIdolDoneMission=function(){sessionService.isSigned()?modalService.showIdolDoneMission({starId:$scope.starId,scheduleId:$scope.scheduleId}):Notification.error("Bạn cần đăng nhập để nhận quà.")};$scope.showTakingMission=function(){sessionService.isSigned()?sessionService.data().user.GroupUser.Id==2?modalService.showTakingMission({starId:$scope.starId,scheduleId:$scope.scheduleId}):Notification.error("Idol mới được nhận nhiệm vụ."):Notification.error("Bạn cần đăng nhập để nhận nhiệm vụ.")};$scope.onCancelIdolQuest=function(){sessionService.isSigned()?sessionService.data().user.GroupUser.Id==2?modalService.showAlert({title:"Xác nhận",message:"Bạn chắc chắn muốn hủy nhiệm vụ này chứ ?",buttons:[{text:"Không",style:"btn-default",closeModal:!0},{text:"Có",style:"btn-primary",closeModal:!0,onClick:function(){webService.call({name:"User_CancelIdolQuest",type:"POST",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,key:sessionService.key()},onError:function(error){Notification.error(error)},onSuccess:function(){}})}}]}):Notification.error("Idol mới hủy được nhiệm vụ."):Notification.error("Bạn cần đăng nhập để nhận nhiệm vụ.")};$scope.RedirectRank=function(){window.open("https://teenidol.vn/dau-truong-giang-sinh","_blank")};$scope.$watchCollection("missionIdol",function(missionIdol){missionIdol&&missionIdol.NextLimit&&(0<=missionIdol.NextLimit.RewardDolar&&missionIdol.NextLimit.RewardDolar<100?$scope.class="class":100<=missionIdol.NextLimit.RewardDolar&&missionIdol.NextLimit.RewardDolar<999?$scope.class="class1":999<=missionIdol.NextLimit.RewardDolar&&missionIdol.NextLimit.RewardDolar<9999?$scope.class="class2":missionIdol.NextLimit.RewardDolar>=9999&&($scope.class="class3"))})}]}}]);giasinhvienApp.directive("ucShowToolbar",["helperService",function(){return{restrict:"E",transclude:!0,replace:!0,templateUrl:"/Layouts/Template/ucShowToolbar.html",scope:{scheduleId:"@",showId:"@",starId:"@",hideDirection:"@",isMobile:"=",onHide:"&",onShowTabUser:"&"},controllerAs:"$ctrl",controller:["$scope","sessionService","modalService","$rootScope","helperService",function($scope,sessionService,modalService){$scope.onShowRank=function(){modalService.showShowRank({data:{scheduleId:$scope.scheduleId,showId:$scope.showId,starId:$scope.starId}})};$scope.onShowOpening=function(){modalService.showShowOpening({data:{scheduleId:"",showId:"",starId:""}})};$scope.onShowSchedule=function(){modalService.showShowSchedule({data:{starId:$scope.starId}})}}]}}]);giasinhvienApp.directive("ucShowUserInfo",[function(){return{replace:!0,restrict:"E",templateUrl:"/Layouts/Template/ucShowUserInfo.html",scope:{isFullscreen:"=",onShowChanged:"&",starId:"@"},controllerAs:"$ctrl",controller:["$scope","sessionService","modalService","$rootScope","helperService",function($scope,sessionService,modalService,$rootScope,helperService){$scope.sessionService=sessionService;$scope.helper=helperService;$scope.onLogin=function(){$rootScope.$broadcast("onLogin")};$scope.onLogout=function(){$rootScope.$broadcast("onLogout")};$scope.onShowReport=function(starId){$("head").append('<script src="App_Lib/html2canvas-0.5.0-alpha1/html2canvas.min.js"><\/script>');modalService.showReport({data:{starId:starId}})};$scope.onUserMission=function(){$rootScope.$broadcast("onUserMission")};$scope.onUserMission=function(){$rootScope.$broadcast("onUserMission")};$scope.onUserDayCheck=function(){$rootScope.$broadcast("onUserDayCheck")}}]}}]);giasinhvienApp.directive("unitChanged",[function(){return{replace:!0,restrict:"E",templateUrl:"/Layouts/Template/UnitChanged.html",scope:{scheduleId:"@",starId:"@",showId:"@",message:"="},controllerAs:"$ctrl",controller:["$scope","modalService","webService","sessionService","$rootScope","Notification",function($scope,modalService,webService,sessionService,$rootScope,Notification){$scope.eventId=6;$scope.sessionService=sessionService;$scope.eventId==3&&($scope.resetButton=!0,$scope.nameMission="",$scope.failSms="",$scope.currNum=0,$scope.currId=null,$scope.currName=null,$scope.listReward=null,webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:12,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberSuaTuoi=r.Result?r.Result.Value:0}}),$scope.$on("LoadSoSuaTuoi",function(event,data){$scope.numberSuaTuoi=data.number}),webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:13,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberCaCao=r.Result?r.Result.Value:0}}),$scope.$on("LoadSoCaCao",function(event,data){$scope.numberCaCao=data.number}),webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:14,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberCo=r.Result?r.Result.Value:0}}),$scope.$on("LoadSoCo",function(event,data){$scope.numberCo=data.number}),$scope.$on("LoadThongTinUser",function(){webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:12,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberSuaTuoi=r.Result?r.Result.Value:0}});webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:13,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberCaCao=r.Result?r.Result.Value:0}});webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:14,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberCo=r.Result?r.Result.Value:0}})}),webService.call({name:"User_GetGranaryInfo",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:7,key:sessionService.key()},onError:function(){},onSuccess:function(rs){rs.Items?($scope.ListFirstItems=rs.Items.slice(0,4),$scope.ListSecondItems=rs.Items.slice(4,7)):Notification.error("Không tìm thấy thông tin đổi quà!")}}),$scope.ViewGift=function(requireId,name){webService.call({name:"User_GetGranaryRewardInfo",type:"GET",data:{actionUserId:sessionService.userId(),requireId:requireId,key:sessionService.key()},onError:function(){},onSuccess:function(r){$("#modal-info-thang-1").show();$scope.nameMissionInfo=name;$scope.listRewardInfo=r.Result.reward}})},$scope.ChangeGift=function(requireId,name){sessionService.isSigned()||Notification.error("Bạn cần đăng nhập để thực hiện chức năng này.");modalService.showAlert({title:"Xác nhận",message:"Bạn chắc chắn muốn đổi lấy gói quà "+name+" này không ?",buttons:[{text:"Không",style:"btn-primary",closeModal:!0},{text:"Có",style:"btn-primary",closeModal:!0,onClick:function(){webService.call({name:"User_GetGranaryReward",type:"POST",data:{actionUserId:sessionService.userId(),requireId:requireId,starId:$scope.starId,scheduleId:$scope.scheduleId,key:sessionService.key()},onError:function(errorCode,message){sessionService.isSigned()?Notification.error(message):Notification.error("Bạn cần đăng nhập để thực hiện chức năng này.");$scope.resetButton=!0},onSuccess:function(r){$("#modal-event-thang-fail").hide();r.Result?($scope.nameMission=name,$scope.listReward=r.Result.reward,$("#modal-event-thang-1").show(),webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:3,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberGauNep=r.Result?r.Result.Value:0}}),webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:4,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberDauXanh=r.Result?r.Result.Value:0}}),webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:5,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberThitMo=r.Result?r.Result.Value:0}}),webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:6,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberLaDong=r.Result?r.Result.Value:0}}),webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:7,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberLaChuoi=r.Result?r.Result.Value:0}}),webService.call({name:"User_GetTopUserGranary",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,userId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){rs.Items==null?$scope.IdolRank=0:($scope.IdolRank=rs.Items[0].Rank,$scope.IdolValue=rs.Items[0].Total);$rootScope.$broadcast("User_GetTopUserGranary",{IdolValue:$scope.IdolValue})}})):Notification.error(r.Message)}})}}]})},$scope.ChangeGift2=function(requireId,name){$("#modal-event-thang-fail").hide();sessionService.isSigned()||Notification.error("Bạn cần đăng nhập để thực hiện chức năng này.");webService.call({name:"User_GetGranaryReward",type:"POST",data:{actionUserId:sessionService.userId(),requireId:requireId,starId:$scope.starId,scheduleId:$scope.scheduleId,key:sessionService.key()},onError:function(errorCode,message){sessionService.isSigned()?Notification.error(message):Notification.error("Bạn cần đăng nhập để thực hiện chức năng này.");$scope.resetButton=!0},onSuccess:function(r){r.Result?($scope.nameMission=name,$scope.listReward=r.Result.reward,$("#modal-event-thang-1").show(),webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:3,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberGauNep=r.Result?r.Result.Value:0}}),webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:4,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberDauXanh=r.Result?r.Result.Value:0}}),webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:5,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberThitMo=r.Result?r.Result.Value:0}}),webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:6,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberLaDong=r.Result?r.Result.Value:0}}),webService.call({name:"User_GetUserGranary",data:{actionUserId:sessionService.userId(),typeId:7,key:sessionService.key()},onError:function(){},onSuccess:function(r){$scope.numberLaChuoi=r.Result?r.Result.Value:0}}),webService.call({name:"User_GetTopUserGranary",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:1,userId:$scope.starId,key:sessionService.key()},onSuccess:function(rs){rs.Items==null?$scope.IdolRank=0:($scope.IdolRank=rs.Items[0].Rank,$scope.IdolValue=rs.Items[0].Total);$rootScope.$broadcast("User_GetTopUserGranary",{IdolValue:$scope.IdolValue})}})):Notification.error(r.Message)}})},$scope.closeModal=()=>{$("#modal-event-thang-1").hide()},$scope.closeModalInfo=()=>{$("#modal-info-thang-1").hide()},$scope.showModalFail=(id,name,listRequire)=>{for(var i=0;i<listRequire.length;i++)console.log(listRequire[i].UnitType.Id),listRequire[i].UnitType.Id==14&&($scope.currNum=listRequire[i].RequireData.Value);$scope.currId=id;$scope.currName=name;$scope.failSms="Bạn cần "+$scope.currNum+" Cỏ Bốn Lá để hoàn thành gói "+name;$("#modal-event-thang-fail").show()},$scope.closeModalFail=()=>{$("#modal-event-thang-fail").hide()});$scope.eventId==5&&(webService.call({name:"User_GetListCollection",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:5,showId:$scope.showId,key:sessionService.key()},onError:function(){},onSuccess:function(rs){rs.Items?$scope.ListCollection=rs.Items:Notification.error("Không tìm thấy thông tin bộ ghế!")}}),$scope.$on("LoadSoSuaTuoi",function(){webService.call({name:"User_GetListCollection",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:5,key:sessionService.key()},onError:function(){},onSuccess:function(rs){rs.Items?$scope.ListCollection=rs.Items:Notification.error("Không tìm thấy thông tin bộ ghế!")}})}));$scope.showInfo=function(eee){$(".info-"+eee).show();$(".icon-"+eee).hide()};$scope.hideInfo=function(eee){$(".info-"+eee).hide();$(".icon-"+eee).show()}}]}}]);giasinhvienApp.directive("userListItem",[function(){return{replace:!0,restrict:"E",templateUrl:"/Layouts/Template/UserListItem.html",scope:{link:"@",linkNewTab:"=",userId:"@",avatar:"@",name:"@",vipName:"@",vipPhoto:"@",vipColor:"@",levelName:"@",levelPhoto:"@",nextLevelPointNeed:"@",display:"@",nameGuild:"@",iconGuild:"@",groupId:"@",isfollowIdol:"=",coin:"=",freeCoin:"=",onClick:"&"},controllerAs:"$ctrl",controller:["$scope","helperService",function($scope,helperService){$scope.helper=helperService}]}}]);giasinhvienApp.directive("ucFollowButton",[function(){return{restrict:"E",replace:!0,scope:{status:"@",targetUserId:"@"},templateUrl:"/Views/UserControl/ucFollowButton.html",controllerAs:"$ctrl",controller:["$scope","webService","sessionService","authenticationService","Notification",function($scope,webService,sessionService,authenticationService,Notification){$scope.showIt=function(){$(event.target).closest(".uc-follow-button.followed .fa").addClass("fa-remove");$(event.target).closest(".uc-follow-button.followed").removeClass("followed")};$scope.hideIt=function(){$(event.target).closest(".uc-follow-button .fa-check").removeClass("fa-remove");$(event.target).closest(".uc-follow-button").addClass("followed")};$scope.Follow=function(event){if(!$(event).hasClass("loading")){if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}$(event).addClass("loading");webService.call({type:"POST",name:"User_FollowUser",data:{currentUserId:sessionService.userId(),followUserId:$scope.targetUserId,isFollow:$scope.status!=1,key:sessionService.key()},displayError:!0,onError:function(){$(event).removeClass("loading")},onSuccess:function(){$(event).removeClass("loading");$scope.status!=1?(Notification.success("Đã theo dõi"),$scope.status=1):(Notification.success("Đã hủy theo dõi"),$scope.status=0);showController.onUpdateEventNoel();$scope.$$phase||$scope.$apply()}})}}}],link:function(){}}}]);giasinhvienApp.directive("ucMenuUser",["$routeParams",function($routeParams){return{restrict:"E",transclude:!0,replace:!0,scope:{id:"@",active:"@"},template:"<ul class='uc-menu-user left-panel'><li ng:class=\"{true: 'active', false: ' '}[active == 1]\"><a href='/user/{{userId}}'><i class='fa fa-user'><\/i>Thông tin cá nhân<\/a><\/li><li ng-if='id == userId' ng:class=\"{true: 'active', false: ' '}[active == 2]\"><a href='/user/{{userId}}/inbox'><i class='fa fa-envelope'><\/i>Hộp thư<\/a><\/li><li ng:class=\"{true: 'active', false: ' '}[active == 3]\"><a href='/user/{{userId}}/follow'><i class='fa fa-users'><\/i>Danh sách theo dõi<\/a><\/li><li ng-if='id == userId' ng:class=\"{true: 'active', false: ' '}[active == 4]\"><a href='/user/{{userId}}/modroom'><i class='fa fa-tv'><\/i>Quản lý phòng<\/a><\/li><li ng:class=\"{true: 'active', false: ' '}[active == 5]\"><a href='/user/{{userId}}/inventory'><i class='fa fa-money'><\/i>Trang bị<\/a><\/li><li ng-if='id == userId' ng:class=\"{true: 'active', false: ' '}[active == 6]\"><a href='/user/{{userId}}/coinLog'><i class='fa fa-clock-o'><\/i>Lịch sử thu-chi<\/a><\/li><li  ng:class=\"{true: 'active', false: ' '}[active == 7]\"><a href='/user/{{userId}}/reward'><i class='fa fa-gift'><\/i>Phần thưởng<\/a><\/li><\/ul>",link:function(scope){scope.id||(scope.id=scope.id);scope.active||(scope.active=scope.leftpanel);scope.userId=$routeParams.id}}}]);giasinhvienApp.directive("ucPrivateMessage",["webService","sessionService","helperService","Notification","authenticationService","signalRService",function(webService,sessionService,helperService,Notification,authenticationService,signalRService){var controller=function($scope,$element){$scope._ctrl=this;$scope.helper=helperService;$scope.sessionService=sessionService;$scope.hub=signalRService.hub();$scope.status="loading";$scope.error=undefined;$scope.listStatus="loading";$scope.listError=undefined;$scope.listTopTargetId=undefined;$scope.listTopTarget=[];$scope.listTarget=[];$scope.listMessage=[];$scope.autoScroll=!0;$scope.targetUserId=undefined;$scope.messageGroupId=undefined;$scope.messagePageIndex=undefined;$scope.messagePageCount=undefined;this.load=function(listTopTargetId){$scope.numberOfConversation=getOrDefault($scope.numberOfConversation,4);$scope.listTopTargetId=listTopTargetId;$scope._ctrl.refresh();$scope.$watch("targetUserId",$scope.onTargetSelected)};this.refresh=function(){sessionService.isSigned()?$scope.hub.invoke("ConnectMessenger",$scope.hub.connection.id,sessionService.userId()).done(function(){webService.call({name:"User_GetListUserByListID",data:{actionUserId:sessionService.userId(),listID:$scope.listTopTargetId.join(),pageIndex:0,pageSize:999999,key:sessionService.key()},onError:function(errorCode,message){$scope.status="error";$scope.error=message;$scope.$apply()},onSuccess:function(r){$scope.listTopTarget=[];$(r.Items).each(function(i,x){x.User.Id!==sessionService.data().user.User.Id&&$scope.listTopTarget.push({id:x.User.Id,name:x.User.Name,avatar:x.User.AvatarPhoto,unreadMessage:0})});!$scope.targetUserId&&$scope.listTopTarget[0]&&($scope.targetUserId=$scope.listTopTarget[0].id);$scope.status="loaded";$scope.$apply()}});webService.call({name:"User_GetListUserMessageGroup",data:{actionUserId:sessionService.userId(),userId:sessionService.userId(),pageIndex:0,pageSize:$scope.numberOfConversation,rejectUserId:$scope.starId,scheduleId:-1,key:sessionService.key()},onError:function(errorCode,message){$scope.status="error";$scope.error=message;$scope.$apply()},onSuccess:function(r){$scope.listTarget=[];$(r.Items).each(function(i,x){var target;(target=x.FromUser.Id!==sessionService.userId()?x.FromUser:x.ToUser,target.Id!==sessionService.data().user.User.Id)&&$scope.listTarget.push({id:target.Id,name:target.Name,avatar:target.AvatarPhoto,unreadMessage:0})});!$scope.targetUserId&&$scope.listTarget[0]&&($scope.targetUserId=$scope.listTarget[0].id);$scope.status="loaded";$scope.$apply()}})}):($scope.status="warning",$scope.error="Bạn cần đăng nhập")};this.scrollToBottom=function(){var $list=$element.find(".list-message");$list.scrollTop($list[0].scrollHeight)};this.addTarget=function(userId,name,avatar){var index=-1;$($scope.listTopTarget).each(function(i,x){if(x.id===userId)return index=i,!1});index===-1&&$($scope.listTarget).each(function(i,x){if(x.id===userId)return index=i,!1});index===-1&&$scope.listTarget.splice(0,0,{id:userId,name:name,avatar:avatar,unreadMessage:0});$scope.targetUserId=userId};this.addMessage=function(message,date,user){message=helperService.formatMessage(message);$scope.listMessage.push({message:message,date:date,user:user});$scope.$apply();$scope.autoScroll&&$scope._ctrl.scrollToBottom()};$scope.$on("signalrOnPrivateMessage",function(event,user,message){if(user.id!==$scope.targetUserId){var done=!1;$($scope.listTopTarget).each(function(i,x){if(x.id===user.id)return x.unreadMessage+=1,done=!0,!1});done||$($scope.listTarget).each(function(i,x){if(x.id===user.id)return x.unreadMessage+=1,!1});return}if($scope._ctrl.addMessage(message.content,message.date,{id:user.id,name:user.name,avatar:user.avatar}),typeof $scope._ctrl.onNewMessage=="function")$scope._ctrl.onNewMessage(user.id)});$scope.onTextKeyPress=function($event){if($event.keyCode===13&&$event.shiftKey===!1){$event.preventDefault();$scope.onSendMessage({target:$($event.target).closest("form")})}};$scope.onTargetSelect=function(id){$scope.targetUserId=id;var done=!1;$($scope.listTopTarget).each(function(i,x){if(x.id===id)return x.unreadMessage=0,done=!0,!1});done||$($scope.listTarget).each(function(i,x){if(x.id===id)return x.unreadMessage=0,!1})};$scope.onTargetSelected=function(newValue){newValue?($scope.listStatus="loading",webService.call({name:"User_GetUserMessageGroupByUserId",data:{actionUserId:sessionService.userId(),userId:$scope.targetUserId,key:sessionService.key()},onError:function(errorCode,message){$scope.listStatus="error";$scope.listError=message;$scope.$apply()},onSuccess:function(gr){$scope.messagePageIndex=0;$scope.messagePageCount=0;$scope.messageGroupId=gr.Result?gr.Result.Id:undefined;$scope.listMessage=[];$scope.messageGroupId?webService.call({name:"User_GetListMessage",data:{actionUserId:sessionService.userId(),userGroupMessageId:$scope.messageGroupId,pageIndex:$scope.messagePageIndex,pageSize:10,key:sessionService.key()},onError:function(errorCode,message){$scope.listStatus="error";$scope.listError=message;$scope.$apply()},onSuccess:function(r){var i,x;if($scope.messagePageCount=r.PageCount,$scope.listMessage=[],r.Items.length>=0)for(i=r.Items.length-1;i>=0;i--)x=r.Items[i],$scope._ctrl.addMessage(x.Message.Content,x.Message.CreateDate,{id:x.User.Id,name:x.User.Name,avatar:x.User.AvatarPhoto});$scope.listStatus="loaded";$scope.$apply();$scope._ctrl.scrollToBottom()}}):($scope.listStatus="loaded",$scope.$apply())}})):($scope.listStatus="warning",$scope.listError="Bạn chưa chọn đối tượng để trò chuyện")};$scope.onSendMessage=function($event){var $target=$($event.target),$button=$target.find("[type=submit]");if(!$scope.helper.isLoading($button)){if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}if(!$scope.targetUserId){Notification.warning({message:"Bạn chưa chọn đối tượng để trò chuyện !",delay:3e3,positionY:"bottom",positionX:"right"});return}if(!$target.find("textarea.message-text").val()){Notification.warning({message:"Bạn chưa nhập tin nhắn !",delay:3e3,positionY:"bottom",positionX:"right"});return}webService.call({type:"POST",name:"User_SentMessage",data:{actionUserId:sessionService.userId(),toUserId:$scope.targetUserId,content:$element.find("textarea.message-text").val(),key:sessionService.key()},displayError:!0,onSuccess:function(r){$element.find("textarea.message-text").val("");$scope._ctrl.addMessage(r.Result.Content,r.Result.CreateDate,{id:sessionService.data().user.User.Id,name:sessionService.data().user.User.Name,avatar:sessionService.data().user.User.AvatarPhoto})}})}};$scope.onLoadMore=function(){$scope.messagePageIndex+=1;webService.call({name:"User_GetListMessage",data:{actionUserId:sessionService.userId(),userGroupMessageId:$scope.messageGroupId,pageIndex:$scope.messagePageIndex,pageSize:10,key:sessionService.key()},onError:function(errorCode,message){$scope.listStatus="error";$scope.listError=message;$scope.$apply()},onSuccess:function(r){for(var x,i=r.Items.length-1;i>=0;i--)x=r.Items[i],$scope.listMessage.unshift({message:helperService.formatMessage(x.Message.Content),date:x.Message.CreateDate,user:{id:x.User.Id,name:x.User.Name,avatar:x.User.AvatarPhoto}});$scope.$apply()}})}};return{restrict:"E",replace:!0,scope:{numberOfConversation:"@"},templateUrl:"/Views/UserControl/ucPrivateMessage.html",controller:controller}}]);giasinhvienApp.directive("ucShopCatelogyItem",["helperService","sessionService","webService","authenticationService","Notification","modalService",function(helperService,sessionService,webService,authenticationService,Notification,modalService){var controller=function($scope){$scope._ctrl=this;$scope.BuyItems=function(event){var itemId=$(event.target).closest("button").data("id"),purchaseId=$("select[name=listPrice-"+itemId+"]").val();if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}modalService.showAlert({title:"Xác nhận",message:"Bạn chắc chắn muốn mua vật phẩm này chứ?",buttons:[{text:"Không",style:"btn-default",closeModal:!0},{text:"Có",style:"btn-default",closeModal:!0,onClick:function(){webService.call({type:"POST",name:"User_BuyItems",data:{actionUserId:sessionService.userId(),itemId:itemId,purchaseId:purchaseId,isVipItem:!1,key:sessionService.key()},onError:function(errorCode,message){Notification.error(message)},onSuccess:function(r){Notification.success("Mua Vật Phẩm "+r.Result.Name+"  Thành Công !");$scope.$apply()}})}}]})};$scope.BuyItemsGuild=function(event){var itemId=$(event.target).closest("button").data("id"),purchaseId=$("select[name=listPrice-"+itemId+"]").val();if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}modalService.showAlert({title:"Xác nhận",message:"Bạn chắc chắn muốn mua vật phẩm này chứ?",buttons:[{text:"Không",style:"btn-default",closeModal:!0},{text:"Có",style:"btn-default",closeModal:!0,onClick:function(){webService.call({type:"POST",name:"User_BuyItemsForGuild",data:{actionUserId:sessionService.userId(),itemId:itemId,purchaseId:purchaseId,isVipItem:!1,guildId:sessionService.data().user.Guild.Id,key:sessionService.key()},onError:function(errorCode,message){Notification.error(message)},onSuccess:function(r){Notification.success("Mua Vật Phẩm "+r.Result.Name+"  Thành Công !");$scope.$apply()}})}}]})}};return{restrict:"E",transclude:!0,replace:!0,controller:controller,scope:{id:"@",buy:"@",isbuy:"@",avatar:"@",name:"@",listPrice:"@",catelogyModel:"="},templateUrl:"/Views/UserControl/ucShopCatelogyItem.html",link:function(scope){console.log(scope);scope.catelogyModel&&(scope.id||(scope.id=scope.catelogyModel.AnimationItem.Id),scope.avatar||(scope.avatar=scope.catelogyModel.AnimationItem.PhotoLink),scope.name||(scope.name=scope.catelogyModel.AnimationItem.Name),scope.listPrice||(scope.listPrice=scope.catelogyModel.ListItemPurchase))}}}]);giasinhvienApp.directive("ucShopVipItem",["helperService","sessionService","webService","authenticationService","Notification","modalService",function(helperService,sessionService,webService,authenticationService,Notification,modalService){var controller=function($scope){$scope._ctrl=this;$scope.BuyItems=function(event){var itemId=$(event.target).closest("button").data("id"),purchaseId=$("select[name=listPricevip-"+itemId+"]").val();if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}modalService.showAlert({title:"Xác nhận",message:"Bạn chắc chắn muốn mua vật phẩm này chứ?",buttons:[{text:"Không",style:"btn-default",closeModal:!0},{text:"Có",style:"btn-default",closeModal:!0,onClick:function(){webService.call({type:"POST",name:"User_BuyItems",data:{actionUserId:sessionService.userId(),itemId:itemId,purchaseId:purchaseId,isVipItem:!0,key:sessionService.key()},onError:function(errorCode,message){Notification.error(message)},onSuccess:function(r){Notification.success("Mua Vật Phẩm "+r.Result.Name+" Thành Công !");$scope.$apply()}})}}]})};$scope.hoverIn=function(){$(event.target).closest(".vip-item .info.pull-right").trigger("click")};$scope.hoverOut=function(){$scope.hoverEdit=!1}};return{restrict:"E",transclude:!0,replace:!0,controller:controller,scope:{id:"@",avatar:"@",name:"@",listPrice:"@",ListFeatures:"@",vipModel:"="},templateUrl:"/Views/UserControl/ucShopVipItem.html",link:function(scope){scope.vipModel&&(scope.id||(scope.id=scope.vipModel.VipItem.Id),scope.avatar||(scope.avatar=scope.vipModel.VipItem.StorePhoto),scope.name||(scope.name=scope.vipModel.VipItem.Name),scope.listPrice||(scope.listPrice=scope.vipModel.ListPurchases),scope.ListFeatures||(scope.ListFeatures=scope.vipModel.ListFeatures));scope.Description="";$(scope.ListFeatures).each(function(j,x){scope.Description+=x.Description+"<br />- "})}}}]);giasinhvienApp.directive("ucShowAction",["webService","sessionService","helperService","formService","authenticationService","notificationService",function(webService,sessionService,helperService,formService,authenticationService,notificationService){var controller=function($scope){$scope._ctrl=this;$scope.helper=helperService;$scope.sessionService=sessionService;$scope.starId=undefined;$scope.scheduleId=undefined;$scope.newActionName=undefined;$scope.newActionCoin=100;$scope.starActionStatus="loading";$scope.starActionError=undefined;$scope.listStarAction=[];$scope.userActionStatus="loading";$scope.userActionError=undefined;$scope.listUserAction=[];this.loadStarAction=function(starId,scheduleId){$scope.starId=starId;$scope.scheduleId=scheduleId;$scope._ctrl.refreshStarAction()};this.refreshStarAction=function(){webService.call({name:"Show_GetListRepertoireOfStar",data:{actionUserId:sessionService.userId(),starId:$scope.starId,pageIndex:0,pageSize:999999,key:sessionService.key()},onError:function(errorCode,message){$scope.starActionStatus="error";$scope.starActionError=message;$scope.$apply()},onSuccess:function(r){$scope.listStarAction=r.Items;$scope.starActionStatus="loaded";$scope.$apply()}})};this.addStarAction=function(id,name,coin,totalVote){$scope.listUserAction.push({Repertoire:{Id:id,Name:name,Price:coin,TotalVote:totalVote}});$scope.$apply()};this.loadUserAction=function(starId,scheduleId){$scope.scheduleId=scheduleId;$scope._ctrl.refreshUserAction()};this.refreshUserAction=function(){webService.call({name:"Show_GetListWishList",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,pageIndex:0,pageSize:999999,minPrice:0,key:sessionService.key()},onError:function(errorCode,message){$scope.userActionStatus="error";$scope.userActionError=message;$scope.$apply()},onSuccess:function(r){$scope.listUserAction=r.Items;$scope.userActionStatus="loaded";$scope.$apply()}})};this.addUserAction=function(id,name,coin,userId,userName){$scope.listUserAction.push({WishList:{Id:id,Content:name,CurrentPrice:coin},FromUserId:{Id:userId,Name:userName}});$scope.$apply()};$scope.onVoteStarAction=function($event){var $target=$($event.target.closest("button")),$actionItem=$($event.target.closest(".star-action-item")),actionItem;if(!formService.isLoading($target)){if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}actionItem=$scope.listStarAction[$actionItem.data("index")];$target.button("loading");webService.call({type:"POST",name:"Repertoire_Vote",data:{actionUserId:sessionService.userId(),repertoiseId:actionItem.Repertoire.Id,scheduleId:$scope.scheduleId,key:sessionService.key()},displayError:!0,onError:function(){$target.button("reset")},onSuccess:function(r){if($target.button("reset"),actionItem.Repertoire.TotalVote=r.Result.TotalVote,$scope.$apply(),typeof $scope._ctrl.onAfterVoteStarAction=="function")$scope._ctrl.onAfterVoteStarAction({id:r.Result.Id,name:r.Result.Name,coin:r.Result.Price,voteTotal:r.Result.TotalVote})}})}};$scope.onCheckStarAction=function($event){var $target=$($event.target.closest("button")),$actionItem=$($event.target.closest(".star-action-item")),actionItem;if(!formService.isLoading($target)){if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}actionItem=$scope.listStarAction[$actionItem.data("index")];notificationService.showAlert({title:"Hoàn thành tiết mục",body:"Bạn đã hoàn tất tiết mục?",buttons:[{text:"Không",type:"close"},{text:"Có",type:"close",onClick:function(){$target.button("loading");webService.call({type:"POST",name:"Star_ResetVote",data:{actionUserId:sessionService.userId(),repertoiseId:actionItem.Repertoire.Id,scheduleId:$scope.scheduleId,key:sessionService.key()},displayError:!0,onError:function(){$target.button("reset")},onSuccess:function(r){if($target.button("reset"),actionItem.Repertoire.TotalVote=r.Result.TotalVote,$scope.$apply(),typeof $scope._ctrl.onAfterVoteStarAction=="function")$scope._ctrl.onAfterResetStarAction({id:r.Result.Id,name:r.Result.Name,coin:r.Result.Price,voteTotal:r.Result.TotalVote})}})}}]})}};$scope.onDeleteStarAction=function($event){var $target=$($event.target.closest("button")),$actionItem=$($event.target.closest(".star-action-item")),actionItemIndex,actionItem;if(!formService.isLoading($target)){if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}actionItemIndex=$actionItem.data("index");actionItem=$scope.listStarAction[actionItemIndex];notificationService.showAlert({title:"Xóa yêu cầu",body:"Bạn muốn xóa tiết mục này",buttons:[{text:"Không",type:"close"},{text:"Có",type:"close",onClick:function(){$target.button("loading");webService.call({type:"POST",name:"Star_DeleteRepertorise",data:{actionUserId:sessionService.userId(),repertoiseId:actionItem.Repertoire.Id,scheduleId:$scope.scheduleId,key:sessionService.key()},displayError:!0,onError:function(){$target.button("reset")},onSuccess:function(r){if($target.button("reset"),$scope.listStarAction.splice(actionItemIndex,1),$scope.$apply(),typeof $scope._ctrl.onAfterDeleteStarAction=="function")$scope._ctrl.onAfterDeleteStarAction({id:r.Result.Id,name:r.Result.Name,coin:r.Result.Price,voteTotal:r.Result.TotalVote})}})}}]})}};$scope.onCheckUserAction=function($event){var $target=$($event.target.closest("button")),$actionItem=$($event.target.closest(".user-action-item")),actionItemIndex,actionItem;if(!formService.isLoading($target)){if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}actionItemIndex=$actionItem.data("index");actionItem=$scope.listUserAction[actionItemIndex];notificationService.showAlert({title:"Hoàn thành yêu cầu",body:"Bạn đã hoàn thành yêu cầu này?",buttons:[{text:"Không",type:"close"},{text:"Có",type:"close",onClick:function(){$target.button("loading");webService.call({type:"POST",name:"Star_DeleteRepertorise",data:{actionUserId:sessionService.userId(),repertoiseId:actionItem.Repertoire.Id,scheduleId:$scope.scheduleId,key:sessionService.key()},displayError:!0,onError:function(){$target.button("reset")},onSuccess:function(r){if($target.button("reset"),$scope.listUserAction.splice(actionItemIndex,1),$scope.$apply(),typeof $scope._ctrl.onAfterCheckUserAction=="function")$scope._ctrl.onAfterCheckUserAction({id:r.Result.WishList.Id,name:r.Result.WishList.Content,coin:r.Result.WishList.CurrentPrice,userId:r.Result.FromUserId.Id,userName:r.Result.FromUserId.Name})}})}}]})}};$scope.onPostNewAction=function($event){var $target=$($event.target),$button=$target.find("[type=submit]");if(!formService.isLoading($button)){if($scope.newActionCoin=$scope.newActionCoin*1,!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}formService.validate({target:$button,rule:[{check:function(){return isNoUoW($scope.newActionName)===!1},message:"Bạn chưa nhập tên tiết mục."}]})&&($button.button("loading"),webService.call({type:"POST",name:"User_UserRequestWishList",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,starId:$scope.starId,coin:$scope.newActionCoin,content:$scope.newActionName,isNewVersion:!0,key:sessionService.key()},displayError:!0,onError:function(){$button.button("reset")},onSuccess:function(r){if($button.button("reset"),$scope.newActionName=undefined,$scope.newActionCoin=100,$scope.$apply(),sessionService.isSigned()&&sessionService.userId()===$scope.starId){if($scope._ctrl.addStarAction(0,0,0,0),typeof $scope._ctrl.onAfterPostStarAction=="function")$scope._ctrl.onAfterPostStarAction({id:0,name:0,coin:0,totalVote:0})}else if($scope._ctrl.addUserAction(r.Result.WishList.Id,r.Result.WishList.Content,r.Result.WishList.CurrentPrice,r.Result.FromUserId.Id,r.Result.FromUserId.Name),typeof $scope._ctrl.onAfterPostUserAction=="function")$scope._ctrl.onAfterPostUserAction({id:r.Result.WishList.Id,name:r.Result.WishList.Content,coin:r.Result.WishList.CurrentPrice,userId:r.Result.FromUserId.Id,userName:r.Result.FromUserId.Name})}}))}}};return{restrict:"E",replace:!0,scope:!0,templateUrl:"/Views/UserControl/ucShowAction.html",controller:controller}}]);giasinhvienApp.directive("ucShowControl",["helperService","sessionService","webService","modalService","Notification",function(helperService,sessionService,webService,modalService,Notification){var controller=function($scope,$element){$scope._ctrl=this;$scope.helper=helperService;$scope.sessionService=sessionService;$scope.status="loading";$scope.showId=undefined;$scope.showStatus=undefined;$scope.showName=undefined;$scope.showDescription=undefined;$scope.showPhoto=undefined;this.load=function(showId,showStatus,showName,showDescription,showPhoto){$scope.showId=showId;$scope.showStatus=showStatus;$scope.showName=showName;$scope.showDescription=showDescription;$scope.showPhoto=showPhoto;$(".image-cropper").cropit({imageBackground:!0});$scope.status="loaded";$scope.$apply()};$scope.onStartShow=function(){modalService.showAlert({title:"Bắt đầu diễn",message:"Bạn đã sẵn sàng để diễn?",buttons:[{text:"Không",style:"btn-default",closeModal:!0},{text:"Có",style:"primary",closeModal:!0,onClick:function(){webService.call({type:"POST",name:"Show_StartShow",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,key:sessionService.key()},displayError:!0,onSuccess:function(){$scope.showStatus=2;$scope.$apply()}})}}]})};$scope.onStopShow=function(){modalService.showAlert({title:"Bắt đầu diễn",message:"Bạn muốn kết thúc show diễn?",buttons:[{text:"Không",style:"btn-default",closeModal:!0},{text:"Có",style:"btn-primary",closeModal:!0,onClick:function(){webService.call({type:"POST",name:"Show_EndShow",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,key:sessionService.key()},displayError:!0,onSuccess:function(){$scope.showStatus=3;$scope.$apply()}})}}]})};$scope.onPauseShow=function(){modalService.showAlert({title:"Bắt đầu diễn",message:"Bạn muốn tạm ngưng diễn?",buttons:[{text:"Không",style:"default",closeModal:!0},{text:"Có",style:"primary",closeModal:!0,onClick:function(){webService.call({type:"POST",name:"Show_PauseShow",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,key:sessionService.key()},displayError:!0,onSuccess:function(){$scope.showStatus=1;$scope.$apply()}})}}]})};$scope.onUploadImage=function(){$element.find(".image-cropper .cropit-image-input.hidden").trigger("click")};$scope.onEditShow=function($event){var $target=$($event.target),$button=$target.find("[type=submit]"),img;if($button.button("loading"),!$scope.showName||!$scope.showDescription){$scope.showName&&Notification.error("Bạn chưa nhập tên show");$scope.showDescription&&Notification.error("Bạn chưa nhập mô tả show");$button.button("reset");return}webService.call({type:"POST",name:"Show_UpdateDescription",data:{showId:$scope.showId,actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,name:$scope.showName,content:$scope.showDescription,key:sessionService.key()},displayError:!0,onError:function(){$button.button("reset")},onSuccess:function(){$button.button("reset")}});img=$element.find(".image-cropper").cropit("export",{type:"image/jpeg",quality:1,originalSize:!0});img?webService.call({type:"POST",name:"User_UploadPhoto",data:{actionUserId:sessionService.userId(),base64Photo:img.substring(23),key:sessionService.key()},displayError:!0,onError:function(){$button.button("reset")},onSuccess:function(imgLink){webService.call({type:"POST",name:"Show_UpdatePhoto",data:{showId:$scope.showId,actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,photoLink:imgLink.Result,key:sessionService.key()},displayError:!0,onError:function(){$button.button("reset")},onSuccess:function(){$button.button("reset");$("#modal-edit-show").modal("hide")}})}}):$("#modal-edit-show").modal("hide")}};return{restrict:"E",replace:!0,scope:!0,templateUrl:"/Views/UserControl/ucShowControl.html",controller:controller}}]);giasinhvienApp.directive("ucShowGlobalMessage",["webService","sessionService","helperService","authenticationService","Notification",function(webService,sessionService,helperService,authenticationService,Notification){var controller=function($scope,$element){$scope._ctrl=this;$scope.helper=helperService;$scope.sessionService=sessionService;$scope.scheduleId=undefined;$scope.listMessage=[];$scope.messageTarget=undefined;$scope.autoScroll=!0;$scope.targetUserId=undefined;this.load=function(scheduleId){$scope.scheduleId=scheduleId;$scope.messageTarget={list:[{name:"Cả phòng"}]};$scope.messageTarget.selected=$scope.messageTarget.list[0];webService.call({name:"Config_GetConfig",data:{actionUserId:sessionService.userId(),value:"CoinChatValue",key:sessionService.key()},onSuccess:function(r){$scope.CoinChatValue=r.Result.Value}});$scope.status="loaded";$scope.$apply()};this.scrollToBottom=function(){var $list=$element.find(".list");$list.scrollTop($list[0].scrollHeight)};this.addMessageTarget=function(userId,name,avatar){var check=!0;$scope.targetUserId=userId;$($scope.messageTarget.list).each(function(i,x){if(x.id===userId)return check=!1,!1});check&&$scope.messageTarget.list.push({id:userId,name:name,avatar:avatar})};this.setMessageTarget=function(userId){var index=0;$($scope.messageTarget.list).each(function(i,x){if(x.id===userId)return index=i,!1});$scope.messageTarget.selected=$scope.messageTarget.list[index]};this.addMessage=function(fromUser,targerUser,message){for(message=helperService.formatMessage(message),$scope.listMessage.push({user:fromUser,target:targerUser,message:message,type:"message"});$scope.listMessage.length>100;)$scope.listMessage.shift();$scope.$apply();$scope.autoScroll&&$scope._ctrl.scrollToBottom()};this.addAlert=function(message){message=helperService.formatMessage(message);$scope.listMessage.push({message:message,type:"alert"});$scope.$apply();$scope.autoScroll&&$scope._ctrl.scrollToBottom()};this.addAlertGlobal=function(header,message){message=header+helperService.formatMessage(message);message=helperService.urlify(message);$scope.listMessage.push({message:message,type:"alert"});$scope.$apply();$scope.autoScroll&&$scope._ctrl.scrollToBottom()};this.addAlertGlobal2=function(header,message){$scope.listMessage.push({message:message,type:"alert"});$scope.$apply();$scope.autoScroll&&$scope._ctrl.scrollToBottom()};$scope.onTextKeyPress=function($event){if($("#dropdown-message-emoticon").jqDropdown("hide"),$event.keyCode===13&&$event.shiftKey===!1){$event.preventDefault();$scope.onSendMessage({target:$($event.target).closest("form")})}};$scope.onSendMessage=function($event){$("#dropdown-message-emoticon").jqDropdown("hide");var $target=$($event.target),$button=$target.find("[type=submit]"),$checkbox=$target.find("[type=checkbox]");if(!$scope.helper.isLoading($button)){if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}if(!$target.find("textarea#message-text.message-text").val()){Notification.warning({message:"Bạn chưa nhập tin nhắn !",delay:3e3,positionY:"bottom",positionX:"right"});return}if($checkbox.is(":checked"))webService.call({name:"SendCoinChat",type:"POST",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,message:$target.find("textarea#message-text.message-text").val(),targetUserId:$scope.targetUserId?$scope.targetUserId:-1,key:sessionService.key()},displayError:!0,onSuccess:function(r){sessionService.data().user.User.Coin+=-r.config;$target.find("textarea#message-text.message-text").val("");return}});else if(typeof $scope._ctrl.onSendMessage=="function"){$button.button("loading");$scope._ctrl.onSendMessage($target.find("textarea#message-text.message-text").val(),$scope.messageTarget.selected,function(){$scope.$apply()});$button.button("reset");$target.find("textarea#message-text.message-text").val("")}}}};return{restrict:"E",replace:!0,scope:!0,templateUrl:"/Views/UserControl/ucShowGlobalMessage.html",controller:controller}}]);giasinhvienApp.directive("ucShowItem",["helperService",function(helperService){return{restrict:"E",transclude:!0,replace:!0,scope:{id:"@",name:"@",photo:"@",startTime:"@",live:"@",view:"@",followStatus:"@",starId:"@",starLevelName:"@",starLevelPhoto:"@",showModel:"="},templateUrl:"/Views/UserControl/ucShowItem.html",link:function(scope){var star,now;scope.showModel&&(star=undefined,scope.showModel.ListShow!=undefined&&(star=scope.showModel.ListShow[0]),scope.id||(scope.id=scope.showModel.Show.Id),scope.photo||(scope.photo=scope.showModel.Show.Photo),scope.name=scope.name||star?scope.showModel.ListShow[0].StarUser.Name:scope.showModel.User.Name,scope.startTime||(scope.startTime=scope.showModel.Schedule.StartTime),scope.status||(scope.status=scope.showModel.Schedule.Status),scope.view||(scope.view=scope.showModel.Show.OnlineUser),star!=undefined?(scope.starId||(scope.starId=star.StarUser.Id),scope.starLevelName||(scope.starLevelName=star.StarLevel.Name),scope.starLevelPhoto||(scope.starLevelPhoto=star.StarLevel.Photo),star.FollowInfo&&(scope.followStatus=star.FollowInfo.Status)):(scope.id=scope.showModel.Show.Id,scope.starId||(scope.starId=scope.showModel.User.Id),scope.starLevelName||(scope.starLevelName=scope.showModel.StarLevel.Name),scope.starLevelPhoto||(scope.starLevelPhoto=scope.showModel.StarLevel.Photo),scope.followStatus=!1));scope.id?scope.link=helperService.linkAction("/show/"+scope.id):scope.starId&&(scope.link=helperService.linkAction("/user/"+scope.starId));scope.photo&&(scope.photo=helperService.linkImage(scope.photo,320));scope.startTime&&(now=new Date,scope.s=scope.startTime-252e5,scope.startTime=new Date(scope.s),now.getFullYear()===scope.startTime.getFullYear()&&now.getMonth()===scope.startTime.getMonth()&&now.getDate()===scope.startTime.getDate()?(scope.shortStartTime=scope.startTime,scope.startTimeType="time"):(scope.shortStartTime=scope.startTime.getDate()+"/"+(scope.startTime.getMonth()+1),scope.startTimeType="date"),scope.startTimeText=scope.startTime);scope.view&&(scope.view=helperService.formatNumber(scope.view,",","k","m","b"))}}}]);giasinhvienApp.directive("ucShowVideo",["$compile","$timeout","$interval","webService","sessionService","helperService","authenticationService","Notification","modalService","apiService",function($compile,$timeout,$interval,webService,sessionService,helperService,authenticationService,Notification,modalService,apiService){var controller=function($scope,$element,$attrs){$scope.liveChecker=undefined;$scope._ctrl=this;$scope.player=undefined;$scope.sessionService=sessionService;$scope.helper=helperService;$scope.scheduleId=undefined;$scope.allowFullscreen=$attrs.allowFullscreen==="false"?!1:!0;$scope.qualityChecker=undefined;$scope.qualityIsOk=!0;$scope.quality={list:[{id:"0",text:"Cao",width:480,height:360},{id:"1",text:"Vừa",width:360,height:270},{id:"2",text:"Thấp",width:240,height:180},{id:"4",text:"640x480",width:640,height:480},{id:"3",text:"HD",width:1280,height:720},]};$scope.quality.current=$scope.quality.list[0];$scope.starStatus="loading";$scope.starError=undefined;$scope.showId=undefined;$scope.starId=undefined;$scope.starAvatar=undefined;$scope.starName=undefined;$scope.starLevelName=undefined;$scope.starLevelPhoto=undefined;$scope.starNextLevelName=undefined;$scope.starNextLevelPhoto=undefined;$scope.starNextLevelNeed=undefined;$scope.starNextLevelProgress=undefined;$scope.starCoinGet=undefined;$scope.starFreeCoinGet=undefined;$scope.starStarShow=undefined;$scope.starFollowStatus=undefined;$scope.starFacebookLink=undefined;$scope.supportFullScreen=window.fullScreenApi.supportsFullScreen;$scope.addFullscreenHandler=!1;$scope.isFullScreen=!1;$scope.browser=helperService.detectBrowser();$scope.seatStatus="loading";$scope.seatError=undefined;$scope.seatCurrentUserId=undefined;$scope.seatCurrentPrice=undefined;$scope.seatCurrentIndex=undefined;$scope.seatCurrentCreateDate=undefined;$scope.seatCurrentEndDate=undefined;$scope.listSeat=[];$scope.listSeatPrice=[];$scope.showStartFlashButton=!1;$scope.showStatus=undefined;$scope.streamKey=undefined;$scope.rtmpHost=undefined;$scope.hlsHost=undefined;$scope.offlineVideoLink=undefined;$scope.videoFlashLink=undefined;$scope.isMute=!1;$scope.facebookLive={handle:undefined,current:{LiveId:null},secondsLeft:0,liveViews:0,lastCommentId:undefined,lastAutoCommentId:undefined,lastAutoCommentTime:undefined};$scope.sampleStar=undefined;$scope.percentSample=0;this.getsampleStar=function(csampleStar,cpercentSample){$scope.sampleStar=csampleStar;$scope.percentSample=cpercentSample};this.startFlash=function(){var flashvar;if($scope.player=document.getElementById("flash-player"),$scope.player===null)return!1;try{if($scope.player.jsCallGetStatus()===1)return!0}catch(ex){}try{return $scope.pageStatus==="user"?(flashvar=$scope.showMobile?{host:$scope.rtmpHost,chanel:$scope.streamKey,width:9,height:16,bf:2}:{host:$scope.rtmpHost,chanel:$scope.streamKey,bf:2},$scope.width!==null&&$scope.height!==null&&(flashvar.width=$scope.width,flashvar.height=$scope.height),$scope.player.jsCall(flashvar)):$scope.pageStatus==="caster"&&($scope.player.jsCallStartStream({host:$scope.rtmpHost,chanel:$scope.streamKey,width:$scope.quality.current.width,height:$scope.quality.current.height}),!$scope.qualityChecker),$scope.showStartFlashButton=!1,!0}catch(ex){return!1}};this.stopFlash=function(){try{return $scope.player=document.getElementById("flash-player"),$scope.player.jsCallStopStream({host:$scope.rtmpHost,chanel:$scope.streamKey}),!0}catch(ex){return!1}};this.loadVideo=function(showId,showStatus,starId,streamKey,rtmpHost,hlsHost,offlineVideoLink,startTime,width,height,isMute,showMobile){$scope.showStatus=showStatus;$scope.showId=showId;$scope.starId=starId;$scope.streamKey=streamKey;$scope.rtmpHost=rtmpHost;$scope.hlsHost=hlsHost;$scope.offlineVideoLink=offlineVideoLink;$scope.startTime=startTime;$scope.width=width;$scope.height=height;$scope.isMute=isMute;$scope.showMobile=showMobile;$scope.starId&&sessionService.userId()===$scope.starId?($scope.videoFlashLink="/Content/Flash/streamer.swf",$scope.videomode="idol"):($scope.videoFlashLink="/Content/Flash/playermobile.swf",$scope.videomode="user");var now=new Date;startTime=new Date(startTime);$scope.isShowToday=startTime.getDate()===now.getDate();$scope.starId==5&&($scope.offlineVideoLink=null);$scope.$apply();$scope.pageStatus==="user"&&$timeout(function(){var player=document.getElementById("flash-player");try{if(player.jsCallGetStatus()===1)return}catch(ex){$scope.showStartFlashButton=!0;$scope.$apply()}},2e3);$scope.$apply()};this.loadStarInfo=function(starId){$scope.starId=starId;webService.call({name:"User_GetDetails",data:{actionUserId:sessionService.userId(),userId:$scope.starId,isStar:!0,key:sessionService.key()},onError:function(errorCode,message){$scope.starError=message;$scope.starStatus="error";$scope.$apply()},onSuccess:function(r){sessionService.setlevel("level"+r.Result.GroupLevel.Id);webService.call({name:"GetTimeIdolStarShow",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,starId:$scope.starId,key:sessionService.key()},onError:function(errorCode,message){$scope.starError=message;$scope.starStatus="error";$scope.$apply()},onSuccess:function(timeShow){$scope._ctrl.setStarInfo(r.Result.User.Name,r.Result.User.AvatarPhoto,r.Result.UserStarData?r.Result.UserStarData.CoinGetFromGift:undefined,r.Result.UserStarData?r.Result.UserStarData.TotalFreeCoinGet:undefined,r.Result.GroupLevel.Name,r.Result.GroupLevel.Photo,r.Result.NextGroupLevel?r.Result.NextGroupLevel.Name:undefined,r.Result.NextGroupLevel?r.Result.NextGroupLevel.Photo:undefined,r.Result.UserStarData&&r.Result.NextGroupLevel?r.Result.NextGroupLevel.Point-r.Result.UserStarData.CoinGetFromGift:undefined,r.Result.UserStarData&&r.Result.NextGroupLevel?Math.min(Math.round((r.Result.UserStarData.CoinGetFromGift-r.Result.GroupLevel.Point)/(r.Result.NextGroupLevel.Point-r.Result.GroupLevel.Point)*100),100):undefined);$scope._ctrl.setStarEvent(r.Result.TotalStar);$scope.starStarShow=timeShow.Result;$scope.starFollowStatus=r.Result.FollowByInfo?r.Result.FollowByInfo.Status:undefined;$scope.starFacebookLink=r.Result.UserStarData.Facebook;$scope.starStatus="loaded";$scope.$apply()}})}})};this.setStarInfo=function(name,avatar,coinGet,freeCoinGet,levelName,levelPhoto,nextLevelName,nextLevelPhoto,nextLevelNeed,nextLevelProgress){$scope.starName=name;$scope.starAvatar=avatar;$scope.starLevelName=levelName;$scope.starLevelPhoto=levelPhoto;nextLevelName&&nextLevelPhoto?($scope.starNextLevelName=nextLevelName,$scope.starNextLevelPhoto=nextLevelPhoto):($scope.starNextLevelName=undefined,$scope.starNextLevelPhoto=undefined);$scope.starNextLevelNeed=nextLevelNeed;$scope.starNextLevelProgress=nextLevelProgress;$scope.starCoinGet=coinGet;$scope.starFreeCoinGet=freeCoinGet;$scope.$apply()};this.setStarEvent=function(totalStar){$scope.totalStar=totalStar;$scope.$apply()};this.loadSeat=function(scheduleId){$scope.scheduleId=scheduleId;$("#dropdown-seat").on("show",function(event,dropdownData){dropdownData.jqDropdown.css("top",dropdownData.trigger.position().top+70+"px");dropdownData.jqDropdown.css("left",dropdownData.trigger.position().left+30+"px");var seat=$scope.listSeat[dropdownData.trigger.data("index")-1];$scope.seatCurrentIndex=seat.index;seat.userId?($scope.seatCurrentUserId=seat.userId,$scope.seatCurrentPrice=seat.currentPrice,$scope.seatCurrentCreateDate=seat.createDate,$scope.seatCurrentEndDate=seat.endDate):($scope.seatCurrentUserId=undefined,$scope.seatCurrentPrice=undefined);$scope.$apply()});$scope._ctrl.refreshSeat()};this.refreshSeat=function(){webService.call({name:"ShowItem_UserGetListShowItemPrice",data:{actionUserId:sessionService.userId(),pageIndex:0,pageSize:999999,minPrice:0,key:sessionService.key()},onError:function(errorCode,message){$scope.seatError=message;$scope.seatStatus="error";$scope.$apply()},onSuccess:function(listPriceResult){$scope.listSeatPrice=[];$(listPriceResult.Items).each(function(i,x){$scope.listSeatPrice.push(x.ShowItemPrice.Price)});webService.call({name:"List_GetListUserBuySeatInShow",data:{actionUserId:sessionService.userId(),scheduleId:$scope.scheduleId,key:sessionService.key()},onError:function(errorCode,message){$scope.seatError=message;$scope.seatStatus="error";$scope.$apply()},onSuccess:function(r){var index,seat;for($scope.listSeat=new Array(5),index=1;index<=5;index++)seat={index:index},$(r.Items).each(function(i,x){if(JSON.parse(x.UserShowItem.Info).Index===index)return seat.userId=x.UserInfo.Id,seat.avatar=x.UserInfo.AvatarPhoto,seat.name=x.UserInfo.Name,seat.currentPrice=x.UserShowItem.CurrentPrice,seat.createDate=x.UserShowItem.CreateDate,seat.endDate=x.UserShowItem.EndTime,!1}),$scope.listSeat[index-1]=seat;$(listPriceResult.Items).each(function(i,x){x.ShowItemPrice.Price==$scope.listSeat[0].currentPrice&&($scope.listSeat[0].imageseat=x.ShowItemPrice.Photo,$scope.listSeat[0].Animation=x.ShowItemPrice.Animation);x.ShowItemPrice.Price==$scope.listSeat[1].currentPrice&&($scope.listSeat[1].imageseat=x.ShowItemPrice.Photo,$scope.listSeat[1].Animation=x.ShowItemPrice.Animation);x.ShowItemPrice.Price==$scope.listSeat[2].currentPrice&&($scope.listSeat[2].imageseat=x.ShowItemPrice.Photo,$scope.listSeat[2].Animation=x.ShowItemPrice.Animation);x.ShowItemPrice.Price==$scope.listSeat[3].currentPrice&&($scope.listSeat[3].imageseat=x.ShowItemPrice.Photo,$scope.listSeat[3].Animation=x.ShowItemPrice.Animation);x.ShowItemPrice.Price==$scope.listSeat[4].currentPrice&&($scope.listSeat[4].imageseat=x.ShowItemPrice.Photo,$scope.listSeat[4].Animation=x.ShowItemPrice.Animation)});$scope.seatStatus="loaded";$scope.$apply()}})}})};this.setSeat=function(index,userId,name,avatar,currentPrice,photo,Animationphoto,CreateDate,EndDate){var seat={index:index,userId:userId,avatar:avatar,imageseat:photo,Animation:Animationphoto,name:name,currentPrice:currentPrice,createDate:CreateDate,endDate:EndDate};console.log(seat);$scope.listSeat[index-1]=seat;$scope.$apply()};$scope.$on("$destroy",function(){$interval.cancel($scope.liveChecker)});$scope.onBuySeat=function($event){if(!sessionService.isSigned()){authenticationService.showModal({mode:"sign-in",message:"Bạn cần đăng nhập để sử dụng tính năng này"});return}var $target=$($event.target),$priceElement=$target.find(".price"),$buttonElement=$target.find("[type=submit]"),index=$target.attr("data-current-index")*1,coin=$priceElement.val();$scope.helper.isLoading($buttonElement)&&$buttonElement.button("loading");webService.call({type:"POST",name:"User_BuySeatInShow",data:{actionUserId:sessionService.userId(),index:index,scheduleId:$scope.scheduleId,coin:coin,isInEvent:!1,key:sessionService.key(),plaform:1},displayError:!0,onError:function(){$buttonElement.button("reset")},onSuccess:function(){if($("#dropdown-seat").jqDropdown("hide"),$buttonElement.button("reset"),$scope.$apply(),typeof $scope._ctrl.onAfterBuySeat=="function")$scope._ctrl.onAfterBuySeat(index,coin)}})};$scope.onStartFlash=function(){$scope._ctrl.startFlash()===!1&&modalService.showAlert({title:"Lỗi",message:"Có lỗi trong quá trình mở Video. Xin kiểm tra chắc chắn trình duyệt bạn có cho phép sử dụng Adobe Flash. Xin đảm bảo trình duyệt bạn đang sử dụng là phiên bản mới nhất. Hoặc liện hệ hỗ trợ để nhận được sự giúp đỡ",buttons:[{text:"Đóng",style:"btn-default",closeModal:!0},]})};$scope.onShareFacebook=function(){typeof $scope._ctrl.onShareFacebook=="function"&&$scope._ctrl.onShareFacebook()};$scope.onFullscreen=function(){var $document=$("html")[0];$scope.supportFullScreen&&$scope.addFullscreenHandler===!1&&($document.addEventListener(fullScreenApi.fullScreenEventName,function(){if($scope.isFullScreen=fullScreenApi.isFullScreen(),typeof $scope._ctrl.onFullscreenChange=="function")$scope._ctrl.onFullscreenChange($scope.isFullScreen)},!0),$scope.addFullscreenHandler=!0);window.fullScreenApi.requestFullScreen($document)};$scope.onFlashQualityCheck=function(data){data&&data.video&&($scope.qualityIsOk=$scope.quality.current.id==="0"&&(data.video<300||data.video>2e3)?!1:data.video>2e3?!1:!0)};$scope.$watch("quality.current",function(){$scope._ctrl.stopFlash()&&$scope._ctrl.startFlash()});$scope.onQuickLiveFacebook=function(){FB.ui({display:"popup",method:"live_broadcast",phase:"create"},function(response){var fbStreamHost,fbStreamKey,i;if(response.id){for(i=response.stream_url.length-1;i>=0;i--)if(response.stream_url[i]==="/"){fbStreamHost=response.stream_url.substr(0,i);fbStreamKey=response.stream_url.substr(i+1,response.stream_url.length);break}$scope.player.jsCallStartStream1({host:fbStreamHost,chanel:fbStreamKey});FB.ui({display:"popup",method:"live_broadcast",phase:"publish",broadcast_data:response},function(){})}})};$scope.onLiveFacebook=function(){if($scope.facebookLive.handle){if(modalService.showAlert({title:"Kết thúc Facebook Live",message:"Bạn muốn ngắt kênh Facebook Live đang sử dụng",buttons:[{text:"Không",style:"btn-default",closeModal:!0},{text:"Có",style:"btn-default",closeModal:!0,onClick:function(){$scope.facebookLive.isCustom||apiService.post({module:"Teenidol.Admin.LiveFacebook",method:"StopCurrentLive",data:{starId:sessionService.userId(),session:sessionService.key()}});$interval.cancel($scope.facebookLive.handle);$scope.facebookLive.handle=undefined;$scope.player.jsCallStopStream1({});Notification.success("Đã kết thúc Facebook Live")}}]}),typeof $scope._ctrl.onFacebookLiveViewsChanged=="function")$scope._ctrl.onFacebookLiveViewsChanged(undefined);return}if(!$scope.player||$scope.player==null){modalService.showAlert({title:"Lỗi",message:"Facebook Live Stream đã kết thúc.",buttons:[{text:"Đóng",style:"btn-default",closeModal:!0}]});return}if($scope.player.jsCallGetBitRate()===null){modalService.showAlert({title:"Lỗi",message:"Bạn cần nhấn nút thu hình ở Teenidol trước khi share lên facebook.",buttons:[{text:"Đóng",style:"btn-default",closeModal:!0}]});return}if($scope.showStatus!==2){modalService.showAlert({title:"Lỗi",message:"Bạn cần bắt đầu show để tiến hành live stream facebook.",buttons:[{text:"Đóng",style:"btn-default",closeModal:!0}]});return}modalService.showFacebookLive({scheduleId:$scope.scheduleId,showId:$scope.showId,player:$scope.player,onSuccess:function(streamResult){($scope.facebookLive.isCustom=streamResult.isCustom,($scope.facebookLive.handle!==undefined||$scope.facebookLive.handle!==null)&&($interval.cancel($scope.facebookLive.handle),$scope.facebookLive.handle=undefined),$scope.facebookLive.isCustom)||$scope._ctrl.liveCheck()}})};$scope.$on("signalrOnGoLive",function(){$scope._ctrl.liveCheck()});$scope.$on("signalrOnStopLive",function(){$scope._ctrl.liveCheck()});this.onLoadPopup=function(link){$scope.ShowHide=!1;link===1?($scope.popupcontent=null,$scope.loadPopup="loading",$scope.ShowHide=!1):($scope.popupcontent=link,$scope.loadPopup="loaded",$scope.ShowHide=!0);$scope.$apply()};$scope._ctrl.liveCheck=function(){sessionService.userId()===$scope.starId&&$scope.player!==undefined&&$scope.player!=null&&$scope.player.jsCallGetBitRate()!==null&&$scope.showStatus===2&&(apiService.get({module:"Teenidol.Admin.LiveFacebook",method:"GetStarLiveInfo",data:{starId:sessionService.userId(),session:sessionService.key()},onSuccess:function(r){if(r.Data!==null&&$scope.facebookLive.current.LiveId===r.Data.LiveId){r.Data.LiveId!==null&&$scope.player.jsCallGetBitRate1()===null&&$scope.player.jsCallStartStream1({host:r.Data.LiveLink.substr(0,r.Data.LiveLink.lastIndexOf("/")),chanel:r.Data.LiveLink.substr(r.Data.LiveLink.lastIndexOf("/")+1)});return}if($scope.facebookLive.current=r.Data,$scope.facebookLive.handle&&($interval.cancel($scope.facebookLive.handle),$scope.facebookLive.handle=undefined,$scope.player.jsCallStopStream1({}),typeof $scope._ctrl.onFacebookLiveViewsChanged=="function"))$scope._ctrl.onFacebookLiveViewsChanged(undefined);if($scope.facebookLive.current.LiveId===null){Notification.success("Đã tắt kênh stream");return}$scope.player.jsCallStartStream1({host:r.Data.LiveLink.substr(0,r.Data.LiveLink.lastIndexOf("/")),chanel:r.Data.LiveLink.substr(r.Data.LiveLink.lastIndexOf("/")+1)});$scope.facebookLive.handle=$interval(function(){$scope.facebookLive.handle!==undefined&&$scope.player&&$scope.player!=null&&$scope.player.jsCallGetBitRate()!==null&&$scope.showStatus===2&&($scope.facebookLive.isBusy||($scope.facebookLive.isBusy=!0,FB.api("/"+$scope.facebookLive.current.LiveId+"?fields=live_views,seconds_left&access_token="+$scope.facebookLive.current.LiveToken,function(r){if(!r.error){var s=r.seconds_left;if($scope.facebookLive.minutesLeft=parseInt(s/60),$scope.facebookLive.secondsLeft=s%60,$scope.facebookLive.liveViews!==r.live_views&&($scope.facebookLive.liveViews=r.live_views,typeof $scope._ctrl.onFacebookLiveViewsChanged=="function"))$scope._ctrl.onFacebookLiveViewsChanged($scope.facebookLive.liveViews);FB.api("/"+$scope.facebookLive.current.LiveId+"/comments?order=reverse_chronological&access_token="+$scope.facebookLive.current.LiveToken,function(r){if($scope.facebookLive.isBusy=!1,r&&!r.error&&r.data[0]&&r.data[0].id!==$scope.facebookLive.lastCommentId&&($scope.facebookLive.lastCommentId=r.data[0].id,typeof $scope._ctrl.onFacebookLiveNewComment=="function"))$scope._ctrl.onFacebookLiveNewComment(r.data[0])})}})))},500)}}),$scope.facebookLive.current.LiveToken!==undefined&&$scope.facebookLive.current.LiveToken!==null&&($scope.facebookLive.lastAutoCommentId===undefined||$scope.facebookLive.lastCommentId!==$scope.facebookLive.lastAutoCommentId)&&($scope.facebookLive.current.lastAutoCommentTime===undefined||(new Date-$scope.facebookLive.current.lastAutoCommentTime)/6e4>5)&&apiService.get({module:"Teenidol.Admin.LiveFacebook",method:"GetRandomComment",data:{starId:sessionService.userId(),session:sessionService.key()},onSuccess:function(r){r.Data!==undefined&&r.Data!==null&&FB.api("/"+$scope.facebookLive.current.LiveId,{fields:"video",access_token:$scope.facebookLive.current.LiveToken},function(r1){r1&&!r1.error&&FB.api("/"+r1.video.id+"/comments","POST",{message:r.Data,access_token:$scope.facebookLive.current.LiveToken},function(r2){r2&&!r2.error&&($scope.facebookLive.lastAutoCommentId=r2.id,$scope.facebookLive.lastCommentId=r2.id,$scope.facebookLive.current.lastAutoCommentTime=new Date)})})}}))};$scope._ctrl.liveCheck();$scope.liveChecker=$interval($scope._ctrl.liveCheck,6e4)};return{restrict:"E",replace:!0,scope:!0,templateUrl:"/Views/UserControl/ucShowVideo.html",controller:controller}}]);giasinhvienApp.directive("ucUserListItem",["helperService",function(helperService){return{restrict:"E",transclude:!0,replace:!0,scope:{id:"@",showId:"@",avatar:"@",name:"@",levelName:"@",levelPhoto:"@",nextLevelName:"@",nextLevelPhoto:"@",nextLevelPoint:"@",currentLevelPoint:"@",displayPoint:"@",displayPointType:"@",vipPhoto:"@",vipName:"@",badgePhoto:"@",badgeName:"@",vipColor:"@",showVipBadge:"@",link:"@",type:"@",indexValue:"@",model:"="},templateUrl:"/Views/UserControl/ucUserListItem.html",link:function(scope){scope.displayPointType=getOrDefault(scope.displayPointType,"coin");scope.showVipBadge=getOrDefault(scope.showVipBadge,!1);scope.type=scope.type?scope.type*1:1;scope.model&&(scope.model.GroupUser&&(scope.type=scope.model.GroupUser.Id),scope.type===2?(scope.id||(scope.id=scope.model.User.Id),!scope.showId&&scope.model.Show&&(scope.showId=scope.model.Show.Id),scope.avatar||(scope.avatar=scope.model.User.AvatarPhoto),scope.name||(scope.name=scope.model.User.Name),scope.indexValue||(scope.indexValue=scope.indexValue),scope.levelName||(scope.levelName=scope.model.StarLevel?scope.model.StarLevel.Name:scope.model.GroupLevel.Name),scope.levelPhoto||(scope.levelPhoto=scope.model.StarLevel?scope.model.StarLevel.Photo:scope.model.GroupLevel.Photo),!scope.nextLevelName&&scope.model.NextGroupLevel&&(scope.nextLevelName=scope.model.NextGroupLevel.Name),!scope.nextLevelPhoto&&scope.model.NextGroupLevel&&(scope.nextLevelPhoto=scope.model.NextGroupLevel.Photo),!scope.nextLevelPoint&&scope.model.NextGroupLevel&&(scope.nextLevelPoint=scope.model.NextGroupLevel.Point),!scope.currentLevelPoint&&scope.model.UserStarData&&(scope.currentLevelPoint=scope.model.UserStarData.CoinGetFromGift),!scope.displayPoint&&scope.model.UserStarData&&(scope.displayPoint=scope.model.UserStarData.CoinGetFromGift),!scope.vipPhoto&&scope.model.VipItem&&(scope.vipPhoto=scope.model.VipItem.PhotoLink),!scope.vipName&&scope.model.VipItem&&(scope.vipName=scope.model.VipItem.Name),!scope.vipColor&&scope.model.VipItem&&(scope.vipColor=scope.model.VipItem.HexColor),!scope.badgePhoto&&scope.model.Badge&&(scope.badgePhoto=scope.model.Badge.Photo),!scope.badgeName&&scope.model.Badge&&(scope.badgeName=scope.model.Badge.Name)):(scope.id||(scope.id=scope.model.User.Id),scope.avatar||(scope.avatar=scope.model.User.AvatarPhoto),scope.name||(scope.name=scope.model.User.Name),scope.indexValue||(scope.indexValue=scope.indexValue),scope.levelName||(scope.levelName=scope.model.GroupLevel.Name),scope.levelPhoto||(scope.levelPhoto=scope.model.GroupLevel.Photo),!scope.nextLevelName&&scope.model.NextGroupLevel&&(scope.nextLevelName=scope.model.NextGroupLevel.Name),!scope.nextLevelPhoto&&scope.model.NextGroupLevel&&(scope.nextLevelPhoto=scope.model.NextGroupLevel.Photo),!scope.nextLevelPoint&&scope.model.NextGroupLevel&&(scope.nextLevelPoint=scope.model.NextGroupLevel.Point),scope.currentLevelPoint||(scope.currentLevelPoint=scope.model.User.TotalCoinUsed),scope.displayPoint||(scope.displayPoint=scope.model.User.TotalCoinUsed),!scope.vipPhoto&&scope.model.VipItem&&(scope.vipPhoto=scope.model.VipItem.PhotoLink),!scope.vipName&&scope.model.VipItem&&(scope.vipName=scope.model.VipItem.Name),!scope.vipColor&&scope.model.VipItem&&(scope.vipColor=scope.model.VipItem.HexColor),!scope.badgePhoto&&scope.model.Badge&&(scope.badgePhoto=scope.model.Badge.Photo),!scope.badgeName&&scope.model.Badge&&(scope.badgeName=scope.model.Badge.Name)));scope.link||(scope.showId?scope.link=helperService.linkAction("/show/"+scope.showId):scope.id&&(scope.link=helperService.linkAction("/user/"+scope.id)));scope.avatar&&(scope.avatar=helperService.linkImage(scope.avatar,160));scope.currentLevelPoint&&scope.nextLevelPoint&&(scope.nextLevelPointNeed=helperService.formatNumber(scope.nextLevelPoint-scope.currentLevelPoint),scope.nextLevelPointProgress=Math.round(scope.currentLevelPoint/scope.nextLevelPoint*100));scope.displayPoint&&(scope.shortDisplayPoint=helperService.formatNumber(scope.displayPoint,",","k"));scope.helper=helperService}}}]);